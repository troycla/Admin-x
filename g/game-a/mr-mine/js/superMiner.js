const superMinerRarities={common:{id:0,name:_("Common"),scaleFactor:1,smallFrame:commonSmallFrame,smallFrameNoFill:commonSmallFrameNoFill,mediumFrame:commonMediumFrame,largeFrame:commonLargeFrame,popupFrame:commonPopupFrame,flatButton:commonFlat,button:commonButton},uncommon:{id:1,name:_("Uncommon"),scaleFactor:1.33,smallFrame:uncommonSmallFrame,smallFrameNoFill:uncommonSmallFrameNoFill,mediumFrame:uncommonMediumFrame,largeFrame:uncommonLargeFrame,popupFrame:uncommonPopupFrame,flatButton:uncommonFlat,button:uncommonButton},rare:{id:2,name:_("Rare"),scaleFactor:1.83,smallFrame:new SpritesheetAnimation(rareSmallFrame,15,10),smallFrameNoFill:new SpritesheetAnimation(rareSmallFrameNoFill,15,10),mediumFrame:rareMediumFrame,largeFrame:rareLargeFrame,popupFrame:rarePopupFrame,flatButton:rareFlat,button:rareButton},legendary:{id:3,name:_("Legendary"),scaleFactor:2.5,smallFrame:new SpritesheetAnimation(legendarySmallFrame,15,10),smallFrameNoFill:new SpritesheetAnimation(legendarySmallFrameNoFill,15,10),mediumFrame:legendaryMediumFrame,largeFrame:legendaryLargeFrame,popupFrame:legendaryPopupFrame,flatButton:legendaryFlat,button:legendaryButton}},superMinerTypes={BASE:0,DRILL:1,MINER:2,BUFF:3,SELLER:4,EGG:5,CHEST:6,DEPOSIT:7,BOOSTER:8,REWARD:9};class SuperMiner{id;uniqueId;name;baseCost=30;level=1;experience=0;maxLevel=0;rarity;portrait;renderContext;lastUpdate=0;renderer;boostAmount=1;boostDuration=0;hasButton=!1;needsProgressBar=!1;saveDataMap={};type=superMinerTypes.BASE;init(){this.uniqueId=this.id+"-"+currentTime(),this.level=1,this.lastUpdate=0,superMinerManager.dirtyCache(),this.currentDepth&&this.currentDepth<0&&this.setToRandomDepth(1,depth)}update(e){this.boostDuration>0?this.boostDuration-=e:(this.boostDuration=0,this.boostAmount=1)}clone(){var e=new this.constructor;if(Object.assign(e,this),e.renderer){var t=new e.renderer.constructor(e);Object.assign(t,e.renderer),t.parent=e,e.renderer=t}return e}canLevel(){return worldResources[SUPER_MINER_SOULS_INDEX].numOwned>=this.getLevelCost()&&!this.isMaxLevel()}isMaxLevel(){return this.level>=this.maxLevel}getLevelCost(){return 5*Math.round((this.baseCost*(this.level+1))**1.2/5)}levelUp(){worldResources[SUPER_MINER_SOULS_INDEX].numOwned-=this.getLevelCost(),this.level++,superMinerManager.dirtyCache()}scrapAmount(){let e=1+Math.log10(this.rarity.scaleFactor),t=(this.level*(this.level+1)/2)**1.1;return Math.floor(e*this.baseCost*t)}handleMovement(){if(-1==this.targetDepth){let e=Math.max(2,this.currentDepth-40),t=Math.min(depth-2,this.currentDepth+40);this.targetDepth=getRandomMineableDepthInRange(e,t,.8)}if(this.currentDepth<this.targetDepth)this.currentDepth++;else if(this.currentDepth>this.targetDepth)this.currentDepth--;else{let e=Math.max(2,this.currentDepth-40),t=Math.min(depth-2,this.currentDepth+40);this.targetDepth=getRandomMineableDepthInRange(e,t,.8)}isDepthWithoutWorkers(this.currentDepth)&&this.handleMovement(),superMinerManager.dirtyCache()}setToRandomDepth(e,t){this.currentDepth=getRandomMineableDepthInRange(e,t,.8)}scrap(){superMinerManager.removeSuperMinerById(this.uniqueId),worldResources[SUPER_MINER_SOULS_INDEX].numOwned+=this.scrapAmount(),superMinerManager.dirtyCache()}renderDescription(e,t,r,i,n,s="left"){fillTextWrapWithHeightLimit(e,this.getbaseDescription(),t,r,i,n,s)}render(){this.renderer&&this.renderer.render(this.renderContext)}canPressButton(){return!1}percentageUntilAction(){return 1}onButtonPress(){return!0}restore(e){for(var t in this.init(),this.saveDataMap)this[t]=e[this.saveDataMap[t].index],this.saveDataMap[t].parseFunction&&(this[t]=this.saveDataMap[t].parseFunction(this[t]))}getSaveString(){var e=[this.id];for(var t in this.saveDataMap)e[this.saveDataMap[t].index]=this[t];return e.join("!")}}class DrillMiner extends SuperMiner{drillingSpritesheet;spriteYOffset=.1;statId=7;saveDataMap={id:{index:0},uniqueId:{index:1},level:{index:2,parseFunction:parseInt},lastUpdate:{index:3,parseFunction:parseInt}};type=superMinerTypes.DRILL;constructor(){super(),this.renderer=new DrillMinerRenderer(this),this.renderer.miningDisplayType=MINING_DISPLAY_TYPE_NONE}update(e){super.update(e)}init(){super.init()}get statBonuses(){return[{id:7,amount:()=>{let e=10*this.boostAmount*STAT.superMinerSpeedMultiplier();return 5*Math.round(this.rarity.scaleFactor*e*this.level**.6/5)}}]}getbaseDescription(){return _("Increasing drill speed by {0}%",this.statBonuses[0].amount())}get buttonIcon(){return superIcon1}}class SuperBooster extends SuperMiner{walkingSpritesheet;boostingDuration=60;currentDepth=-1;saveDataMap={id:{index:0},uniqueId:{index:1},level:{index:2,parseFunction:parseInt},lastUpdate:{index:3,parseFunction:parseInt}};type=superMinerTypes.BOOSTER;constructor(){super(),this.renderer=new WanderingSuperMinerRenderer(this),this.renderer.miningDisplayType=MINING_DISPLAY_TYPE_NONE}getBoostAmount(){return 1+.25*this.level}update(e){super.update(e),this.lastUpdate++,this.lastUpdate>30&&(this.handleMovement(),this.lastUpdate=0);let t=superMinerManager.superMinersOnDepth(this.currentDepth);if(t.length>1){for(var r=0;r<t.length;r++)t[r].type!=superMinerTypes.BOOSTER&&(t[r].boostAmount=this.getBoostAmount(),t[r].boostDuration=this.boostingDuration);this.handleMovement()}}init(){super.init()}getbaseDescription(){return _("After colliding with other super miners it boost their effects by {0}% for {1}",Math.floor(100*(this.getBoostAmount()-1)),shortenedFormattedTime(this.boostingDuration))}renderDescription(e,t,r,i,n,s="left"){fillTextWrapWithHeightLimit(e,this.getbaseDescription(),t,r,i,.9*n,s),fillTextWrapWithHeightLimit(e,_("Moves depths every {0} seconds",30),t,r+.9*n,i,.1*n,s)}get buttonIcon(){return superIcon9}render(){for(var e=0;e<superMinerManager.numSuperMiners();e++){let s=superMinerManager.currentSuperMiners[e];if(s.boostDuration&&isDepthVisible(s.currentDepth)){var t=worldConfig.leftBound;let e=s.currentDepth,a=worldConfig.topBound+(e-1-(currentlyViewedDepth+partialDepthOffset-worldConfig.numberOfDepthsVisible))*worldConfig.levelHeight,l=1500;var r=Math.abs(1),i=.4+.5*(1-r/1),n=-1e3*r/1;this.renderContext.globalAlpha=i*(1-oscillate(currentTime()+n,l)),this.renderContext.drawImage(purplesparkles1,t,a-1,worldConfig.levelWidth,worldConfig.levelHeight),this.renderContext.globalAlpha=.8*i*oscillate(currentTime()+n,l),this.renderContext.drawImage(purplesparkles2,t,a-1,worldConfig.levelWidth,worldConfig.levelHeight),this.renderContext.globalAlpha=1}}super.render()}}class EggMiner extends SuperMiner{experience=0;hatchedPortrait;needsProgressBar=!0;saveDataMap={id:{index:0},uniqueId:{index:1},level:{index:2,parseFunction:parseInt},experience:{index:3,parseFunction:parseInt}};type=superMinerTypes.EGG;update(e){super.update(e),this.level<this.maxLevel&&(this.experience+=e*this.boostAmount*STAT.superMinerSpeedMultiplier()),this.experience>=this.getLevelExperience()&&(this.level++,this.experience=0),this.level>=this.maxLevel&&this.portrait!=this.hatchedPortrait&&(this.portrait=this.hatchedPortrait)}levelUp(){worldResources[SUPER_MINER_SOULS_INDEX].numOwned-=this.getLevelCost(),this.level++,this.experience=0}getLevelCost(){return Math.floor(super.getLevelCost()*(1-this.percentageUntilAction()))}getLevelExperience(){return 7e3*((this.level+1)**1.2*this.baseCost)}scrapAmount(){return Math.floor(1.4*super.scrapAmount())}percentageUntilAction(){return Math.min(1,this.experience/this.getLevelExperience())}getbaseDescription(){return _("Passively gains experience and levels up for free, increasing its scrap amount.")}get buttonIcon(){return superIcon6}}class ChestMiner extends SuperMiner{walkingSpritesheet;currentDepth=-1;targetDepth=-1;effectRange=2;saveDataMap={id:{index:0},uniqueId:{index:1},level:{index:2,parseFunction:parseInt},lastUpdate:{index:3,parseFunction:parseInt},currentDepth:{index:4,parseFunction:parseInt},targetDepth:{index:5,parseFunction:parseInt}};type=superMinerTypes.CHEST;constructor(){super(),this.renderer=new WanderingSuperMinerRenderer(this),this.renderer.miningDisplayType=MINING_DISPLAY_TYPE_NONE}getChestMultiplier(){let e=2.5*this.boostAmount*STAT.superMinerSpeedMultiplier();return.1*Math.round(this.rarity.scaleFactor*e*this.level**.25/.1)}init(){super.init()}update(e){super.update(e),currentTime()-this.lastUpdate>6e4&&(this.handleMovement(),this.lastUpdate=currentTime(),this.spawnChests(),this.spawnChests())}spawnChests(){if(!(chestService.chests.length>depth/5))for(var e=0;e<5;e++)if(chestService.rollForBasicChest(this.getChestMultiplier())){var t=this.currentDepth-this.effectRange+e,r=chestService.getAvailableMiners(t),i=r[rand(0,r.length-1)];isDepthWithoutWorkers(t)||BattleManager.isActiveBossLevel(t)||!i||chestService.spawnChest(t,Chest.superminer,chestService.rollForSpecialChest(),i)}}getbaseDescription(){return this.currentDepth<0&&this.lastUpdate<=0?_("Increases chest spawns for 5 depths around it by {0}%",Math.floor(100*this.getChestMultiplier())):_("Increasing the chest spawns between {0}km and {1}km by {2}%",this.currentDepth-this.effectRange,this.currentDepth+this.effectRange,Math.floor(100*this.getChestMultiplier()))}renderDescription(e,t,r,i,n,s="left"){fillTextWrapWithHeightLimit(e,this.getbaseDescription(),t,r,i,.9*n,s),fillTextWrapWithHeightLimit(e,_("Moves depths every {0} min",1),t,r+.9*n,i,.1*n,s)}get buttonIcon(){return superIcon3}render(){if(isDepthVisible(this.currentDepth-this.effectRange)||isDepthVisible(this.currentDepth+this.effectRange))for(var e=worldConfig.leftBound,t=0;t<1+2*this.effectRange;t++){let s=this.currentDepth-this.effectRange+t,a=worldConfig.topBound+(s-1-(currentlyViewedDepth+partialDepthOffset-worldConfig.numberOfDepthsVisible))*worldConfig.levelHeight,l=1500;var r=Math.abs(t-this.effectRange),i=.4+.5*(1-r/this.effectRange),n=-1e3*r/this.effectRange;this.renderContext.globalAlpha=i*(1-oscillate(currentTime()+n,l)),this.renderContext.drawImage(sparkles1,e,a-1,worldConfig.levelWidth,worldConfig.levelHeight),this.renderContext.globalAlpha=.8*i*oscillate(currentTime()+n,l),this.renderContext.drawImage(sparkles2,e,a-1,worldConfig.levelWidth,worldConfig.levelHeight),this.renderContext.globalAlpha=1}super.render()}}class DepositMiner extends SuperMiner{walkingSpritesheet;drillingSpritesheet;currentDepth=-1;targetDepth=-1;saveDataMap={id:{index:0},uniqueId:{index:1},level:{index:2,parseFunction:parseInt},lastUpdate:{index:3,parseFunction:parseInt},currentDepth:{index:4,parseFunction:parseInt},targetDepth:{index:5,parseFunction:parseInt}};type=superMinerTypes.DEPOSIT;constructor(){super(),this.renderer=new WanderingSuperMinerRenderer(this),this.renderer.miningDisplayType=MINING_DISPLAY_TYPE_NONE}init(){super.init()}update(e){super.update(e),this.lastUpdate+=e,this.lastUpdate>360&&(this.handleMovement(),this.lastUpdate=0)}get statBonuses(){return[{id:25,amount:()=>Math.floor(.1*Math.round(this.rarity.scaleFactor*this.boostAmount*STAT.superMinerSpeedMultiplier()*(.3*this.level)/.1)*100)},{id:26,amount:()=>1+Math.floor(this.level/3)}]}getbaseDescription(){return _("Increases mineral deposit spawns by {0}% and increases the maximum number of mineral deposits in the world by {1}",this.statBonuses[0].amount(),this.statBonuses[1].amount())}renderDescription(e,t,r,i,n,s="left"){fillTextWrapWithHeightLimit(e,this.getbaseDescription(),t,r,i,.9*n,s),fillTextWrapWithHeightLimit(e,_("Moves depths every {0} mins",6),t,r+.9*n,i,.1*n,s)}get buttonIcon(){return superIcon5}}class MiningSuperMiner extends SuperMiner{renderer;walkingSpritesheet;drillingSpritesheet;currentDepth=-1;targetDepth=-1;subType="mineral";baseSpeed=12.5;affectedDepth=-1;autoSell=!1;saveDataMap={id:{index:0},uniqueId:{index:1},level:{index:2,parseFunction:parseInt},lastUpdate:{index:3,parseFunction:parseInt},currentDepth:{index:4,parseFunction:parseInt},targetDepth:{index:5,parseFunction:parseInt}};type=superMinerTypes.MINER;constructor(){super(),this.renderer=new WanderingSuperMinerRenderer(this),this.renderer.miningDisplayType=MINING_DISPLAY_TYPE_CALCULATE}getMiningSpeed(){var e=this.rarity.scaleFactor*this.baseSpeed*this.boostAmount*STAT.superMinerSpeedMultiplier()*this.level**.6;return"isotope"==this.subType&&(e/=2),.5*Math.round(e/.5)}init(){super.init()}update(e){super.update(e),this.lastUpdate+=e,this.affectedDepth<=0&&this.updateAffectedDepth(),this.lastUpdate>360&&(this.handleMovement(),this.lastUpdate=0,this.updateAffectedDepth())}updateAffectedDepth(){if("isotope"==this.subType){for(var e=!1,t=0;t<50;t++){var r=this.currentDepth+t,i=this.currentDepth-t;if(r<=depth&&this.checkIsotopesOnDepth(r)){this.affectedDepth=r,e=!0;break}if(i>0&&this.checkIsotopesOnDepth(i)){this.affectedDepth=i,e=!0;break}}e||(this.affectedDepth=this.currentDepth)}else this.affectedDepth=this.currentDepth}checkIsotopesOnDepth(e){let t=estimatedMineralsPerMinuteAtLevel(e);for(var r=1;r<t.length;r++)if(worldResources[r].isIsotope&&t[r]>0)return!0;return!1}getbaseDescription(){var e;return e="mineral"==this.subType?this.currentDepth<0&&this.lastUpdate<=0?_("Increases mining speed at a depth by {0}%.",Math.floor(100*this.getMiningSpeed())):_("Increasing mining speed at {0}km by {1}%.",this.currentDepth,Math.floor(100*this.getMiningSpeed())):this.currentDepth<0&&this.lastUpdate<=0?_("Increases the number of isotopes mined at a depth by {1}%.",Math.floor(100*this.getMiningSpeed())):_("Increasing the number of isotopes mined at {0}km by {1}%.",this.currentDepth,Math.floor(100*this.getMiningSpeed())),this.autoSell&&(e+=_(" Automatically sells any minerals mined.")),e}renderDescription(e,t,r,i,n,s="left"){fillTextWrapWithHeightLimit(e,this.getbaseDescription(),t,r,i,.9*n,s),fillTextWrapWithHeightLimit(e,_("Moves depths every {0} mins",6),t,r+.9*n,i,.1*n,s)}get buttonIcon(){return"mineral"==this.subType?superIcon2:superIcon4}}class BuffMiner extends SuperMiner{walkingSpritesheet;drillingSpritesheet;hasButton=!0;needsProgressBar=!0;mineralsBetweenBuffByLevel=[];buffPercentageByLevel=[];buffId=-1;buffDuration=60;currentMineralsMined=0;currentDepth=-1;targetDepth=-1;saveDataMap={id:{index:0},uniqueId:{index:1},level:{index:2,parseFunction:parseInt},lastUpdate:{index:3,parseFunction:parseInt},currentDepth:{index:4,parseFunction:parseInt},currentMineralsMined:{index:5,parseFunction:parseInt},targetDepth:{index:6,parseFunction:parseInt}};type=superMinerTypes.BUFF;animationLoopTime=40;miningTime=6;spriteYOffset=-.2;spriteHeightFraction=.65;constructor(){super(),this.renderer=new WanderingSuperMinerRenderer(this),this.renderer.miningDisplayType=MINING_DISPLAY_TYPE_FAKE}init(){super.init()}update(e){if(super.update(e),this.lastUpdate+=e,1!=this.percentageUntilAction()){let t=Math.ceil(estimatedMineralsPerMinuteAtLevel(this.currentDepth).reduce(((e,t)=>e+t),0)/60);this.currentMineralsMined+=t*e*this.boostAmount*STAT.superMinerSpeedMultiplier()}this.lastUpdate>360&&(this.handleMovement(),this.lastUpdate=0)}percentageUntilAction(){return Math.min(1,this.currentMineralsMined/this.mineralsBetweenBuffByLevel[this.level-1])}canPressButton(){return 1==this.percentageUntilAction()}onButtonPress(){this.canPressButton()&&(buffs.startBuff(this.buffId,this.buffDuration,"BuffMiner",this.buffPercentageByLevel[this.level-1]),this.currentMineralsMined=0)}getbaseDescription(){return _("Every {0} minerals mined by {1} grants a {2}% {3} buff for {4}",this.mineralsBetweenBuffByLevel[this.level-1],this.name,this.buffPercentageByLevel[this.level-1],buffs.getStaticBuffById(this.buffId).name,shortenedFormattedTime(this.buffDuration))}renderDescription(e,t,r,i,n,s="left"){fillTextWrapWithHeightLimit(e,this.getbaseDescription(),t,r,i,.9*n,s),fillTextWrapWithHeightLimit(e,_("Moves depths every {0} mins",6),t,r+.9*n,i,.1*n,s)}get buttonIcon(){if(this.buffId>-1)return buffs.staticBuffs[this.buffId].image}buttonTooltip(){return{header:_("Currently mined"),body:"<center>"+_("{0} / {1}",this.currentMineralsMined,this.mineralsBetweenBuffByLevel[this.level-1])+"</center>"}}}class SuperSeller extends SuperMiner{lastSold=0;hasButton=!0;needsProgressBar=!0;attachedMineralId=0;saveDataMap={id:{index:0},uniqueId:{index:1},level:{index:2,parseFunction:parseInt},lastUpdate:{index:3,parseFunction:parseInt},attachedMineralId:{index:4}};type=superMinerTypes.SELLER;getSellAmount(){return Math.floor(10*this.rarity.scaleFactor*this.level)}update(e){this.attachedMineralId>0&&(sellMineralAmount(this.attachedMineralId,Math.floor(this.getSellAmount()*e)),this.lastSold=currentTime())}percentageUntilAction(){return Math.min(1,(currentTime()-this.lastSold)/1e3)}canPressButton(){return!0}onButtonPress(){openUi(SuperSellerWindow,null,this)}getbaseDescription(){return _("Automatically sell {0} minerals every second",this.getSellAmount())}get buttonIcon(){if(worldResources[this.attachedMineralId])return worldResources[this.attachedMineralId].largeIcon}}class RewardMiner extends SuperMiner{walkingSpritesheet;drillingSpritesheet;hasButton=!0;needsProgressBar=!0;currentMineralsMined=0;currentDepth=-1;targetDepth=-1;saveDataMap={id:{index:0},uniqueId:{index:1},level:{index:2,parseFunction:parseInt},lastUpdate:{index:3,parseFunction:parseInt},currentDepth:{index:4,parseFunction:parseInt},currentMineralsMined:{index:5,parseFunction:parseInt},targetDepth:{index:6,parseFunction:parseInt}};type=superMinerTypes.REWARD;constructor(){super(),this.renderer=new WanderingSuperMinerRenderer(this),this.renderer.miningDisplayType=MINING_DISPLAY_TYPE_FAKE}init(){super.init()}getMineralAmount(){return 1e3*Math.round(5e4/Math.log10(1+this.level*this.rarity.scaleFactor**.25)/1e3)}update(e){if(super.update(e),this.lastUpdate+=e,1!=this.percentageUntilAction()){let t=Math.ceil(estimatedMineralsPerMinuteAtLevel(this.currentDepth).reduce(((e,t)=>e+t),0)/60);this.currentMineralsMined+=t*e*this.boostAmount*STAT.superMinerSpeedMultiplier()}this.lastUpdate>360&&(this.handleMovement(),this.lastUpdate=0)}percentageUntilAction(){return Math.min(1,this.currentMineralsMined/this.getMineralAmount())}canPressButton(){return this.percentageUntilAction()>=1}onButtonPress(){this.canPressButton()&&(this.grantRandomReward(),this.currentMineralsMined=0)}getbaseDescription(){return _("Every {0} minerals mined by {1} grants a random reward",this.getMineralAmount(),this.name)}renderDescription(e,t,r,i,n,s="left"){fillTextWrapWithHeightLimit(e,this.getbaseDescription(),t,r,i,.9*n,s),fillTextWrapWithHeightLimit(e,_("Moves depths every {0} mins",6),t,r+.9*n,i,.1*n,s)}grantRandomReward(){let e=wizardRoller.rand(0,1e3),t="";e<200?t=grantMoneyMinutes(30):e<400?t=grantSuperMinerSouls(10):e<600?t=grantTwentyBuildingMaterials():e<800?t=grantStaticBuff():e<950?scientistsGrantMineralsForMinutes(60):e<1e3&&(t=grantTickets(1)),""!=t&&newNews(_("You gained {0} from the Wizard!",t))}get buttonIcon(){return superIcon8}buttonTooltip(){return{header:_("Currently mined"),body:"<center>"+_("{0} / {1}",this.currentMineralsMined,this.getMineralAmount())+"</center>"}}}