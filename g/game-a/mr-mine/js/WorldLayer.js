var isLaunching=!1,clickedCompress=!1;class WorldLayer extends UiLayer{layerName="WorldLayer";zIndex=3;isRendered=!0;isPopup=!1;allowBubbling=!0;context=MAIN;previouslyViewedDepth=0;leftBound=Math.ceil(.082*mainw);topBound=.111*mainh;levelHeight=.178*mainh;numberOfDepthsVisible=5;minVisibleDepth=0;topCityLevelCount=4;minerFrames=8;minerFrameWidth=32;minerFrameSpacing=2;constructor(e){super(e),this.context&&(this.context.canvas.style.x=e.x,this.context.canvas.style.y=e.y,this.context.canvas.style.width=e.width,this.context.canvas.style.height=e.height),initFoundArray(this.numberOfDepthsVisible);for(var i=0;i<tradeConfig.tradingPosts.length;++i)this.addHitbox(new WorldEntityHitbox(tradeConfig.tradingPosts[i].depth,{x:Math.ceil(.082*mainw),y:0,width:tradeConfig.tradingPosts[i].image.width,height:tradeConfig.tradingPosts[i].image.height},{onmousedown:function(e){if(0==tradingPostStructures[e].level){var i=openUi(CraftingWindow,null,e);i&&(i.openTab(1),0==e?i.selectedBlueprint=getBlueprintById(3,0):1==e&&(i.selectedBlueprint=getBlueprintById(3,5)),i.initializeCraftingPane())}else openUi(TradeWindow,null,e)}.bind(this,i)},"pointer","tradingPost_"+i,this));this.addHitbox(new WorldEntityHitbox(1030,{x:this.boundingBox.width/uiScaleX*.1,y:0,width:this.boundingBox.width/uiScaleX*.275,height:this.boundingBox.height/uiScaleY*.25},{onmousedown:function(){openUi(SellWindow,null,MOON_INDEX)}},"pointer","sellCenter",this)),this.addHitbox(new WorldEntityHitbox(1030,{x:this.boundingBox.width/uiScaleX*.375,y:this.boundingBox.height/uiScaleY*.04,width:this.boundingBox.width/uiScaleX*.17,height:this.boundingBox.height/uiScaleY*.25},{onmousedown:function(){openUi(HireWindow,null,MOON_INDEX)}},"pointer","hireCenter",this)),this.addHitbox(new WorldEntityHitbox(1030,{x:this.boundingBox.width/uiScaleX*.62,y:0,width:this.boundingBox.width/uiScaleX*.14,height:this.boundingBox.height/uiScaleY*.25},{onmousedown:function(){openUi(CraftingWindow,null,MOON_INDEX)}},"pointer","drillCenter",this)),this.addHitbox(new WorldEntityHitbox(1030,{x:this.boundingBox.width/uiScaleX*.55,y:this.boundingBox.height/uiScaleY*.05,width:this.boundingBox.width/uiScaleX*.065,height:this.boundingBox.height/uiScaleY*.18},{onmousedown:function(){openUi(PurchaseWindow,null,MOON_INDEX),document.getElementById("buyoptions")&&(document.getElementById("buyoptions").innerHTML=paypalhtml,document.getElementById("BTC1").style.visibility="hidden",document.getElementById("BTC1").style.zIndex=-2,document.getElementById("BTC2").style.visibility="hidden",document.getElementById("BTC2").style.zIndex=-2,document.getElementById("REDEEM").style.visibility="hidden",document.getElementById("REDEEM").style.zIndex=-2)}},"pointer","lunarGarage",this)),this.addHitbox(new WorldEntityHitbox(1812,{x:this.boundingBox.width/uiScaleX*.1,y:0,width:this.boundingBox.width/uiScaleX*.275,height:this.boundingBox.height/uiScaleY*.25},{onmousedown:function(){openUi(SellWindow,null,TITAN_INDEX)}},"pointer","sellCenter",this)),this.addHitbox(new WorldEntityHitbox(1812,{x:this.boundingBox.width/uiScaleX*.375,y:this.boundingBox.height/uiScaleY*.04,width:this.boundingBox.width/uiScaleX*.17,height:this.boundingBox.height/uiScaleY*.25},{onmousedown:function(){openUi(HireWindow,null,TITAN_INDEX)}},"pointer","hireCenter",this)),this.addHitbox(new WorldEntityHitbox(1812,{x:this.boundingBox.width/uiScaleX*.62,y:0,width:this.boundingBox.width/uiScaleX*.14,height:this.boundingBox.height/uiScaleY*.25},{onmousedown:function(){openUi(CraftingWindow,null,TITAN_INDEX)}},"pointer","drillCenter",this)),this.addHitbox(new WorldEntityHitbox(1812,{x:this.boundingBox.width/uiScaleX*.55,y:this.boundingBox.height/uiScaleY*.05,width:this.boundingBox.width/uiScaleX*.065,height:this.boundingBox.height/uiScaleY*.18},{onmousedown:function(){openUi(PurchaseWindow,null,TITAN_INDEX),document.getElementById("buyoptions")&&(document.getElementById("buyoptions").innerHTML=paypalhtml,document.getElementById("BTC1").style.visibility="hidden",document.getElementById("BTC1").style.zIndex=-2,document.getElementById("BTC2").style.visibility="hidden",document.getElementById("BTC2").style.zIndex=-2,document.getElementById("REDEEM").style.visibility="hidden",document.getElementById("REDEEM").style.zIndex=-2)}},"pointer","titanGarage",this)),this.addHitbox(new WorldEntityHitbox(-2,{x:this.boundingBox.width/uiScaleX*.3,y:this.boundingBox.height/uiScaleY*.08,width:this.boundingBox.width/uiScaleX*.05,height:this.boundingBox.height/uiScaleY*.12},{onmouseenter:function(){0!=managerStructure.level&&(1==managerStructure.level?showTooltip(_("Manager Level {0}",managerStructure.level),_("- Unlocks sell center resource locking.<br><br>- Grants you offline progress at 25% efficiency for 12hrs.")):2==managerStructure.level?showTooltip(_("Manager Level {0}",managerStructure.level),_("- Unlocks sell center resource locking.<br><br>- Grants you offline progress at 50% efficiency for 24hrs.")):showTooltip(_("Manager Level {0}",managerStructure.level),_("- Unlocks sell center resource locking.<br><br>- Grants you offline progress at 100% efficiency for 48hrs.")))},onmouseexit:function(){hideTooltip()}},"pointer","manager",this)),this.addHitbox(new WorldEntityHitbox(10,{x:this.boundingBox.width/uiScaleX*.1,y:this.boundingBox.height/uiScaleY*.025,width:this.boundingBox.width/uiScaleX*.68,height:this.boundingBox.height/uiScaleY*.15},{onmousedown:function(){superMinerManager.recievedInitialSuperMiner?openUi(SuperMinersWindow):(chestService.spawnChest(0,Chest.purchased,ChestType.black),chestService.presentChest(0),superMinerManager.recievedInitialSuperMiner=!0)}},"pointer","superMiners",this)),this.addHitbox(new WorldEntityHitbox(302,{x:this.boundingBox.width/uiScaleX*.09,y:this.boundingBox.height/uiScaleY*.03,width:this.boundingBox.width/uiScaleX*.25,height:this.boundingBox.height/uiScaleY*.3},{onmousedown:function(){openUi(GemForgeWindow)}},"pointer","gemForge",this)),this.addHitbox(new WorldEntityHitbox(300,{x:this.boundingBox.width/uiScaleX*.32,y:this.boundingBox.height/uiScaleY*.07,width:this.boundingBox.width/uiScaleX*.2,height:this.boundingBox.height/uiScaleY*.2},{onmousedown:function(){openUi(QuestWindow,"",1)}},"pointer","cityAchievements",this)),this.addHitbox(new WorldEntityHitbox(300,{x:this.boundingBox.width/uiScaleX*.55,y:this.boundingBox.height/uiScaleY*.07,width:this.boundingBox.width/uiScaleX*.25,height:this.boundingBox.height/uiScaleY*.62},{onmousedown:function(){openUi(WeaponCraftingWindow)}},"pointer","weaponCrafting",this)),this.addHitbox(new WorldEntityHitbox(302,{x:this.boundingBox.width/uiScaleX*.36,y:this.boundingBox.height/uiScaleY*.03,width:this.boundingBox.width/uiScaleX*.15,height:this.boundingBox.height/uiScaleY*.3},{onmousedown:function(){openUi(OilPumpWindow)}},"pointer","oilRig",this)),this.addHitbox(new WorldEntityHitbox(501,{x:Math.ceil(.082*mainw),y:0,width:lavachasm.width,height:lavachasm.height},{onmousedown:function(){openUi(PitWindow)}},"pointer","core",this)),this.addHitbox(new WorldEntityHitbox(1133,{x:this.boundingBox.width/uiScaleX*.1,y:this.boundingBox.height/uiScaleY*.03,width:this.boundingBox.width/uiScaleX*.68,height:this.boundingBox.height/uiScaleY*.3},{onmousedown:function(){openUi(ReactorWindow)}},"pointer","reactor",this)),this.addHitbox(new WorldEntityHitbox(1135,{x:this.boundingBox.width/uiScaleX*.1,y:this.boundingBox.height/uiScaleY*.025,width:this.boundingBox.width/uiScaleX*.68,height:this.boundingBox.height/uiScaleY*.15},{onmousedown:function(){openUi(BuffLabWindow)}},"pointer","buffLab",this)),this.addHitbox(new WorldEntityHitbox(999,{x:this.boundingBox.width/uiScaleX*.82,y:0,width:this.boundingBox.width/uiScaleX*.1,height:this.boundingBox.height/uiScaleY*.04},{onmouseenter:function(){!isLaunching&&isWaitingForLiftoff()&&(document.body.style.cursor="pointer")},onmousedown:function(){!isLaunching&&isWaitingForLiftoff()&&(isLaunching=!0,newNews("> 5 <"),mutebuttons||takeoffCountdownAudio.play(),setTimeout((function(){newNews("> 4 <"),mutebuttons||takeoffCountdownAudio.play()}),1e3),setTimeout((function(){newNews("> 3 <"),mutebuttons||takeoffCountdownAudio.play()}),2e3),setTimeout((function(){newNews("> 2 <"),mutebuttons||takeoffCountdownAudio.play()}),3e3),setTimeout((function(){newNews("> 1 <"),mutebuttons||takeoffCountdownAudio.play()}),4e3),setTimeout((function(){newNews("> 0 <"),mutebuttons||takeoffCountdownAudio.play(),hasLaunched++,isLaunching=!1}),5e3))},onmouseexit:function(){}},null,"launchButton",this)),this.addHitbox(new WorldEntityHitbox(1782,{x:this.boundingBox.width/uiScaleX*.82,y:0,width:this.boundingBox.width/uiScaleX*.1,height:this.boundingBox.height/uiScaleY*.04},{onmouseenter:function(){!isLaunching&&isWaitingForLiftoff()&&(document.body.style.cursor="pointer")},onmousedown:function(){!isLaunching&&isWaitingForLiftoff()&&(isLaunching=!0,newNews("> 5 <"),setTimeout((function(){newNews("> 4 <")}),1e3),setTimeout((function(){newNews("> 3 <")}),2e3),setTimeout((function(){newNews("> 2 <")}),3e3),setTimeout((function(){newNews("> 1 <")}),4e3),setTimeout((function(){newNews("> 0 <"),hasLaunched++,isLaunching=!1}),5e3))},onmouseexit:function(){}},null,"launchButton2",this)),this.addHitbox(new WorldEntityHitbox(CAVE_BUILDING_DEPTH,{x:Math.ceil(.082*mainw),y:0,width:caveBuildingLevel.width,height:caveBuildingLevel.height},{onmousedown:function(){openUi(CaveManagementWindow)}},"pointer","caveBuildingLevel",this))}setBoundingBox(){this.boundingBox=this.context.canvas.getBoundingClientRect(),this.boundingBox.x/=uiScaleX,this.boundingBox.y/=uiScaleY,this.boundingBox.width/=uiScaleX,this.boundingBox.height/=uiScaleY}renderTopCity(){if(currentlyViewedDepth<4){if(0==hasUnlockedScientists?MAIN.drawImage(toplevel,0,currentlyViewedDepth/4*480,926,480-currentlyViewedDepth/4*480,Math.ceil(.082*mainw),Math.ceil(.111*mainh),Math.floor(.724*mainw),Math.floor(.712*mainh)*((4-currentlyViewedDepth)/4)):MAIN.drawImage(toplevel2,0,currentlyViewedDepth/4*480,926,480-currentlyViewedDepth/4*480,Math.ceil(.082*mainw),Math.ceil(.111*mainh),Math.floor(.724*mainw),Math.floor(.712*mainh)*((4-currentlyViewedDepth)/4)),MAIN.drawImage(animatedDrillCenter,animatedDrillCenter.width/2*getAnimationFrameIndex(2,10),0,animatedDrillCenter.width/2,animatedDrillCenter.height,Math.ceil(.6025*mainw),Math.floor(.712*mainh)*((4-currentlyViewedDepth)/4)-Math.ceil(.2515*mainh),.1723*mainw,.237*mainh),MAIN.fillStyle="#f4f5f4",MAIN.fillRect(Math.ceil(.642*mainw),Math.floor(.712*mainh)*((4-currentlyViewedDepth)/4)-Math.ceil(.239*mainh),.081*mainw,.037*mainh),MAIN.fillStyle="#000000",Math.floor(framesRendered2/68)%7==0?MAIN.drawImage(animatedMechanic,animatedMechanic.width/4*(Math.floor(framesRendered2/17)%4),0,animatedMechanic.width/4,animatedMechanic.height,Math.ceil(.648*mainw),Math.floor(.712*mainh)*((4-currentlyViewedDepth)/4)-Math.ceil(.1375*mainh),.0333*mainw,.055*mainh):MAIN.drawImage(animatedMechanic,0,0,animatedMechanic.width/4,animatedMechanic.height,Math.ceil(.648*mainw),Math.floor(.712*mainh)*((4-currentlyViewedDepth)/4)-Math.ceil(.1375*mainh),.0333*mainw,.055*mainh),Math.floor(framesRendered2/52)%11==3?MAIN.drawImage(animatedSeller,animatedSeller.width/4*(Math.floor(framesRendered2/13)%4),0,animatedSeller.width/4,animatedSeller.height,Math.ceil(.197*mainw),Math.floor(.712*mainh)*((4-currentlyViewedDepth)/4)-Math.ceil(.1375*mainh),.0333*mainw,.055*mainh):MAIN.drawImage(animatedSeller,0,0,animatedSeller.width/4,animatedSeller.height,Math.ceil(.197*mainw),Math.floor(.712*mainh)*((4-currentlyViewedDepth)/4)-Math.ceil(.1375*mainh),.0333*mainw,.055*mainh),Math.floor(framesRendered2/76)%13==5?MAIN.drawImage(animatedHirer,animatedHirer.width/4*(Math.floor(framesRendered2/19)%4),0,animatedHirer.width/4,animatedHirer.height,Math.ceil(.397*mainw),Math.floor(.712*mainh)*((4-currentlyViewedDepth)/4)-Math.ceil(.0895*mainh),.0333*mainw,.055*mainh):MAIN.drawImage(animatedHirer,0,0,animatedHirer.width/4,animatedHirer.height,Math.ceil(.397*mainw),Math.floor(.712*mainh)*((4-currentlyViewedDepth)/4)-Math.ceil(.0895*mainh),.0333*mainw,.055*mainh),MAIN.font="900 14px KanitM",fillTextShrinkToFit(MAIN,_("SELL CENTER"),Math.ceil(.192*mainw),Math.floor(.712*mainh)*((4-currentlyViewedDepth)/4)-Math.ceil(.215*mainh),.08*mainw,"center",.25),"german"==language&&(MAIN.font="12px KanitM"),"spanish"==language&&(MAIN.font="12px KanitM"),"japanese"==language&&(MAIN.font="12px KanitM"),"french"==language&&(MAIN.font="12px KanitM"),fillTextShrinkToFit(MAIN,_("HIRE CENTER"),Math.ceil(.392*mainw),Math.floor(.712*mainh)*((4-currentlyViewedDepth)/4)-Math.ceil(.167*mainh),.08*mainw,"center",.25),MAIN.font="900 14px KanitM","french"==language&&(MAIN.font="13px KanitM"),fillTextShrinkToFit(MAIN,_("CRAFT CENTER"),Math.ceil(.643*mainw),Math.floor(.712*mainh)*((4-currentlyViewedDepth)/4)-Math.ceil(.215*mainh),.08*mainw,"center",.25),MAIN.font="18px CFont",currentlyViewedDepth<2&&(MAIN.drawImage(questguy,0,0,62,54,Math.ceil(.625*mainw),Math.ceil(mainh*(.35-.179*currentlyViewedDepth)),Math.floor(.05*mainw),Math.floor(.08*mainh)),limitedTimeEventManager.isXmas()?MAIN.drawImage(hat5,64,0,32,48,Math.ceil(.63*mainw),Math.ceil(mainh*(.3365-.179*currentlyViewedDepth)),Math.floor(.028*mainw),Math.floor(.064*mainh)):limitedTimeEventManager.isHalloween()&&MAIN.drawImage(witchhat5,0,0,32,48,Math.ceil(.625*mainw),Math.ceil(mainh*(.336-.179*currentlyViewedDepth)),Math.floor(.032*mainw),Math.floor(.074*mainh))),currentlyViewedDepth<3&&(MAIN.save(),MAIN.fillStyle="#9D9D92",MAIN.strokeStyle="#000000",isHoveringOverGarage&&MAIN.drawImage(toplevel3,0,currentlyViewedDepth/4*480,926,480-currentlyViewedDepth/4*480,Math.ceil(.082*mainw),Math.ceil(.111*mainh),Math.floor(.724*mainw),Math.floor(.712*mainh)*((4-currentlyViewedDepth)/4)),showGarageSparkles&&depth>20&&(MAIN.globalAlpha=.25+.25*oscillate(numFramesRendered,17),MAIN.drawImage(garageSparkle,garageSparkle.width/2*(Math.floor(numFramesRendered/3)%2),0,garageSparkle.width/2,garageSparkle.height,Math.ceil(.53*mainw),Math.floor(.552*mainh)*((4-currentlyViewedDepth)/4),.09*mainw,.09*mainh),MAIN.globalAlpha=1),MAIN.lineWidth=2,MAIN.font="16px KanitM",MAIN.strokeText(tickets,Math.ceil(.588*mainw),Math.ceil(mainh*(.538-.179*currentlyViewedDepth))),MAIN.fillText(tickets,Math.ceil(.588*mainw),Math.ceil(mainh*(.538-.179*currentlyViewedDepth))),MAIN.restore()),chestCollectorChanceStructure.level>0&&chestCollectorStorageStructure.level>0){MAIN.save();var e=chestService.getTotalStoredChests()+"/"+chestService.getMaxStoredChests();MAIN.strokeStyle="#000000",MAIN.lineWidth=4,MAIN.fillStyle="#ffffff",MAIN.font="20px Verdana",MAIN.strokeText(e,Math.ceil(.14*mainw)-MAIN.measureText(e).width/2,Math.floor(.76*mainh)*((4-currentlyViewedDepth)/4)-Math.ceil(.12*mainh)),MAIN.fillText(e,Math.ceil(.14*mainw)-MAIN.measureText(e).width/2,Math.floor(.76*mainh)*((4-currentlyViewedDepth)/4)-Math.ceil(.12*mainh)),MAIN.font="12px Verdana",MAIN.fillStyle="#000000",MAIN.strokeStyle="#000000",MAIN.lineWidth=1;var i=chestCollectorChanceStructure.level+chestCollectorStorageStructure.level;i<4?MAIN.drawImage(collector1,0,0,150,160,Math.ceil(.081*mainw),Math.ceil(mainh*(.594-.179*currentlyViewedDepth)),Math.floor(.11*mainw),Math.floor(.22*mainh)):i>=4&&i<6?MAIN.drawImage(collector2,0,0,150,160,Math.ceil(.081*mainw),Math.ceil(mainh*(.594-.179*currentlyViewedDepth)),Math.floor(.11*mainw),Math.floor(.22*mainh)):i>=6&&i<8?MAIN.drawImage(collector3,0,0,150,160,Math.ceil(.081*mainw),Math.ceil(mainh*(.594-.179*currentlyViewedDepth)),Math.floor(.11*mainw),Math.floor(.22*mainh)):i>=8&&i<10?MAIN.drawImage(collector4,0,0,150,160,Math.ceil(.081*mainw),Math.ceil(mainh*(.594-.179*currentlyViewedDepth)),Math.floor(.11*mainw),Math.floor(.22*mainh)):i>=10&&MAIN.drawImage(collector5,0,0,150,160,Math.ceil(.081*mainw),Math.ceil(mainh*(.594-.179*currentlyViewedDepth)),Math.floor(.11*mainw),Math.floor(.22*mainh)),MAIN.restore()}if(metalDetectorStructure.level>0&&(1==metalDetectorStructure.level?(MAIN.drawImage(detector1,0,0,65,80,Math.ceil(.11*mainw),Math.ceil(mainh*(.65-.179*currentlyViewedDepth)),Math.floor(.05*mainw),Math.floor(.12*mainh)),Math.floor(numFramesRendered/4)%4==0&&chestService.hasUnclaimedChests()&&MAIN.drawImage(detectRed,0,0,65,80,Math.ceil(.11*mainw),Math.ceil(mainh*(.65-.179*currentlyViewedDepth)),Math.floor(.05*mainw),Math.floor(.12*mainh))):2==metalDetectorStructure.level?(MAIN.drawImage(detector2,0,0,65,80,Math.ceil(.11*mainw),Math.ceil(mainh*(.65-.179*currentlyViewedDepth)),Math.floor(.05*mainw),Math.floor(.12*mainh)),Math.floor(numFramesRendered/4)%4==0&&chestService.hasUnclaimedChests()&&MAIN.drawImage(detectRed,0,0,65,80,Math.ceil(.11*mainw),Math.ceil(mainh*(.65-.179*currentlyViewedDepth)),Math.floor(.05*mainw),Math.floor(.12*mainh))):3==metalDetectorStructure.level?(MAIN.drawImage(detector3,0,0,65,80,Math.ceil(.11*mainw),Math.ceil(mainh*(.65-.179*currentlyViewedDepth)),Math.floor(.05*mainw),Math.floor(.12*mainh)),Math.floor(numFramesRendered/4)%4==0&&chestService.hasUnclaimedChests()&&MAIN.drawImage(detectRed,0,0,65,80,Math.ceil(.1*mainw),Math.ceil(mainh*(.635-.179*currentlyViewedDepth)),Math.floor(.09*mainw),Math.floor(.12*mainh))):(MAIN.drawImage(detector4,0,0,65,80,Math.ceil(.11*mainw),Math.ceil(mainh*(.65-.179*currentlyViewedDepth))+mainh*(.005*oscillate(numFramesRendered+5,13)),Math.floor(.05*mainw),Math.floor(.12*mainh)),Math.floor(numFramesRendered/2)%4==0&&chestService.hasUnclaimedChests()&&MAIN.drawImage(detectRed,0,0,65,80,Math.ceil(.116*mainw),Math.ceil(mainh*(.655-.179*currentlyViewedDepth)),Math.floor(.05*mainw),Math.floor(.12*mainh)))),chestCompressorStructure.level>0){var t=0;clickedCompress&&(t=1,clickedCompress=!1),chestCompressorStructure.level<=2?MAIN.drawImage(compactor1,t*compactor1.width/2,0,compactor1.width/2,compactor1.height,Math.ceil(.17*mainw),Math.ceil(mainh*(.65-.179*currentlyViewedDepth)),Math.floor(.04*mainw),Math.floor(.15*mainh)):chestCompressorStructure.level<=4?MAIN.drawImage(compactor2,t*compactor2.width/2,0,compactor2.width/2,compactor2.height,Math.ceil(.17*mainw),Math.ceil(mainh*(.65-.179*currentlyViewedDepth)),Math.floor(.04*mainw),Math.floor(.15*mainh)):chestCompressorStructure.level<=6?MAIN.drawImage(compactor3,t*compactor3.width/2,0,compactor3.width/2,compactor3.height,Math.ceil(.17*mainw),Math.ceil(mainh*(.65-.179*currentlyViewedDepth)),Math.floor(.04*mainw),Math.floor(.15*mainh)):7==chestCompressorStructure.level?MAIN.drawImage(compactor4,t*compactor4.width/2,0,compactor4.width/2,compactor4.height,Math.ceil(.17*mainw),Math.ceil(mainh*(.65-.179*currentlyViewedDepth)),Math.floor(.04*mainw),Math.floor(.15*mainh)):chestCompressorStructure.level>=8&&MAIN.drawImage(compactor5,t*compactor5.width/2,0,compactor5.width/2,compactor5.height,Math.ceil(.17*mainw),Math.ceil(mainh*(.65-.179*currentlyViewedDepth)),Math.floor(.04*mainw),Math.floor(.15*mainh))}if(managerStructure.level>0&&(1==managerStructure.level?MAIN.drawImage(manager1,0,0,manager1.width,manager1.height,Math.ceil(.3*mainw),Math.ceil(mainh*(.55-.179*currentlyViewedDepth)),Math.floor(.05*mainw),Math.floor(.12*mainh)):2==managerStructure.level?MAIN.drawImage(manager2,0,0,manager2.width,manager2.height,Math.ceil(.3*mainw),Math.ceil(mainh*(.55-.179*currentlyViewedDepth)),Math.floor(.05*mainw),Math.floor(.12*mainh)):MAIN.drawImage(manager3,0,0,manager3.width,manager3.height,Math.ceil(.3*mainw),Math.ceil(mainh*(.55-.179*currentlyViewedDepth)),Math.floor(.05*mainw),Math.floor(.12*mainh))),0==currentlyViewedDepth){if(limitedTimeEventManager.isXmas())for(var a=0;a<17;a++)MAIN.drawImage(xmasLights,(a+Math.floor(framesRendered2/4))%4*xmasLights.width/4,0,xmasLights.width/4,xmasLights.height/3,.082*mainw+a*mainw*.052,.105*mainh,.052*mainw,.055*mainh);MAIN.drawImage(discordb,0,0,50,50,Math.ceil(.085*mainw),Math.ceil(.12*mainh),Math.floor(.025*mainw),Math.ceil(.045*mainh)),isEmailCollected()||MAIN.drawImage(emailb,0,0,emailb.width,emailb.height,Math.ceil(.085*mainw),Math.ceil(.1675*mainh),Math.floor(.025*mainw),Math.ceil(.045*mainh)),limitedTimeEventManager.isEventActive&&limitedTimeEventManager.activeEvent.displayCountdown&&(MAIN.drawImage(eventb,0,0,eventb.width,eventb.height,Math.ceil(.112*mainw),Math.ceil(.115*mainh),Math.floor(.13*mainw),Math.ceil(.08*mainh)),MAIN.save(),MAIN.font="12px Verdana",MAIN.fillStyle="#FFF",fillTextWrapWithHeightLimit(MAIN,limitedTimeEventManager.activeEvent.name+" <br> "+shortenedFormattedTime(limitedTimeEventManager.secondsRemainingInEvent()),Math.ceil(.132*mainw),Math.ceil(.115*mainh),Math.floor(.11*mainw),Math.ceil(.08*mainh),"center",.5,"bottom",!1),MAIN.restore()),depth>20&&null==document.getElementById("surveyDiv")&&(hasTakenSurveyCheck()||"true"==localStorage.isSurveyPending||1==localStorage.isSurveyPending?hasTakenSurveyCheck()&&isFlashQuestionSurveyPromptVisible()&&"true"!=localStorage.isServerSurveyPending&&1!=localStorage.isServerSurveyPending&&MAIN.drawImage(surveyb,0,0,surveyb.width,surveyb.height,Math.ceil(.085*mainw),Math.ceil(.215*mainh),Math.floor(.025*mainw),Math.ceil(.045*mainh)):MAIN.drawImage(surveyb,0,0,surveyb.width,surveyb.height,Math.ceil(.085*mainw),Math.ceil(.215*mainh),Math.floor(.025*mainw),Math.ceil(.045*mainh))),limitedTimeEventManager.isHalloween()&&MAIN.drawImage(spiderweb,0,0,spiderweb.width,spiderweb.height,.886*mainw,.112*mainh,.05*mainw,.1125*mainh)}}}isTradingPost(e){for(var i=0;i<tradeConfig.tradingPosts.length;++i)if(e==tradeConfig.tradingPosts[i].depth)return!0;return!1}isCore(e){return 501==e}renderTradingPost(){for(var e=0;e<tradeConfig.tradingPosts.length;++e)if(currentlyViewedDepth>=tradeConfig.tradingPosts[e].depth&&currentlyViewedDepth<tradeConfig.tradingPosts[e].depth+10){var i,t=Math.ceil(.082*mainw),a=.111*mainh+.178*(4-(currentlyViewedDepth-tradeConfig.tradingPosts[e].depth))*mainh;if(i=0==tradingPostStructures[e].level?tradeConfig.tradingPosts[e].unbuiltImage:tradeConfig.tradingPosts[e].image,MAIN.drawImage(i,t,a,Math.floor(.724*mainw),Math.ceil(.178*mainh)),saveCanvasState(MAIN),MAIN.font="11px KanitM",0!=tradingPostStructures[e].level&&(fillTextShrinkToFit(MAIN,_("TRADING POST"),t+tradeConfig.tradingPosts[e].buildingTextCoords.x,a+tradeConfig.tradingPosts[e].buildingTextCoords.y,Math.floor(.055*mainw),"center"),this.trades=getTradesForWorld(0),0==e&&isTradeAvailable(this.trades[0])&&isTradeAvailable(this.trades[1]))){var n=getTraderImage(0,this.trades[0][TRADE_INDEX_TRADER]);null!=n&&(MAIN.save(),MAIN.shadowBlur=5,MAIN.shadowColor="rgba(150, 150, 150, 0.75)",MAIN.drawImage(n,0,.1*n.height,n.width,.8*n.height,t+tradeConfig.tradingPosts[e].buildingTextCoords.x- -.005*mainw,a+tradeConfig.tradingPosts[e].buildingTextCoords.y+.0176*mainh,.038*mainw,.038*mainw*(n.width/n.height*.7)),MAIN.restore())}restoreCanvasState(MAIN)}}renderCaveBuilding(){if(currentlyViewedDepth>=CAVE_BUILDING_DEPTH&&currentlyViewedDepth<CAVE_BUILDING_DEPTH+10){var e=Math.ceil(.082*mainw),i=.111*mainh+.178*(4-(currentlyViewedDepth-CAVE_BUILDING_DEPTH))*mainh,t=Math.floor(.724*mainw),a=Math.ceil(.178*mainh);MAIN.drawImage(caveBuildingStuff,getAnimationFrameIndex(3,10)*caveBuildingStuff.width/3,0,caveBuildingStuff.width/3,caveBuildingStuff.height,e,i,t,a),MAIN.drawImage(caveBuildingLevel,e,i,t,a),MAIN.drawImage(caveBuildingBelt,getAnimationFrameIndex(3,10)*caveBuildingBelt.width/3,0,caveBuildingBelt.width/3,caveBuildingBelt.height,e,i,t,a),drawImageRot(MAIN,caveBuildingGear1,0,0,caveBuildingGear1.width,caveBuildingGear1.height,e+.525*t-t*caveBuildingGear1.width/caveBuildingLevel.width/2,i+.48*a-a*caveBuildingGear1.height/caveBuildingLevel.height/2,t*caveBuildingGear1.width/caveBuildingLevel.width,a*caveBuildingGear1.height/caveBuildingLevel.height,numFramesRendered%32*-11.25),drawImageRot(MAIN,caveBuildingGear2,0,0,caveBuildingGear2.width,caveBuildingGear2.height,e+.54*t-t*caveBuildingGear2.width/caveBuildingLevel.width/2,i+.72*a-a*caveBuildingGear2.height/caveBuildingLevel.height/2,t*caveBuildingGear2.width/caveBuildingLevel.width,a*caveBuildingGear2.height/caveBuildingLevel.height,numFramesRendered%16*22.5),drawImageRot(MAIN,caveBuildingGear3,0,0,caveBuildingGear3.width,caveBuildingGear3.height,e+.565*t-t*caveBuildingGear3.width/caveBuildingLevel.width/2,i+.68*a-a*caveBuildingGear3.height/caveBuildingLevel.height/2,t*caveBuildingGear3.width/caveBuildingLevel.width,a*caveBuildingGear3.height/caveBuildingLevel.height,numFramesRendered%24*-15),MAIN.drawImage(frontOfCaveBuildingDrone,getAnimationFrameIndex(2,2)*frontOfCaveBuildingDrone.width/2,0,frontOfCaveBuildingDrone.width/2,frontOfCaveBuildingDrone.height,e+.46*t,i+.48*a,.055*t,.38*a)}}renderCore(){if(currentlyViewedDepth>499&&currentlyViewedDepth<509){var e=Math.ceil(.082*mainw),i=.111*mainh+.178*(4-(currentlyViewedDepth-501))*mainh;MAIN.save(),isCoreWarped?MAIN.filter="hue-rotate("+(130+50*oscillate(numFramesRendered,20))+"deg) grayscale(67%) saturate(160%)":isCoreBlessed&&(MAIN.filter=" grayscale(75%) brightness("+(150+50*oscillate(numFramesRendered,20))+"%) saturate(160%)"),MAIN.drawImage(lavachasm,0,0,lavachasm.width,lavachasm.height,e,i,Math.floor(.724*mainw),Math.ceil(.178*mainh)),MAIN.restore(),MAIN.drawImage(coreEdges,0,0,coreEdges.width,coreEdges.height,e,i,Math.floor(.724*mainw),Math.ceil(.178*mainh)),saveCanvasState(MAIN),MAIN.font="11px KanitM",restoreCanvasState(MAIN)}}renderUndergroundCity(){if(currentlyViewedDepth>299&&currentlyViewedDepth<309){var e=.111*mainh+.178*(4-(currentlyViewedDepth-301))*mainh;Math.ceil(.082*mainw);MAIN.drawImage(bottomlevelnew,0,(currentlyViewedDepth-304)/4*480,926,480-(currentlyViewedDepth-304)/4*480,Math.ceil(.082*mainw),Math.ceil(.111*mainh),Math.floor(.724*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-304))/4)),MAIN.drawImage(undergroundcitylights,926*getAnimationFrameIndex(3,10),(currentlyViewedDepth-304)/4*480,926,480-(currentlyViewedDepth-304)/4*480,Math.ceil(.082*mainw),Math.ceil(.111*mainh),Math.floor(.724*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-304))/4)),MAIN.drawImage(undergroundcityfire,Math.floor(numFramesRendered/2)%4*150,0,150,undergroundcityfire.height,Math.ceil(.57*mainw),e+Math.ceil(.3*mainh),Math.floor(.117*mainw),Math.floor(.2*mainh)),MAIN.save(),currentTargetHitbox&&"weaponCrafting"==currentTargetHitbox.hitbox.id&&(MAIN.shadowBlur=8,MAIN.shadowColor="rgba(255, 255, 64, .5)"),MAIN.drawImage(undergroundcitystatue,0,0,926,undergroundcitystatue.height,Math.ceil(.082*mainw),e-Math.floor(.18*mainh),Math.floor(.724*mainw),Math.floor(.72*mainh)),MAIN.restore(),MAIN.save(),currentTargetHitbox&&"oilRig"==currentTargetHitbox.hitbox.id&&(MAIN.shadowBlur=8,MAIN.shadowColor="rgba(255, 255, 64, .5)"),isOilRigFull()?MAIN.drawImage(getOilRigAsset(),0,0,200,Oil_Extractor.height,Math.ceil(.35*mainw),e+Math.ceil(.17*mainh),Math.floor(.153*mainw),Math.floor(.325*mainh)):MAIN.drawImage(getOilRigAsset(),Math.floor(numFramesRendered/4)%4*200,0,200,Oil_Extractor.height,Math.ceil(.35*mainw),e+Math.ceil(.17*mainh),Math.floor(.153*mainw),Math.floor(.325*mainh)),MAIN.restore(),MAIN.save(),currentTargetHitbox&&"gemForge"==currentTargetHitbox.hitbox.id&&(MAIN.shadowBlur=8,MAIN.shadowColor="rgba(255, 255, 64, .5)");var i=undergroundcitygemassembler;2==gemForgeStructure.level?i=undergroundcitygemassembler2:3==gemForgeStructure.level?i=undergroundcitygemassembler3:4==gemForgeStructure.level?i=undergroundcitygemassembler4:5==gemForgeStructure.level?i=undergroundcitygemassembler5:gemForgeStructure.level>=6&&(i=undergroundcitygemassembler6),MAIN.drawImage(i,Math.floor(numFramesRendered/3)%4*350,0,350,undergroundcitygemassembler.height,Math.ceil(.082*mainw),e+Math.floor(.205*mainh),Math.floor(.273*mainw),Math.floor(.32*mainh)),MAIN.restore(),MAIN.drawImage(bottomlevelnewborder,0,(currentlyViewedDepth-304)/4*480,926,480-(currentlyViewedDepth-304)/4*480,Math.ceil(.082*mainw),Math.ceil(.111*mainh),Math.floor(.724*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-304))/4))}}renderEndOfWorld(){if(currentlyViewedDepth>999&&currentlyViewedDepth<1009){MAIN.drawImage(EndOfWorld,0,(currentlyViewedDepth-1004)/4*480,EndOfWorld.width,480-(currentlyViewedDepth-1004)/4*480,Math.ceil(.082*mainw),Math.ceil(.111*mainh),Math.floor(.855*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-1004))/4));var e=Math.ceil(.082*mainw),i=.111*mainh+.178*(4-(currentlyViewedDepth-1001))*mainh;depth>=1007||decimalDepth()<1000.1?drawImageRot(MAIN,idleFarmer,Math.floor(framesRendered2/2)%6*96,0,96,96,e+.55*mainw,i-.02*mainh,Math.ceil(.08*mainw),Math.floor(.16*mainh),180):drawImageRot(MAIN,shockedFarmer,Math.floor(framesRendered2/2)%2*96,0,96,96,e+.55*mainw,i-.02*mainh,Math.ceil(.08*mainw),Math.floor(.16*mainh),180)}if(currentlyViewedDepth>1003&&currentlyViewedDepth<1013&&MAIN.drawImage(blueSky,0,(currentlyViewedDepth-1008)/4*480,blueSky.width,480-(currentlyViewedDepth-1008)/4*480,Math.ceil(.082*mainw),Math.ceil(.111*mainh),Math.floor(.855*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-1008))/4)),currentlyViewedDepth>1007&&currentlyViewedDepth<1017&&MAIN.drawImage(blueSky2,0,(currentlyViewedDepth-1012)/4*480,blueSky.width,480-(currentlyViewedDepth-1012)/4*480,Math.ceil(.082*mainw),Math.ceil(.111*mainh),Math.floor(.855*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-1012))/4)),currentlyViewedDepth>1011&&currentlyViewedDepth<1021&&MAIN.drawImage(skySpaceTransition,0,(currentlyViewedDepth-1016)/4*480,skySpaceTransition.width,480-(currentlyViewedDepth-1016)/4*480,Math.ceil(.082*mainw),Math.ceil(.111*mainh),Math.floor(.855*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-1016))/4)),currentlyViewedDepth>1015&&currentlyViewedDepth<1025&&MAIN.drawImage(spaceWithStars,0,(currentlyViewedDepth-1020)/4*480,spaceWithStars.width,480-(currentlyViewedDepth-1020)/4*480,Math.ceil(.082*mainw),Math.ceil(.111*mainh),Math.floor(.855*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-1020))/4)),currentlyViewedDepth>1019&&currentlyViewedDepth<1029&&(MAIN.drawImage(spaceWithStars2,0,(currentlyViewedDepth-1024)/4*480,spaceWithStars2.width,480-(currentlyViewedDepth-1024)/4*480,Math.ceil(.082*mainw),Math.ceil(.111*mainh),Math.floor(.855*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-1024))/4)),isUfoVisible())){i=.111*mainh+.178*(4-(currentlyViewedDepth-1019))*mainh;MAIN.drawImage(worldUfo,worldUfo.width/4*getAnimationFrameIndex(3,10),0,worldUfo.width/4,worldUfo.height,Math.ceil(.35*mainw)+Math.floor(oscillate(numFramesRendered,79)*Math.ceil(.33*mainw)),i+Math.ceil(.17*mainh)+Math.floor(oscillate(numFramesRendered,31)*Math.ceil(.05*mainw)),Math.floor(.075*mainw),Math.floor(.14*mainh))}currentlyViewedDepth>1023&&currentlyViewedDepth<1033&&MAIN.drawImage(spaceWithStars3,0,(currentlyViewedDepth-1028)/4*480,spaceWithStars3.width,480-(currentlyViewedDepth-1028)/4*480,Math.ceil(.082*mainw),Math.ceil(.111*mainh),Math.floor(.855*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-1028))/4)),currentlyViewedDepth>1782&&currentlyViewedDepth<1792&&MAIN.drawImage(EndOfMoon,0,(currentlyViewedDepth-1787)/4*480,EndOfWorld.width,480-(currentlyViewedDepth-1787)/4*480,Math.ceil(.082*mainw),Math.ceil(.111*mainh),Math.floor(.855*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-1787))/4)),currentlyViewedDepth>1786&&currentlyViewedDepth<1796&&MAIN.drawImage(spaceWithStars4,0,(currentlyViewedDepth-1791)/4*480,spaceWithStars4.width,480-(currentlyViewedDepth-1791)/4*480,Math.ceil(.082*mainw),Math.ceil(.111*mainh),Math.floor(.855*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-1791))/4)),currentlyViewedDepth>1790&&currentlyViewedDepth<1800&&MAIN.drawImage(spaceWithStars2,0,(currentlyViewedDepth-1795)/4*480,spaceWithStars2.width,480-(currentlyViewedDepth-1795)/4*480,Math.ceil(.082*mainw),Math.ceil(.111*mainh),Math.floor(.855*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-1795))/4)),currentlyViewedDepth>1794&&currentlyViewedDepth<1804&&MAIN.drawImage(spaceWithStars5,0,(currentlyViewedDepth-1799)/4*480,spaceWithStars5.width,480-(currentlyViewedDepth-1799)/4*480,Math.ceil(.082*mainw),Math.ceil(.111*mainh),Math.floor(.855*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-1799))/4)),currentlyViewedDepth>1798&&currentlyViewedDepth<1808&&MAIN.drawImage(spaceWithStars5,0,(currentlyViewedDepth-1803)/4*480,spaceWithStars5.width,480-(currentlyViewedDepth-1803)/4*480,Math.ceil(.082*mainw),Math.ceil(.111*mainh),Math.floor(.855*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-1803))/4)),currentlyViewedDepth>1802&&currentlyViewedDepth<1812&&MAIN.drawImage(spaceWithStars5,0,(currentlyViewedDepth-1807)/4*480,spaceWithStars5.width,480-(currentlyViewedDepth-1807)/4*480,Math.ceil(.082*mainw),Math.ceil(.111*mainh),Math.floor(.855*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-1807))/4)),currentlyViewedDepth>1805&&currentlyViewedDepth<1815&&MAIN.drawImage(spaceWithStars6,0,(currentlyViewedDepth-1810)/4*480,spaceWithStars6.width,480-(currentlyViewedDepth-1810)/4*480,Math.ceil(.082*mainw),Math.ceil(.114*mainh),Math.floor(.855*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-1810))/4))}renderMoonbase(){currentlyViewedDepth>1027&&currentlyViewedDepth<1037&&(MAIN.drawImage(lunarBase,0,(currentlyViewedDepth-1032)/4*480,lunarBase.width,480-(currentlyViewedDepth-1032)/4*480,Math.ceil(.082*mainw),Math.ceil(.111*mainh),Math.floor(.855*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-1032))/4)),MAIN.fillStyle="#000000",MAIN.font="14px KanitM",fillTextShrinkToFit(MAIN,_("SELL CENTER"),Math.ceil(.193*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-1032))/4)-Math.ceil(.215*mainh),.08*mainw,"center",.25),"german"==language&&(MAIN.font="12px KanitM"),"spanish"==language&&(MAIN.font="12px KanitM"),"japanese"==language&&(MAIN.font="12px KanitM"),"french"==language&&(MAIN.font="12px KanitM"),fillTextShrinkToFit(MAIN,_("HIRE CENTER"),Math.ceil(.391*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-1032))/4)-Math.ceil(.167*mainh),.08*mainw,"center",.25),MAIN.font="14px KanitM","french"==language&&(MAIN.font="13px KanitM"),fillTextShrinkToFit(MAIN,_("CRAFT CENTER"),Math.ceil(.642*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-1032))/4)-Math.ceil(.215*mainh),.08*mainw,"center",.25))}renderTitanbase(){currentlyViewedDepth>1809&&currentlyViewedDepth<1819&&(MAIN.drawImage(titanBase,0,(currentlyViewedDepth-1814)/4*480,titanBase.width,480-(currentlyViewedDepth-1814)/4*480,Math.ceil(.082*mainw),Math.ceil(.112*mainh),Math.floor(.855*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-1814))/4)),MAIN.fillStyle="#000000",MAIN.font="14px KanitM",fillTextShrinkToFit(MAIN,_("SELL CENTER"),Math.ceil(.193*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-1814))/4)-Math.ceil(.215*mainh),.08*mainw,"center",.25),"german"==language&&(MAIN.font="12px KanitM"),"spanish"==language&&(MAIN.font="12px KanitM"),"japanese"==language&&(MAIN.font="12px KanitM"),"french"==language&&(MAIN.font="12px KanitM"),fillTextShrinkToFit(MAIN,_("HIRE CENTER"),Math.ceil(.391*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-1814))/4)-Math.ceil(.167*mainh),.08*mainw,"center",.25),MAIN.font="14px KanitM","french"==language&&(MAIN.font="13px KanitM"),fillTextShrinkToFit(MAIN,_("CRAFT CENTER"),Math.ceil(.642*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-1814))/4)-Math.ceil(.215*mainh),.08*mainw,"center",.25))}renderReactor(){if(currentlyViewedDepth>REACTOR_DEPTH-1&&currentlyViewedDepth<REACTOR_DEPTH+10){var e=.111*mainh+.178*(4-(currentlyViewedDepth-REACTOR_DEPTH+1))*mainh,i=Math.ceil(.082*mainw),t=0,a=0,n=0,h=reactor1;1==reactorStructure.level?(h=reactor1,t=.34,a=.67,n=.178*mainh*2*.7):2==reactorStructure.level?(h=reactor2,t=.385,a=.73,n=.178*mainh*2*.65):3==reactorStructure.level?(h=reactor3,t=.485,a=.75,n=.178*mainh*2*.7):4==reactorStructure.level?(h=reactor4,t=.485,a=.78,n=.178*mainh*2*.62):reactorStructure.level>=5&&(h=reactor5,t=.725,a=.9,n=.178*mainh*2*.5);var r=h.width/4;MAIN.drawImage(reactor_level,0,(currentlyViewedDepth-REACTOR_DEPTH-4)/4*480,926,480-(currentlyViewedDepth-REACTOR_DEPTH-4)/4*480,Math.ceil(.082*mainw),Math.ceil(.111*mainh),Math.floor(.724*mainw),Math.floor(.712*mainh)*((4-(currentlyViewedDepth-REACTOR_DEPTH-4))/4));var l=Math.floor(.724*mainw*t),o=Math.floor(.178*mainh*2*a),d=(.724*mainw-l)/2;MAIN.drawImage(h,r*(Math.floor(numFramesRendered/2)%4),0,r,h.height,i+d,e+n,l,o)}}renderBuffLab(){if(currentlyViewedDepth>REACTOR_DEPTH-1&&currentlyViewedDepth<REACTOR_DEPTH+10){var e=Math.ceil(.082*mainw),i=.111*mainh+.178*(4-(currentlyViewedDepth-REACTOR_DEPTH-2))*mainh;MAIN.drawImage(lunarbackground,e,i,Math.floor(.724*mainw),Math.ceil(.178*mainh)),MAIN.drawImage(lab_bg,e,i,Math.floor(.724*mainw),Math.ceil(.178*mainh)),MAIN.drawImage(lab1,Math.floor(numFramesRendered/4)%4*926,0,926,lab1.height,Math.ceil(.085*mainw),i,Math.floor(.7*mainw),Math.floor(.178*mainh)),MAIN.save();var t=.3975*Math.floor(.7*mainw),a=.2675*Math.floor(.178*mainh),n=.115*Math.floor(.7*mainw),h=.13*Math.floor(.178*mainh);MAIN.font=h+"px KanitM",MAIN.textBaseline="middle",MAIN.fillStyle="#000000",fillTextShrinkToFit(MAIN,_("BUFF LAB"),e+t,i+a,n,"center"),MAIN.restore()}}renderSuperMinerBuilding(){if(currentlyViewedDepth>=SUPER_MINER_DEPTH&&currentlyViewedDepth<=SUPER_MINER_DEPTH+4){var e=Math.ceil(.082*mainw),i=.111*mainh+.178*(4-(currentlyViewedDepth-SUPER_MINER_DEPTH))*mainh;if(MAIN.drawImage(superMinerLevel,0,0,superMinerLevel.width,superMinerLevel.height,e,i,Math.floor(.724*mainw),Math.floor(.179*mainh)),!superMinerManager.recievedInitialSuperMiner){let t=Math.ceil(.475*mainw),a=.205*mainh+.178*(4-(currentlyViewedDepth-SUPER_MINER_DEPTH))*mainh;MAIN.drawImage(superMinerLevelChest,0,0,superMinerLevelChest.width,superMinerLevelChest.height,t,a,relativeWidth(superMinerLevelChest),relativeHeight(superMinerLevelChest));let n=1500;this.context.globalAlpha=.5*oscillate(currentTime(),n),MAIN.drawImage(superMinerLevelGlow,0,0,superMinerLevelGlow.width,superMinerLevelGlow.height,e,i,Math.floor(.724*mainw),Math.floor(.179*mainh)),this.context.globalAlpha=1}var t=.46*Math.floor(.7*mainw),a=.18*Math.floor(.178*mainh),n=.09*Math.floor(.7*mainw),h=.13*Math.floor(.178*mainh);MAIN.font=h+"px KanitM",MAIN.fillStyle="#000000",fillTextShrinkToFit(MAIN,_("SUPER MINERS"),e+t,i+a,n,"center")}}renderDrill(){if(currentlyViewedDepth>=depth-1&&(depth>1e3&&depth<1032||depth>1783&&depth<1813)&&!BattleManager.isStalledDueToBoss()&&!isWaitingForLiftoff()){var e=Math.ceil(.532*mainh)+Math.floor(.234*mainh)*subTickDistancePercent();currentlyViewedDepth==depth-1&&(e+=Math.ceil(.234*mainh)),MAIN.drawImage(rocketDrillFlames,168*getAnimationFrameIndex(4,10),0,168,158,Math.ceil(.805*mainw),e-Math.ceil(.062*mainh),Math.ceil(.131*mainw),Math.floor(.234*mainh)),MAIN.drawImage(drillState.drill().worldAsset,168*getAnimationFrameIndex(4,10),0,168,158,Math.ceil(.805*mainw),e,Math.ceil(.131*mainw),Math.floor(.234*mainh)),MAIN.drawImage(drillState.engine().worldAsset,168*getAnimationFrameIndex(4,10),0,168,158,Math.ceil(.805*mainw),e,Math.ceil(.131*mainw),Math.floor(.234*mainh))}else currentlyViewedDepth==depth&&(saveCanvasState(MAIN),MAIN.strokeStyle="#000000",MAIN.fillStyle="#999999",MAIN.fillRect(Math.ceil(.815*mainw),Math.ceil(.72*mainh),Math.ceil(.111*mainw),Math.ceil(.02*mainh)),MAIN.fillStyle="#333333",MAIN.fillRect(Math.ceil(.815*mainw),Math.ceil(.72*mainh),Math.ceil(.111*mainw)*Math.min(1,divideBigNumberToDecimalNumber(progressTowardsNextDepth,depthDifficultyTable[depth])),Math.ceil(.02*mainh)),MAIN.strokeRect(Math.ceil(.815*mainw),Math.ceil(.72*mainh),Math.ceil(.111*mainw),Math.ceil(.02*mainh)),BattleManager.isStalledDueToBoss()||isWaitingForLiftoff()?(MAIN.drawImage(drillState.drill().worldAsset,0,0,168,158,Math.ceil(.805*mainw),Math.ceil(.766*mainh),Math.ceil(.131*mainw),Math.floor(.234*mainh)),MAIN.drawImage(drillState.engine().worldAsset,0,0,168,158,Math.ceil(.805*mainw),Math.ceil(.766*mainh),Math.ceil(.131*mainw),Math.floor(.234*mainh))):(MAIN.drawImage(drillState.drill().worldAsset,168*getAnimationFrameIndex(4,10),0,168,158,Math.ceil(.805*mainw),Math.ceil(.766*mainh),Math.ceil(.131*mainw),Math.floor(.234*mainh)),MAIN.drawImage(drillState.engine().worldAsset,168*getAnimationFrameIndex(4,10),0,168,158,Math.ceil(.805*mainw),Math.ceil(.766*mainh),Math.ceil(.131*mainw),Math.floor(.234*mainh))),restoreCanvasState(MAIN))}renderSingleLevelOfDepth(e){var i=Math.ceil(.082*mainw),t=.111*mainh+.178*(4-(currentlyViewedDepth-e))*mainh;isDepthWithoutWorkers(e)||(this.renderBackgroundForDepth(e,i,t),this.renderBackgroundDecalsForDepth(e,i,t),this.renderBackgroundEffectsForDepth(e,i,t),this.renderLevelImageForDepth(e,i,t),this.renderLightsForDepth(e,t),this.renderKmTextForDepth(e,i,t),BattleManager.isActiveBossLevel(e)||this.renderWorkersForDepth(e,t)),(1e3==e&&0==hasLaunched||1783==e&&1==hasLaunched)&&isWaitingForLiftoff()&&!isLaunching&&renderButton(MAIN,upgradeb,_("LAUNCH"),i+.74*mainw,t-.18*mainh,.1*mainw,.04*mainh,"18px Verdana","#000000")}renderBackgroundForDepth(e,i,t){if(e<1e3){if(!isDepthWithoutWorkers(e)&&!this.isTradingPost(e)&&!this.isCore(e))for(var a=0;a<52;a++)backgroundGemPattern[e%15][a]>0&&MAIN.drawImage(wallgems,20*(backgroundGemPattern[e%15][a]-1+5*(levels[e][0][0]-1)),0,20,120,i+Math.floor(mainw*(.016*a)),t,Math.floor(.016*mainw),Math.ceil(.178*mainh))}else e>=1032&&MAIN.drawImage(lunarbackground,0,0,926,120,i,t,Math.floor(.724*mainw),Math.ceil(.178*mainh))}renderBackgroundDecalsForDepth(e,i,t){50==e&&MAIN.drawImage(crack,40-40*Math.ceil(numFramesRendered%16/15),0,40,120,i+.038*mainw,t,Math.floor(.032*mainw),Math.ceil(.178*mainh)),100!=e||0!=chestCollectorChanceStructure.level&&0!=chestCollectorStorageStructure.level||MAIN.drawImage(collector1,0,0,collector1.width,collector1.height,i+Math.floor(.57*mainw),t+Math.floor(-.06*mainh),Math.floor(.11*mainw),Math.floor(.22*mainh)),112==e&&MAIN.drawImage(mime,0,0,mime.width,mime.height,i+Math.floor(.12*mainw),t+Math.floor(.04*mainh),Math.floor(.16*mainw),Math.ceil(.073*mainh)),225==e&&MAIN.drawImage(robot,Math.floor(numFramesRendered/3)%4*30,0,30,120,i+.048*mainw,t+.054*mainh,Math.floor(.032*mainw),Math.ceil(.178*mainh)),1257==e&&MAIN.drawImage(Lunar_Robot,Math.floor(numFramesRendered/3)%4*40,0,40,160,i+.048*mainw,t+.053*mainh,Math.floor(.03*mainw),Math.ceil(.14*mainh))}renderBackgroundEffectsForDepth(e,i,t){battleWaiting[1]==e&&MAIN.drawImage(pulsered,Math.floor(9*oscillate(numFramesRendered,9)),0,1,1,i,t,Math.floor(.7*mainw),Math.ceil(.178*mainh)),!chestService.chestExistsAtDepth(e)||0==e&&activeLayers.hasOwnProperty("Chest")||MAIN.drawImage(pulseyellow,Math.floor(9*oscillate(numFramesRendered,9)),0,1,1,i,t,Math.floor(.7*mainw),Math.ceil(.178*mainh))}renderLevelImageForDepth(e,i,t){0==e?MAIN.drawImage(level,0,0,926,120,i,t-1,Math.floor(.724*mainw),Math.ceil(.18*mainh)):e<100?MAIN.drawImage(level,0,0,926,120,i,t,Math.floor(.724*mainw),Math.ceil(.178*mainh)):e<200?MAIN.drawImage(level2,0,0,926,120,i,t,Math.floor(.724*mainw),Math.ceil(.178*mainh)):e<300?MAIN.drawImage(level3,0,0,926,120,i,t,Math.floor(.724*mainw),Math.ceil(.178*mainh)):e<400?MAIN.drawImage(level4,0,0,926,120,i,t,Math.floor(.724*mainw),Math.ceil(.178*mainh)):e<1e3?(MAIN.drawImage(brown,0,0,1,1,i,t,Math.floor(.724*mainw),4),BattleManager.isActiveBossLevel(e)?MAIN.drawImage(BattleManager.getBossLevelAsset(e),0,0,926,120,i,t,Math.floor(.724*mainw),Math.ceil(.178*mainh)):e<900?MAIN.drawImage(level5,0,0,926,120,i,t,Math.floor(.724*mainw),Math.ceil(.178*mainh)):MAIN.drawImage(level6,0,0,926,120,i,t,Math.floor(.724*mainw),Math.ceil(.178*mainh))):depth>=1e3&&(1032==e?MAIN.drawImage(lunarlevel2,0,0,926,120,i,t-1,Math.floor(.724*mainw),Math.ceil(.18*mainh)):BattleManager.isActiveBossLevel(e)?MAIN.drawImage(BattleManager.getBossLevelAsset(e),0,0,926,120,i,t,Math.floor(.724*mainw),Math.ceil(.178*mainh)):e<1132?MAIN.drawImage(lunarlevel2,0,0,926,120,i,t,Math.floor(.724*mainw),Math.ceil(.178*mainh)):e<1432?MAIN.drawImage(lunarlevel1,0,0,926,120,i,t,Math.floor(.724*mainw),Math.ceil(.178*mainh)):e<1532?MAIN.drawImage(lunarlevel4,0,0,926,120,i,t,Math.floor(.724*mainw),Math.ceil(.178*mainh)):e>=1532&&e<=1782?MAIN.drawImage(lunarlevel3,0,0,926,120,i,t,Math.floor(.724*mainw),Math.ceil(.178*mainh)):e<1914?MAIN.drawImage(titanlevel4,0,0,926,120,i,t,Math.floor(.724*mainw),Math.ceil(.178*mainh)):e<=2014&&MAIN.drawImage(titanlevel1,0,0,926,120,i,t,Math.floor(.724*mainw),Math.ceil(.178*mainh)))}renderLightsForDepth(e,i){0==worldBeingViewed().index?limitedTimeEventManager.isHalloween()?MAIN.drawImage(halloweenlight,0,0,926,120,Math.ceil(mainw*(.072+e%7%3*.003)),i,Math.floor(.724*mainw),Math.ceil(.178*mainh)):MAIN.drawImage(light,0,0,926,120,Math.ceil(mainw*(.072+e%7%3*.003)),i,Math.floor(.724*mainw),Math.ceil(.178*mainh)):1==worldBeingViewed().index?MAIN.drawImage(lunarlight,0,0,926,120,Math.ceil(mainw*(.072+e%7%3*.003)),i,Math.floor(.724*mainw),Math.ceil(.178*mainh)):2==worldBeingViewed().index&&MAIN.drawImage(titanlight,0,0,926,120,Math.ceil(mainw*(.072+e%7%3*.003)),i,Math.floor(.724*mainw),Math.ceil(.178*mainh))}renderKmTextForDepth(e,i,t){MAIN.save(),MAIN.fillStyle="#FFFFFF",MAIN.font="18px CFont",MAIN.lineWidth=3,e<1032?MAIN.fillText(e+"Km",i+Math.ceil(.01*mainw),t+Math.ceil(.022*mainh)):e<1813?MAIN.fillText(e-1032+"Km",i+Math.ceil(.01*mainw),t+Math.ceil(.022*mainh)):MAIN.fillText(e-1814+"Km",i+Math.ceil(.01*mainw),t+Math.ceil(.022*mainh)),MAIN.restore()}renderWorkersForDepth(e,i){var t=[];if(chestService.chestExistsAtDepth(e)&&(0!=e||!activeLayers.hasOwnProperty("Chest"))){var a=workersLevelAtDepth(e);let h=chestService.getChestsAtDepth(e);for(var n=chestService.getChestsAtDepth(e).length;n>0;n--){let r=h[n-1];r.type==ChestType.gold?e<1e3?a<5?MAIN.drawImage(found2,32*getAnimationFrameIndex(4,10),0,32,96,Math.ceil(mainw*(.085+.072*(r.worker-1))),i,Math.ceil(.025*mainw),Math.floor(.142*mainh)):MAIN.drawImage(window["found"+a],32*getAnimationFrameIndex(4,10),0,32,96,Math.ceil(mainw*(.085+.072*(r.worker-1))),i,Math.ceil(.025*mainw),Math.floor(.142*mainh)):MAIN.drawImage(foundm2,32*getAnimationFrameIndex(4,10),0,32,96,Math.ceil(mainw*(.085+.072*(r.worker-1))),i,Math.ceil(.025*mainw),Math.floor(.142*mainh)):r.type==ChestType.black?e<1e3?a<5?MAIN.drawImage(foundb,32*getAnimationFrameIndex(4,10),0,32,96,Math.ceil(mainw*(.085+.072*(r.worker-1))),i,Math.ceil(.025*mainw),Math.floor(.142*mainh)):MAIN.drawImage(window["foundb"+a],32*getAnimationFrameIndex(4,10),0,32,96,Math.ceil(mainw*(.085+.072*(r.worker-1))),i,Math.ceil(.025*mainw),Math.floor(.142*mainh)):MAIN.drawImage(foundmb,32*getAnimationFrameIndex(4,10),0,32,96,Math.ceil(mainw*(.085+.072*(r.worker-1))),i,Math.ceil(.025*mainw),Math.floor(.142*mainh)):e<1e3?a<5?MAIN.drawImage(foundt,32*getAnimationFrameIndex(4,10),0,32,96,Math.ceil(mainw*(.085+.072*(r.worker-1))),i,Math.ceil(.025*mainw),Math.floor(.142*mainh)):MAIN.drawImage(window["foundt"+a],32*getAnimationFrameIndex(4,10),0,32,96,Math.ceil(mainw*(.085+.072*(r.worker-1))),i,Math.ceil(.025*mainw),Math.floor(.142*mainh)):MAIN.drawImage(foundmt,32*getAnimationFrameIndex(4,10),0,32,96,Math.ceil(mainw*(.085+.072*(r.worker-1))),i,Math.ceil(.025*mainw),Math.floor(.142*mainh)),t.push(r.worker)}}for(var h=currentlyViewedDepth-e,r=workersHiredAtDepth(e),l=(a=workersLevelAtDepth(e),1);l<=r;l++)if(!t.includes(l)){if(isCapacityFull())e<1e3?(MAIN.drawImage(minerImages[a],0,0,32,48,Math.ceil(mainw*(.085+.072*(l-1))),i+Math.floor(.075*mainh),Math.ceil(.025*mainw),Math.floor(.071*mainh)),MAIN.drawImage(minerHatImages[a],0,0,32,48,Math.ceil(mainw*(.085+.072*(l-1))),i+Math.floor(.075*mainh),Math.ceil(.025*mainw),Math.floor(.071*mainh))):e<=1782?8==l&&1089==e?drawImageRot(MAIN,lunarMinerImages[a],0,0,32,48,Math.ceil(mainw*(.085+.072*(l-1))),i+Math.floor(.075*mainh),Math.ceil(.025*mainw),Math.floor(.071*mainh),180):MAIN.drawImage(lunarMinerImages[a],0,0,32,48,Math.ceil(mainw*(.085+.072*(l-1))),i+Math.floor(.075*mainh),Math.ceil(.025*mainw),Math.floor(.071*mainh)):e>=getTitan().startDepth&&MAIN.drawImage(titanMinerImages[a],0,0,32,48,Math.ceil(mainw*(.085+.072*(l-1))),i+Math.floor(.075*mainh),Math.ceil(.025*mainw),Math.floor(.071*mainh));else{var o,d=getAnimationFrameIndex(this.minerFrames,IDLE_FRAMERATE,l-1+e);e<1e3?o=minerImages[a]:e<=1782?o=lunarMinerImages[a]:e>=getTitan().startDepth&&(o=titanMinerImages[a]);var m=[(this.minerFrameWidth+this.minerFrameSpacing)*d,0,32,o.height,Math.ceil(mainw*(.085+.072*(l-1))),i+Math.floor(.075*mainh),Math.ceil(.025*mainw),Math.floor(.071*mainh)];8==l&&1089==e?drawImageRot(MAIN,o,...m,180):(MAIN.drawImage(o,...m),e<1e3&&MAIN.drawImage(minerHatImages[a],...m))}if(l==battleWaiting[0]&&battleWaiting[1]==e&&e>303&&MAIN.drawImage(Exclamation,0,0,40,40,Math.ceil(mainw*(.091+.072*(l-1))),i+Math.floor(.045*mainh),Math.ceil(.015*mainw),Math.floor(.02*mainh)),1==quality){var w=found[h][0][l-1],c=found[h][1][l-1];if(w>-1&&c>=1){MAIN.globalAlpha=MINERAL_COLLECTED_POPUP_ALPHA_SEQUENCE[c];var M=MINERAL_COLLECTED_POPUP_OFFSET_SEQUENCE[c];MAIN.drawImage(worldResources[w+1].smallIcon,0,0,worldResources[w+1].smallIcon.width,worldResources[w+1].smallIcon.height,Math.ceil(mainw*(.085+.072*(l-1)))+Math.ceil(.006*mainw),i+Math.floor(.045*mainh)+M,Math.ceil(.012*mainw),Math.floor(.021*mainh)),MAIN.globalAlpha=1,found[h][1][l-1]--}}}if(t=[],isClickableAtDepth(e)){var s=getClickableAtDepth(e),u=s.spawnLocation;s.renderAssetFunction(mainw*(.109+.072*(u-1)),i+Math.floor(.0575*mainh),s)}}renderForegroundLightingForDepth(e){if(e>0&&depthTintOverlays.length>e){var i=Math.ceil(.082*mainw),t=.111*mainh+.178*(4-(currentlyViewedDepth-e))*mainh,a=depthTintOverlays[e];drawRgbColoredRect(MAIN,i,t,Math.floor(.855*mainw),.178*mainh,a.r,a.g,a.b,a.a)}}renderForeground(e){if(MAIN.save(),currentlyViewedDepth>getTitan().startDepth-4&&e>getTitan().startDepth-3){var i=.111*mainh+.178*(4-(currentlyViewedDepth-e))*mainh;e%4==0&&e%8!=0&&e%12!=0?(MAIN.drawImage(waves2,waves2.width/4*getAnimationFrameIndex(4,10),0,waves2.width/4,waves2.height,Math.ceil(.3*mainw),Math.floor(i),Math.ceil(mainw*(waves2.width/4/mainw)),Math.ceil(mainh*(waves2.height/mainh))),MAIN.drawImage(bubbles5,bubbles5.width/4*getAnimationFrameIndex(4,10),0,bubbles5.width/4,bubbles5.height,Math.ceil(.7*mainw),Math.floor(i),Math.ceil(mainw*(bubbles5.width/4/mainw)),Math.ceil(mainh*(bubbles5.height/mainh)))):e%5==0&&e%10!=0?(MAIN.drawImage(waves1,waves1.width/4*getAnimationFrameIndex(4,10),0,waves1.width/4,waves1.height,Math.ceil(.1*mainw),Math.floor(i),Math.ceil(mainw*(waves1.width/4/mainw)),Math.ceil(mainh*(waves1.height/mainh))),MAIN.drawImage(bubbles1,bubbles1.width/4*getAnimationFrameIndex(4,10),0,bubbles1.width/4,bubbles1.height,Math.ceil(.4*mainw),Math.floor(i),Math.ceil(mainw*(bubbles1.width/4/mainw)),Math.ceil(mainh*(bubbles1.height/mainh)))):e%6==0&&e%12!=0?(MAIN.drawImage(waves2,waves2.width/4*getAnimationFrameIndex(4,10),0,waves2.width/4,waves2.height,Math.ceil(.7*mainw),Math.floor(i),Math.ceil(mainw*(waves2.width/4/mainw)),Math.ceil(mainh*(waves2.height/mainh))),MAIN.drawImage(bubbles1,bubbles1.width/4*getAnimationFrameIndex(4,10),0,bubbles1.width/4,bubbles1.height,Math.ceil(.2*mainw),Math.floor(i),Math.ceil(mainw*(bubbles1.width/4/mainw)),Math.ceil(mainh*(bubbles1.height/mainh))),MAIN.drawImage(bubbles4,bubbles4.width/4*getAnimationFrameIndex(4,10),0,bubbles4.width/4,bubbles4.height,Math.ceil(.3*mainw),Math.floor(i),Math.ceil(mainw*(bubbles4.width/4/mainw)),Math.ceil(mainh*(bubbles4.height/mainh)))):e%7==0&&e%14!=0?(MAIN.drawImage(waves3,waves3.width/4*getAnimationFrameIndex(4,10),0,waves3.width/4,waves3.height,Math.ceil(.4*mainw),Math.floor(i),Math.ceil(mainw*(waves3.width/4/mainw)),Math.ceil(mainh*(waves3.height/mainh))),MAIN.drawImage(bubbles2,bubbles2.width/4*getAnimationFrameIndex(4,10),0,bubbles2.width/4,bubbles2.height,Math.ceil(.2*mainw),Math.floor(i),Math.ceil(mainw*(bubbles2.width/4/mainw)),Math.ceil(mainh*(bubbles2.height/mainh)))):e%8==0&&e%16!=0?(MAIN.drawImage(waves4,waves4.width/4*getAnimationFrameIndex(4,10),0,waves4.width/4,waves4.height,Math.ceil(.6*mainw),Math.floor(i),Math.ceil(mainw*(waves4.width/4/mainw)),Math.ceil(mainh*(waves4.height/mainh))),MAIN.drawImage(bubbles1,bubbles1.width/4*getAnimationFrameIndex(4,10),0,bubbles1.width/4,bubbles1.height,Math.ceil(.8*mainw),Math.floor(i),Math.ceil(mainw*(bubbles1.width/4/mainw)),Math.ceil(mainh*(bubbles1.height/mainh))),MAIN.drawImage(bubbles2,bubbles2.width/4*getAnimationFrameIndex(4,10),0,bubbles2.width/4,bubbles2.height,Math.ceil(.3*mainw),Math.floor(i),Math.ceil(mainw*(bubbles2.width/4/mainw)),Math.ceil(mainh*(bubbles2.height/mainh)))):e%10==0?(MAIN.drawImage(waves3,waves3.width/4*getAnimationFrameIndex(4,10),0,waves3.width/4,waves3.height,Math.ceil(.2*mainw),Math.floor(i),Math.ceil(mainw*(waves3.width/4/mainw)),Math.ceil(mainh*(waves3.height/mainh))),MAIN.drawImage(bubbles4,bubbles4.width/4*getAnimationFrameIndex(4,10),0,bubbles4.width/4,bubbles4.height,Math.ceil(.85*mainw),Math.floor(i),Math.ceil(mainw*(bubbles4.width/4/mainw)),Math.ceil(mainh*(bubbles4.height/mainh)))):e%12==0?(MAIN.drawImage(bubbles1,bubbles1.width/4*getAnimationFrameIndex(4,10),0,bubbles1.width/4,bubbles1.height,Math.ceil(.2*mainw),Math.floor(i),Math.ceil(mainw*(bubbles1.width/4/mainw)),Math.ceil(mainh*(bubbles1.height/mainh))),MAIN.drawImage(bubbles2,bubbles2.width/4*getAnimationFrameIndex(4,10),0,bubbles2.width/4,bubbles2.height,Math.ceil(.8*mainw),Math.floor(i),Math.ceil(mainw*(bubbles2.width/4/mainw)),Math.ceil(mainh*(bubbles2.height/mainh)))):e%13==0&&e%6!=0?MAIN.drawImage(waves3,waves3.width/4*getAnimationFrameIndex(4,10),0,waves3.width/4,waves3.height,Math.ceil(.4*mainw),Math.floor(i),Math.ceil(mainw*(waves3.width/4/mainw)),Math.ceil(mainh*(waves3.height/mainh))):e%14==0?MAIN.drawImage(waves4,waves4.width/4*getAnimationFrameIndex(4,10),0,waves4.width/4,waves4.height,Math.ceil(.4*mainw),Math.floor(i),Math.ceil(mainw*(waves4.width/4/mainw)),Math.ceil(mainh*(waves4.height/mainh))):e%16==0&&(MAIN.drawImage(waves1,waves1.width/4*getAnimationFrameIndex(4,10),0,waves1.width/4,waves1.height,Math.ceil(.6*mainw),Math.floor(i),Math.ceil(mainw*(waves1.width/4/mainw)),Math.ceil(mainh*(waves1.height/mainh))),MAIN.drawImage(bubbles5,bubbles5.width/4*getAnimationFrameIndex(4,10),0,bubbles5.width/4,bubbles5.height,Math.ceil(.6*mainw),Math.floor(i),Math.ceil(mainw*(bubbles5.width/4/mainw)),Math.ceil(mainh*(bubbles5.height/mainh))))}MAIN.restore()}renderBackground(){currentlyViewedDepth<1005?(MAIN.drawImage(drilldiv2,0,0,167,600,Math.ceil(.082*mainw),Math.ceil(.111*mainh),Math.ceil(.723*mainw),mainh),currentlyViewedDepth==depth?MAIN.drawImage(drilldiv,0,0,167,600,Math.ceil(.805*mainw),Math.ceil(.111*mainh),Math.ceil(.131*mainw),Math.floor(.89*mainh)):(MAIN.clearRect(Math.ceil(.805*mainw),Math.ceil(.111*mainh),Math.ceil(.131*mainw),Math.floor(.89*mainh)),MAIN.drawImage(drilldiv2,0,0,167,600,Math.ceil(.805*mainw),Math.ceil(.111*mainh),Math.ceil(.131*mainw),Math.floor(.89*mainh)))):(MAIN.drawImage(lunardrilldiv2,0,0,167,600,Math.ceil(.082*mainw),Math.ceil(.111*mainh),Math.ceil(.723*mainw),mainh),currentlyViewedDepth==depth?MAIN.drawImage(lunardrilldiv,0,0,167,600,Math.ceil(.805*mainw),Math.ceil(.111*mainh),Math.ceil(.131*mainw),Math.floor(.89*mainh)):(MAIN.clearRect(Math.ceil(.805*mainw),Math.ceil(.111*mainh),Math.ceil(.131*mainw),Math.floor(.89*mainh)),MAIN.drawImage(lunardrilldiv2,0,0,167,600,Math.ceil(.805*mainw),Math.ceil(.111*mainh),Math.ceil(.131*mainw),Math.floor(.89*mainh))))}render(){this.renderBackground(),this.renderTopCity(),this.renderTradingPost(),this.renderCore(),this.renderUndergroundCity(),this.renderEndOfWorld(),this.renderMoonbase(),this.renderTitanbase(),this.renderReactor(),this.renderBuffLab(),this.renderSuperMinerBuilding();for(var e=currentlyViewedDepth-4;e<=currentlyViewedDepth;e++)this.renderSingleLevelOfDepth(e);this.renderDrill();for(e=currentlyViewedDepth-4;e<=currentlyViewedDepth;e++)this.renderForegroundLightingForDepth(e);this.renderCaveBuilding(),this.updateWorldEntityHitboxLocations();for(e=currentlyViewedDepth-4;e<=currentlyViewedDepth;e++)this.renderForeground(e);superMinerManager.render(),this.renderChildren()}updateWorldEntityHitboxLocations(){this.previouslyViewedDepth!=currentlyViewedDepth&&(this.previouslyViewedDepth=currentlyViewedDepth,this.hitboxYOffset=.178*currentlyViewedDepth*mainh*-1/uiScaleY)}}