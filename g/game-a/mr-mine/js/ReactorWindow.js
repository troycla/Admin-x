class ReactorWindow extends TabbedPopupWindow{layerName="Reactor";domElementId="REACTORD";context=REACTOR;widthHeightPerCell;blueprintPane;blueprintPaneDefaultWidth;blueprintListHitboxes;reactorLayouts;craftingPane;isCraftingPaneInitialized=!1;selectedBlueprint;craftCategory=6;constructor(t,e=0){super(t),t||this.setBoundingBox(),this.context.imageSmoothingEnabled=!1,this.setFrameImagesByWorldIndex(MOON_INDEX),this.currentTabIndex=e;var i={0:_("Reactor"),1:_("Craft"),2:_("Upgrade")};this.initializeTabs(Object.values(i)),this.reactorPane=new Hitbox({x:0,y:0,width:this.boundingBox.width,height:this.boundingBox.height},{},"","reactorPane"),this.reactorPane.allowBubbling=!0,this.addHitbox(this.reactorPane),this.reactorLayouts=new Hitbox({x:0,y:0,width:this.boundingBox.width,height:this.boundingBox.height},{},"","reactorLayouts"),this.reactorLayouts.render=function(){var t=this.parent.context;this.getRelativeCoordinates(0,0,this.parent);t.save(),t.strokeStyle="#000000",t.textBaseline="bottom",t.lineWidth=3,t.font="20px Verdana",t.fillStyle="#FFFFFF",t.fillText(_("Current Layout"),.3*this.boundingBox.width-t.measureText(_("Current Layout")).width/2,.15*this.boundingBox.height,this.boundingBox.width),t.font="18px KanitB",t.fillStyle="#000000",t.drawImage(upgradeb,.45*this.boundingBox.width,.12*this.boundingBox.height,.2*this.boundingBox.width,.04*this.boundingBox.height),t.fillText(_("View Layout"),.55*this.boundingBox.width-.5*t.measureText(_("View Layout")).width,.12*this.boundingBox.height+21),t.drawImage(upgradeb,.68*this.boundingBox.width,.12*this.boundingBox.height,.2*this.boundingBox.width,.04*this.boundingBox.height),t.fillText(_("Save Layout"),.78*this.boundingBox.width-.5*t.measureText(_("Save Layout")).width,.12*this.boundingBox.height+21);for(var e=0;e<savedReactorLayouts.length;e++)if(savedReactorLayouts[e].length>0){var i=.06*(e+2);t.font="20px Verdana",t.fillStyle="#FFFFFF",t.fillText(savedReactorLayoutNames[e],.3*this.boundingBox.width-t.measureText(savedReactorLayoutNames[e]).width/2,this.boundingBox.height*(.15+i),this.boundingBox.width),t.font="18px KanitB",t.fillStyle="#000000",t.drawImage(upgradeb,.45*this.boundingBox.width,this.boundingBox.height*(.12+i),.2*this.boundingBox.width,.04*this.boundingBox.height),t.fillText(_("Load Layout"),.55*this.boundingBox.width-.5*t.measureText(_("Load Layout")).width,this.boundingBox.height*(.12+i)+21),t.drawImage(upgradeb,.68*this.boundingBox.width,this.boundingBox.height*(.12+i),.2*this.boundingBox.width,.04*this.boundingBox.height),t.fillText(_("Delete Layout"),.78*this.boundingBox.width-.5*t.measureText(_("Delete Layout")).width,this.boundingBox.height*(.12+i)+21)}t.restore()},this.reactorLayouts.allowBubbling=!0,this.addHitbox(this.reactorLayouts),this.blueprintPaneDefaultWidth=.4*this.bodyContainer.boundingBox.width,this.blueprintPane=new Scrollbox(this.blueprintPaneDefaultWidth-15,this.bodyContainer.boundingBox.height,this.context,this.bodyContainer.boundingBox.x,this.bodyContainer.boundingBox.y,this.blueprintPaneDefaultWidth,this.bodyContainer.boundingBox.height,15),this.addHitbox(this.blueprintPane),this.craftingPane=new Hitbox({x:this.blueprintPaneDefaultWidth,y:0,width:this.bodyContainer.boundingBox.width-this.blueprintPaneDefaultWidth,height:this.bodyContainer.boundingBox.height},{},"","craftingPane"),this.craftingPane.render=function(){var t=this.parent.parent.context,e=this.getRelativeCoordinates(0,0,this.parent.parent);t.save(),t.fillStyle="#444444",t.fillRect(e.x,e.y,3,this.boundingBox.height),this.renderChildren()},this.craftingPane.allowBubbling=!0,this.bodyContainer.addHitbox(this.craftingPane),this.initializeReactorLayouts(),this.initializeBlueprintList(),this.initializeCraftingPane(),this.upgradePane=new Hitbox({x:0,y:0,width:this.boundingBox.width,height:this.boundingBox.height},{},"","upgradePane"),this.upgradePane.allowBubbling=!0,this.addHitbox(this.upgradePane),this.onTabChange()}onTabChange(){this.selectedBlueprint=null,this.blueprintListHitboxes=[],0==this.currentTabIndex?(this.reactorPane.setVisible(!0),this.reactorPane.setEnabled(!0),this.craftingPane.setVisible(!1),this.craftingPane.setEnabled(!1),this.blueprintPane.setVisible(!1),this.blueprintPane.setEnabled(!1),this.upgradePane.setVisible(!1),this.upgradePane.setEnabled(!1),this.reactorLayouts.setVisible(!1),this.reactorLayouts.setEnabled(!1),this.initializeReactorHitboxes()):1==this.currentTabIndex?(this.reactorPane.setVisible(!1),this.reactorPane.setEnabled(!1),this.craftingPane.setVisible(!0),this.craftingPane.setEnabled(!0),this.blueprintPane.setVisible(!0),this.blueprintPane.setEnabled(!0),this.upgradePane.setEnabled(!1),this.upgradePane.setEnabled(!1),this.reactorLayouts.setVisible(!1),this.reactorLayouts.setEnabled(!1),this.blueprintPane.scrollTo(0),this.initializeBlueprintList(),this.initializeCraftingPane(),this.blueprintPane.contentHeight=1,this.blueprintPane.clearCanvas(),this.blueprintPane.initializeScrollbar()):2==this.currentTabIndex&&(this.reactorPane.setVisible(!1),this.reactorPane.setEnabled(!1),this.craftingPane.setVisible(!1),this.craftingPane.setEnabled(!1),this.blueprintPane.setVisible(!1),this.blueprintPane.setEnabled(!1),this.upgradePane.setEnabled(!0),this.upgradePane.setEnabled(!0),this.reactorLayouts.setVisible(!1),this.reactorLayouts.setEnabled(!1),this.initializeReactorUpgradeHitboxes())}initializeReactorHitboxes(){this.reactorPane.clearHitboxes(),this.craftingPane.clearHitboxes(),this.blueprintPane.clearHitboxes(),this.upgradePane.clearHitboxes(),this.reactorLayouts.clearHitboxes();var t=new Hitbox({x:.33*this.boundingBox.width,y:.17*this.boundingBox.height,width:.75*this.boundingBox.width,height:.62*this.boundingBox.height},{},"","reactorGrid");t.allowBubbling=!0,this.reactorPane.addHitbox(t),this.widthHeightPerCell=.07*Math.min(this.boundingBox.width,this.boundingBox.height);for(var e=0;e<MAX_REACTOR_CELLS_ROWS;e++)for(var i=0;i<MAX_REACTOR_CELLS_COLUMNS;i++){var n=new ReactorGridCell({x:this.widthHeightPerCell*i,y:this.widthHeightPerCell*e,width:this.widthHeightPerCell,height:this.widthHeightPerCell},e,i);if(t.addHitbox(n),reactor.grid.grid[e][i]!=EMPTY_INTEGER_VALUE){var o=new ReactorComponentUI({x:0,y:0,width:this.widthHeightPerCell,height:this.widthHeightPerCell},reactor.grid.grid[e][i]);o.gridSlotX=i,o.gridSlotY=e,o.isOnGrid=!0,n.addHitbox(o)}}var r=new Hitbox({x:.1*this.boundingBox.width,y:.17*this.boundingBox.height,width:.16*this.boundingBox.width,height:.62*this.boundingBox.height},{},"","inventoryPane");r.allowBubbling=!0,this.reactorPane.addHitbox(r);for(e=1;e<reactorComponents.length;e++){var a=reactor.getTypeForSlot(e),s=new ReactorInventorySlot({x:(e-1)%3*this.widthHeightPerCell,y:Math.floor((e-1)/3)*this.widthHeightPerCell,width:this.widthHeightPerCell,height:this.widthHeightPerCell},e);if(r.addHitbox(s),a>-1){var h=new ReactorComponentUI({x:0,y:0,width:this.widthHeightPerCell,height:this.widthHeightPerCell},a);h.isOnGrid=!1,s.addHitbox(h)}}this.reactorPane.addHitbox(new Hitbox({x:.1*this.boundingBox.width,y:.12*this.boundingBox.height,width:.8*this.boundingBox.width,height:.04*this.boundingBox.height},{onmouseenter:function(){reactor.isAbleToRun()||showTooltip(_("Reactor is unable to run"),reactor.getReasonForNotRunning(),mouseX,mouseY,180)},onmouseexit:function(){hideTooltip()}},"pointer","reactorStats")),this.reactorPane.addHitbox(new Button(upgradeb,_("Reactor Layouts"),"18px KanitM","#000000",{x:.49*this.boundingBox.width,y:.82*this.boundingBox.height,width:.2*this.boundingBox.width,height:.04*this.boundingBox.height},{onmousedown:function(){d.setVisible(!1),l.setVisible(!1),this.parent.setVisible(!1),this.parent.setEnabled(!1),this.parent.clearHitboxes(),this.parent.parent.initializeReactorLayouts(),this.parent.parent.reactorLayouts.setVisible(!0),this.parent.parent.reactorLayouts.setEnabled(!0)}}));var d=new Hitbox({x:.1*this.boundingBox.width,y:.9*this.boundingBox.height,width:.8*this.boundingBox.width,height:.04*this.boundingBox.height},{},"","reactorNotRunningReason");d.render=function(t){if(0==t.currentTabIndex&&!reactor.isAbleToRun()&&0==this.parent.reactorLayouts._isVisible){t.context.save(),t.context.strokeStyle="#000000",t.context.fillStyle="#DD5555",t.context.textBaseline="bottom",t.context.lineWidth=3,t.context.font="20px Verdana";var e=this.getRelativeCoordinates(0,0,t);strokeTextShrinkToFit(t.context,reactor.getReasonForNotRunning(),e.x,e.y,this.boundingBox.width,"center"),fillTextShrinkToFit(t.context,reactor.getReasonForNotRunning(),e.x,e.y,this.boundingBox.width,"center"),t.context.restore()}}.bind(d,this),d.allowBubbling=!0,this.addHitbox(d);var l=new Hitbox({x:.34*this.boundingBox.width,y:.14*this.boundingBox.height,width:.5*this.boundingBox.width,height:.14*this.boundingBox.height},{},"","reactorStats");l.render=function(t){if(0==t.currentTabIndex&&0==this.parent.reactorLayouts._isVisible){t.context.save(),t.context.strokeStyle="#000000",t.context.textBaseline="bottom",t.context.lineWidth=3,t.context.font="20px Verdana",t.context.fillStyle=reactor.isRunning?"#FFFFFF":"#DD5555";var e=this.getRelativeCoordinates(0,0,t);strokeTextShrinkToFit(t.context,reactor.getReactorStats(),e.x,e.y,this.boundingBox.width,"center"),fillTextShrinkToFit(t.context,reactor.getReactorStats(),e.x,e.y,this.boundingBox.width,"center"),t.context.restore()}}.bind(l,this),l.allowBubbling=!0,this.addHitbox(l)}initializeReactorUpgradeHitboxes(){this.reactorPane.clearHitboxes(),this.craftingPane.clearHitboxes(),this.blueprintPane.clearHitboxes(),this.upgradePane.clearHitboxes(),this.reactorLayouts.clearHitboxes()}render(){if(this.context.save(),this.context.clearRect(0,0,this.boundingBox.width,this.boundingBox.height),this.context.restore(),0==this.currentTabIndex&&(this.context.imageSmoothingEnabled=!0,super.render(),this.context.imageSmoothingEnabled=!1),1==this.currentTabIndex){if(this.context.save(),this.context.clearRect(0,0,this.boundingBox.width,this.boundingBox.height),isKnownBlueprintsDirty&&(this.initializeBlueprintList(),isKnownBlueprintsDirty=!1),this.blueprintListHitboxes.length>0){for(var t=1;t<this.blueprintListHitboxes.length;++t)this.blueprintListHitboxes[t].boundingBox.y!=this.blueprintListHitboxes[t-1].boundingBox.y+this.blueprintListHitboxes[t-1].boundingBox.height+2&&(this.blueprintListHitboxes[t].boundingBox.y=this.blueprintListHitboxes[t-1].boundingBox.y+this.blueprintListHitboxes[t-1].boundingBox.height+2);var e=this.blueprintListHitboxes[t-1].boundingBox.y+this.blueprintListHitboxes[t-1].boundingBox.height+2;e!=this.blueprintPane.contentHeight&&(this.blueprintPane.contentHeight=e,this.blueprintPane.initializeScrollbar(),this.blueprintPane.render(),this.blueprintPane.scrollTo(this.blueprintPane.currentScrollY))}this.context.restore(),super.render()}if(2==this.currentTabIndex){if(super.render(),this.context.save(),this.context.fillStyle="#FFFFFF",this.context.strokeStyle="#000000",this.context.textBaseline="bottom",this.context.lineWidth=3,reactor.isAtMaxLevel()){var i=_("You Are At the Max Level");this.context.strokeText(i,.5*this.boundingBox.width-this.context.measureText(i).width/2,.4*this.boundingBox.height),this.context.fillText(i,.5*this.boundingBox.width-this.context.measureText(i).width/2,.4*this.boundingBox.height)}else{var n=_("CURRENT"),o=_("Reactor Level: {0}",reactorStructure.level);this.context.font="bold 20px Verdana",this.context.strokeText(n,.25*this.boundingBox.width-this.context.measureText(n).width/2,.5*this.boundingBox.height),this.context.fillText(n,.25*this.boundingBox.width-this.context.measureText(n).width/2,.5*this.boundingBox.height),this.context.font="20px Verdana",this.context.strokeText(o,.25*this.boundingBox.width-this.context.measureText(o).width/2,.57*this.boundingBox.height),this.context.fillText(o,.25*this.boundingBox.width-this.context.measureText(o).width/2,.57*this.boundingBox.height),this.drawReactorGrid(.1*this.boundingBox.width,.14*this.boundingBox.height,.3*this.boundingBox.width,.3*this.boundingBox.height,reactorStructure.level);n=_("NEXT LEVEL"),o=_("Reactor Level: {0}",reactorStructure.level+1);this.context.font="bold 20px Verdana",this.context.strokeText(n,.75*this.boundingBox.width-this.context.measureText(n).width/2,.5*this.boundingBox.height),this.context.fillText(n,.75*this.boundingBox.width-this.context.measureText(n).width/2,.5*this.boundingBox.height),this.context.font="20px Verdana",this.context.strokeText(o,.75*this.boundingBox.width-this.context.measureText(o).width/2,.57*this.boundingBox.height),this.context.fillText(o,.75*this.boundingBox.width-this.context.measureText(o).width/2,.57*this.boundingBox.height),this.drawReactorGrid(.6*this.boundingBox.width,.14*this.boundingBox.height,.3*this.boundingBox.width,.3*this.boundingBox.height,reactorStructure.level+1)}this.context.restore()}}drawReactorGrid(t,e,i,n,o){this.context.save(),this.context.strokeStyle="#333333",this.context.lineWidth=1;for(var r=0;r<REACTOR_LAYOUTS[o].length;r++)for(var a=0;a<REACTOR_LAYOUTS[o][r].length;a++)0==REACTOR_LAYOUTS[o][r][a]?this.context.fillStyle="#AAAAAA":this.context.fillStyle="#FFFFFF",this.context.fillRect(t+r*i/MAX_REACTOR_CELLS_ROWS,e+a*n/MAX_REACTOR_CELLS_COLUMNS,i/MAX_REACTOR_CELLS_ROWS,n/MAX_REACTOR_CELLS_COLUMNS),this.context.strokeRect(t+r*i/MAX_REACTOR_CELLS_ROWS,e+a*n/MAX_REACTOR_CELLS_COLUMNS,i/MAX_REACTOR_CELLS_ROWS,n/MAX_REACTOR_CELLS_COLUMNS);this.context.restore()}initializeReactorLayouts(){var t=this.reactorLayouts;t.clearHitboxes(),t.addHitbox(new Hitbox({x:.45*this.boundingBox.width,y:.12*this.boundingBox.height,width:.2*this.boundingBox.width,height:.04*this.boundingBox.height},{onmousedown:function(){openUi(ReactorWindow)}},"pointer","viewLayout")),t.addHitbox(new Hitbox({x:.68*this.boundingBox.width,y:.12*this.boundingBox.height,width:.2*this.boundingBox.width,height:.04*this.boundingBox.height},{onmousedown:function(){showSimpleInput(_("Enter layout name"),_("Save layout"),"",function(t){saveReactorLayout(reactor.grid.grid),hideSimpleInput(),t.initializeReactorLayouts()}.bind(null,this.parent.parent),_("Cancel"),18)}},"pointer","saveLayout")),this.loadLayoutHitBoxes()}loadLayoutHitBoxes(){for(var t=this.reactorLayouts,e=0;e<savedReactorLayouts.length;e++)if(savedReactorLayouts[e].length>0){var i=.06*(e+2);t.addHitbox(new Hitbox({x:.45*this.boundingBox.width,y:this.boundingBox.height*(.12+i),width:.2*this.boundingBox.width,height:.04*this.boundingBox.height},{onmousedown:this.loadReactorButtonClicked(e)},"pointer","loadLayout_"+e)),t.addHitbox(new Hitbox({x:.68*this.boundingBox.width,y:this.boundingBox.height*(.12+i),width:.2*this.boundingBox.width,height:.04*this.boundingBox.height},{onmousedown:this.deleteReactorLayout(e)},"pointer","deleteLayout_"+e))}}loadReactorButtonClicked(t){return function(){var e=0;reactor.grid.fuelCellRemainingEnergy.forEach((t=>{e+=t.remainingEnergy})),e>0?showConfirmationPrompt(_("Your reactor contains unused fuel rods are you sure you want to delete them?"),_("Yes, Delete them"),function(t,e){t.loadReactor(e),hideSimpleInput()}.bind(null,this.parent.parent,t),_("Cancel")):this.parent.parent.loadReactor(t)}}loadReactor(t){loadReactorLayout(t),this.reactorPane.setVisible(!0),this.reactorPane.setEnabled(!0),this.reactorLayouts.setEnabled(!1),this.reactorLayouts.setVisible(!1),this.initializeReactorHitboxes(),redrawInventoryAndGrid()}deleteReactorLayout(t){return function(){showConfirmationPrompt(_("Are you sure you want to delete this layout?"),_("Yes"),function(t,e){savedReactorLayouts.splice(e,1),savedReactorLayouts[9]=[],savedReactorLayoutNames.splice(e,1),savedReactorLayoutNames[9]="",t.reactorLayouts.deleteHitboxWithId("loadLayout_"+e),t.reactorLayouts.deleteHitboxWithId("deleteLayout_"+e),t.initializeReactorLayouts(),hideSimpleInput()}.bind(null,this.parent.parent,t),_("Cancel"))}}initializeBlueprintList(t=[]){var e=this.blueprintPane;for(var i in e.clearHitboxes(),this.blueprintListHitboxes)this.blueprintListHitboxes[i].isCollapsed||t.push(i);this.blueprintListHitboxes=[];var n,o=0;if(1==this.currentTabIndex){n=getKnownBlueprints();var r=filterBlueprintsByCategory(n,this.craftCategory);r=sortBlueprintsBySubcategory(r)}for(var a in r){var s=new CollapsibleMenu(e.context,0,o,e.boundingBox.width-e.scrollbarWidth,40,0,a,"18px Verdana","#FFFFFF");this.generateSubcategoryMenuContents(r[a],s),this.blueprintListHitboxes.push(s),e.addHitbox(s),o+=s.boundingBox.height}if(t.length>0)for(var i in t)this.blueprintListHitboxes[t[i]]&&this.blueprintListHitboxes[t[i]].expand();else 1==this.blueprintListHitboxes.length&&this.blueprintListHitboxes[0].expand();e.isDirty=!0}generateSubcategoryMenuContents(t,e){var i=Math.min(50,Math.floor(.117*this.boundingBox.height)),n=Math.floor((e.boundingBox.width-6)/i),o=Math.ceil(t.length/n),r=(e.boundingBox.width-6-i*n)/(n-1);e.canvas.height=o*(i+r)+6,e.expandedHeight=e.canvas.height+e.collapsedHeight,e.context.save(),e.showNotificationIcon=!1;for(var a=0;a<t.length;++a){var s=t[a];if(s){var h=3+a%n*(i+r),d=3+Math.floor(a/n)*(i+r);if(drawImageFitInBox(e.context,getSingleColoredPixelImage("#CCCCCC",.55),h,d,i,i),drawImageFitInBox(e.context,s.craftedItem.item.getIcon(),h,d,i,i),this.selectedBlueprint==s&&(e.context.strokeStyle="#76E374",e.context.lineWidth=3,e.context.beginPath(),e.context.strokeRect(h+e.context.lineWidth,d+e.context.lineWidth,i-2*e.context.lineWidth,i-2*e.context.lineWidth),e.context.stroke()),isBlueprintUnseen(s.category,s.id)){e.showNotificationIcon=!0;e.context.fillStyle="#FF0000",e.context.strokeStyle="#FFFFFF",e.context.lineWidth=2,e.context.beginPath(),e.context.arc(h+i-5,d+5,5,0,2*Math.PI),e.context.fill(),e.context.stroke()}e.context.fillStyle="#FFFFFF";var l=Math.min(16,.037*this.boundingBox.height);e.context.font=l+"px Verdana",e.context.textBaseline="bottom",e.context.lineWidth=3,e.context.strokeStyle="#000000",strokeTextShrinkToFit(e.context,"",h,d+i,i,"right"),fillTextShrinkToFit(e.context,"",h,d+i,i,"right");var g=new Hitbox({x:h,y:d+e.collapsedHeight,width:i,height:i},{onmousedown:function(t){this.selectedBlueprint=t,this.initializeCraftingPane()}.bind(this,s),onmouseenter:function(t,e,i){var n=this.getGlobalCoordinates(e,i);showTooltip(_(t.craftedItem.item.getName()),_(t.craftedItem.item.getDescription()),n.x*uiScaleX,n.y*uiScaleY,200)}.bind(e,s,h,d+i+e.collapsedHeight),onmouseexit:function(){hideTooltip()}},"pointer");e.addHitbox(g,!0)}}e.context.restore()}initializeCraftingPane(){if(this.selectedBlueprint){1==this.currentTabIndex&&isBlueprintUnseen(this.selectedBlueprint.category,this.selectedBlueprint.id)&&flagBlueprintAsSeen(this.selectedBlueprint.category,this.selectedBlueprint.id),this.initializeBlueprintList(),this.craftingPane.clearHitboxes();var t=isBlueprintKnown(this.selectedBlueprint.category,this.selectedBlueprint.id),e=isBlueprintAvailable(this.selectedBlueprint.category,this.selectedBlueprint.id),i=Math.min(55,Math.floor(.128*this.boundingBox.height)),n=i/10,o=new Hitbox({x:20,y:0,width:this.craftingPane.boundingBox.width-40,height:i+2*n},{},"");o.render=function(t){var e=t.getContext(),o=this.getRelativeCoordinates(0,0,t);e.save(),e.globalAlpha=.6,e.fillStyle="#111111",e.fillRect(o.x,o.y,this.boundingBox.width,this.boundingBox.height),e.globalAlpha=1;var r=Math.min(22,.051*t.boundingBox.height);e.font=r+"px KanitM",e.fillStyle="#FFFFFF",e.textBaseline="top",fillTextWrap(e,t.selectedBlueprint.craftedItem.item.getName(),o.x+i+4*n,o.y+n,this.boundingBox.width-i-5*n,"left",.25),e.restore(),this.renderChildren()}.bind(o,this);var r=new Hitbox({x:n,y:n,width:i,height:i},{onmouseenter:function(t,e,i){var n=this.getGlobalCoordinates(e,i),o=getRawIngredientsForBlueprint(t);_("Requires");for(var r in o)r+": "+o[r]+"<br>";showTooltip(_(t.craftedItem.item.getName()),t.craftedItem.item.getDescription(),n.x*uiScaleX,n.y*uiScaleY,200)}.bind(o,this.selectedBlueprint,n,n+i),onmouseexit:function(){hideTooltip()}},"pointer");r.render=function(t){var e=this.getContext(),n=t.selectedBlueprint,o=this.getRelativeCoordinates(0,0,t);drawImageFitInBox(e,getSingleColoredPixelImage("#CCCCCC",1),o.x,o.y,i,i),drawImageFitInBox(e,n.craftedItem.item.getIcon(),o.x,o.y,i,i),e.fillStyle="#FFFFFF";var r=Math.min(16,.037*t.boundingBox.height);e.font=r+"px Verdana",e.textBaseline="bottom",e.lineWidth=3,e.strokeStyle="#000000",strokeTextShrinkToFit(e,"",o.x,o.y+i,i,"right"),fillTextShrinkToFit(e,"",o.x,o.y+i,i,"right")}.bind(r,this);var a=Math.min(16,.037*this.boundingBox.height),s=new Hitbox({x:20,y:a+o.boundingBox.y+o.boundingBox.height+n,width:o.boundingBox.width,height:3*n+2*i+a},{},"","ingredients");s.render=function(t){var e=this.getContext(),i=this.getRelativeCoordinates(0,0,t);e.save(),1==t.currentTabIndex&&(e.globalAlpha=.6,e.fillStyle="#111111",e.fillRect(i.x,i.y+6*a,this.boundingBox.width,this.boundingBox.height-5*a),e.globalAlpha=1,e.fillStyle="#FFFFFF",e.font=a+"px KanitM",fillTextWrap(e,t.selectedBlueprint.craftedItem.item.getDescription(),i.x,i.y,t.boundingBox.width,"left",.05),e.fillText(_("Ingredients"),i.x,i.y+6*a)),e.restore(),this.renderChildren()}.bind(s,this);var h=Math.floor((s.boundingBox.width-2*n)/i),d=(s.boundingBox.width-2*n-i*h)/(h-1);if(t||e){var l=6*a,g=getBlueprintIngredients(this.craftCategory,this.selectedBlueprint.id);for(var u in g){var c=n+u%h*(i+d),x=n+Math.floor(u/h)*(i+d);(B=new Hitbox({x:c,y:x+l,width:i,height:i},{onmouseenter:function(t,e,n){var o=this.getGlobalCoordinates(e,n);showTooltip(_(t.item.getName()),_("Owned: {0}<br>Required: {1}",beautifynum(t.item.getQuantityOwned()),beautifynum(t.quantity)),(o.x+i)*uiScaleX,o.y*uiScaleY)}.bind(s,g[u],c,x+i+a),onmouseexit:function(){hideTooltip()}},"pointer")).render=function(t,e){var n=this.getContext(),o=this.getRelativeCoordinates(0,0,t);drawImageFitInBox(n,e.item.getIcon(),o.x,o.y,i,i),n.fillStyle="#FFFFFF";var r=Math.min(16,.037*t.boundingBox.height);n.font=r+"px Verdana",n.textBaseline="bottom",n.lineWidth=3,n.strokeStyle="#000000",strokeTextShrinkToFit(n,shortenNum(e.quantity),o.x,o.y+i,.95*i,"right"),fillTextShrinkToFit(n,shortenNum(e.quantity),o.x,o.y+i,.95*i,"right"),e.item.hasQuantity(e.quantity)?renderCheckmark(n,o.x,o.y,i/5,i/5):renderXMark(n,o.x,o.y,i/5,i/5)}.bind(B,this,g[u]),s.addHitbox(B)}var b=new Hitbox({x:20,y:a+o.boundingBox.y+o.boundingBox.height+n+(2*i+a),width:o.boundingBox.width,height:3*n+2*i+a},{},"","ingredients"),p=reactorComponents[this.selectedBlueprint.craftedItem.item.id];if(p.hasOwnProperty("rewardOutput")&&null!=p.rewardOutput){b.render=function(t){var e=this.getContext(),i=this.getRelativeCoordinates(0,0,t);e.save(),1==t.currentTabIndex&&(e.globalAlpha=.6,e.fillStyle="#111111",e.fillRect(i.x,i.y+6*a,this.boundingBox.width,this.boundingBox.height-5*a),e.globalAlpha=1,e.fillStyle="#FFFFFF",e.font=a+"px KanitM",e.fillText(_("Decay Rewards"),i.x,i.y+6*a)),e.restore(),this.renderChildren()}.bind(b,this);var y=p.rewardOutput;for(var u in y){var B;c=n+u%h*(i+d),x=n+Math.floor(u/h)*(i+d);(B=new Hitbox({x:c,y:x+l,width:i,height:i},{onmouseenter:function(t,e,n){var o=this.getGlobalCoordinates(e,n);showTooltip(_(t.item.getName()),_("Owned: {0}",beautifynum(t.item.getQuantityOwned())),(o.x+i)*uiScaleX,o.y*uiScaleY)}.bind(b,y[u],c,x+i+a),onmouseexit:function(){hideTooltip()}},"pointer")).render=function(t,e){var n=this.getContext(),o=this.getRelativeCoordinates(0,0,t);drawImageFitInBox(n,e.item.getIcon(),o.x,o.y,i,i),n.fillStyle="#FFFFFF";var r=Math.min(16,.037*t.boundingBox.height);n.font=r+"px Verdana",n.textBaseline="bottom",n.lineWidth=3,n.strokeStyle="#000000",strokeTextShrinkToFit(n,shortenNum(e.quantity),o.x,o.y+i,.95*i,"right"),fillTextShrinkToFit(n,shortenNum(e.quantity),o.x,o.y+i,.95*i,"right")}.bind(B,this,y[u]),b.addHitbox(B)}}}var w=new Hitbox({x:o.boundingBox.x+.05*o.boundingBox.width,y:this.craftingPane.boundingBox.height-38,width:.9*o.boundingBox.width,height:38},{onmousedown:function(){t&&1==this.currentTabIndex&&craftBlueprint(this.selectedBlueprint.category,this.selectedBlueprint.id)&&(this.initializeCraftingPane(),newNews(_("You crafted {0}",this.selectedBlueprint.craftedItem.item.getName()),!0),mutebuttons||clickAudio[rand(0,clickAudio.length-1)].play())}.bind(this),onmouseexit:function(){hideTooltip()}},"pointer","craftButton");w.onmouseenter=function(t){if(1==t.currentTabIndex&&!canCraftBlueprint(t.selectedBlueprint.category,t.selectedBlueprint.id)){var e=this.getGlobalCoordinates(0,this.boundingBox.height);showTooltip(getBlueprintNotCraftableReason(t.selectedBlueprint.category,t.selectedBlueprint.id),"",e.x,e.y)}}.bind(w,this),w.render=function(e){var i=e.context;i.save();var n,o=this.getRelativeCoordinates(0,0,e);1==e.currentTabIndex&&t&&canCraftBlueprint(e.selectedBlueprint.category,e.selectedBlueprint.id)?(i.drawImage(upgradeb,o.x,o.y,this.boundingBox.width,this.boundingBox.height),i.fillStyle="#000000"):(i.drawImage(upgradebg_blank,o.x,o.y,this.boundingBox.width,this.boundingBox.height),i.fillStyle="#444444"),i.textBaseline="middle";var r=Math.min(32,.074*e.boundingBox.height);i.font=r+"px KanitB",1==e.currentTabIndex&&(n=_("Craft")),fillTextShrinkToFit(i,n,o.x+10,o.y+this.boundingBox.height/2+2,this.boundingBox.width-20,"center"),i.restore()}.bind(w,this),this.craftingPane.addHitbox(o),o.addHitbox(r),this.craftingPane.addHitbox(s),this.craftingPane.addHitbox(b),this.craftingPane.addHitbox(w),this.isCraftingPaneInitialized=!0}else{var f="";1==this.currentTabIndex&&getAvailableBlueprints().length>0&&(f=_("Click on a blueprint on the left to view it")),this.craftingPane.clearHitboxes();var C=new Hitbox({x:10,y:10,width:this.craftingPane.boundingBox.width-20,height:this.craftingPane.boundingBox.height-20},{},"");C.render=function(t){var e=this.getRelativeCoordinates(0,0,t),i=t.context;i.fillStyle="#FFFFFF",i.textBaseline="middle",fillTextWrap(i,f,e.x,e.y+10,this.boundingBox.width),fillTextWrap(i,"",e.x,e.y+70,this.boundingBox.width)}.bind(C,this),this.craftingPane.addHitbox(C)}}}const HOVER_SYSTEM_COLORS=["rgb(140, 110, 110)","rgb(110, 110, 160)","rgb(110, 160, 110)","rgb(110, 160, 160)","rgb(140, 110, 160)","rgb(140, 160, 110)"];class ReactorGridCell extends DragDropUIComponent{row;column;constructor(t,e,i){super(t),this.displayType=2,this.isDropRegion=!0,this.dropTypesAccepted=[1],this.row=e,this.column=i,this.id="Cell_"+e+"_"+i}render(){var t=this.getRootLayer().context;this.isDropCandidate&&reactor.isCellUsable(this.column,this.row)&&(t.save(),t.shadowBlur=11,t.shadowColor="rgba(255, 255, 0, 1)");var e=reactor.grid.getCellHoveredSystemIndex(this.column,this.row);if(e>-1)t.fillStyle=HOVER_SYSTEM_COLORS[e],t.strokeStyle="rgb(0, 0, 0)";else if(reactor.isCellUsable(this.column,this.row))if(reactor.grid.isCellInOverheatingSystem(this.column,this.row)){var i=80*oscillate(numFramesRendered,7)+125;t.fillStyle="rgb("+i+", 25, 25)",t.strokeStyle="rgb(0, 0, 0)"}else t.fillStyle="rgb(220, 220, 220)",t.strokeStyle="rgb(0, 0, 0)";else t.fillStyle="rgb(64, 64, 64)",t.strokeStyle="rgb(42, 42, 42)",t.globalAlpha=.55;var n=this.parent.getRelativeCoordinates(this.boundingBox.x,this.boundingBox.y,this.getRootLayer());t.strokeRect(n.x,n.y,this.boundingBox.width,this.boundingBox.height),t.fillRect(n.x,n.y,this.boundingBox.width,this.boundingBox.height),t.globalAlpha=1,super.render(),this.isDropCandidate&&t.restore()}onAcceptDrop(){if(reactor.isCellUsable(this.column,this.row))if(this.hitboxes.length>0)activeDraggingInstance.onDropFailed();else{if(super.onAcceptDrop(),null!=activeDraggingInstance.reactorComponentType&&2==activeDraggingInstance.parentBeforeDrag.displayType&&activeDraggingInstance.parentBeforeDrag.hasOwnProperty("row")){var t=activeDraggingInstance.parentBeforeDrag.column,e=activeDraggingInstance.parentBeforeDrag.row;reactor.grid.removeComponentFromCell(t,e)}if(null!=activeDraggingInstance.reactorComponentType)if(activeDraggingInstance.parentBeforeDrag.hasOwnProperty("row")){t=activeDraggingInstance.parentBeforeDrag.column,e=activeDraggingInstance.parentBeforeDrag.row;reactor.grid.addComponentToCell(this.column,this.row,activeDraggingInstance.reactorComponentType,t,e)}else reactor.grid.addComponentToCell(this.column,this.row,activeDraggingInstance.reactorComponentType,null,null);this.addHitbox(activeDraggingInstance),redrawInventoryAndGrid(),activeDraggingInstance.boundingBox.x=1,activeDraggingInstance.boundingBox.y=1}else activeDraggingInstance.onDropFailed()}onChildRemoved(){super.onChildRemoved(),redrawInventoryAndGrid()}}function redrawInventoryAndGrid(){for(var t=activeLayers.Reactor.getHitboxById("reactorPane").getHitboxById("inventoryPane"),e=activeLayers.Reactor.getHitboxById("reactorPane").getHitboxById("reactorGrid"),i=1;i<reactorComponents.length;i++){var n=reactor.getTypeForSlot(i),o=t.getHitboxById("Inv_"+i);if(o.clearHitboxes(),n>-1){var r=new ReactorComponentUI({x:0,y:0,width:activeLayers.Reactor.widthHeightPerCell,height:activeLayers.Reactor.widthHeightPerCell},n);r.isOnGrid=!1,o.addHitbox(r)}}for(i=0;i<MAX_REACTOR_CELLS_ROWS;i++)for(var a=0;a<MAX_REACTOR_CELLS_COLUMNS;a++){var s=e.getHitboxById("Cell_"+i+"_"+a);if(s.clearHitboxes(),reactor.grid.grid[i][a]!=EMPTY_INTEGER_VALUE){var h=new ReactorComponentUI({x:0,y:0,width:activeLayers.Reactor.widthHeightPerCell,height:activeLayers.Reactor.widthHeightPerCell},reactor.grid.grid[i][a]);h.gridSlotX=a,h.gridSlotY=i,h.isOnGrid=!0,s.addHitbox(h)}}}class ReactorInventorySlot extends DragDropUIComponent{slotIndex;constructor(t,e){super(t),this.displayType=3,this.isDropRegion=!0,this.dropTypesAccepted=[1],this.slotIndex=e,this.id="Inv_"+e}render(){var t=this.getRootLayer().context;this.isDropCandidate&&(t.save(),t.shadowBlur=11,t.shadowColor="rgba(255, 255, 0, 1)"),t.strokeStyle="rgb(0, 0, 0)",t.fillStyle="rgb(200, 200, 200)";var e=this.parent.getRelativeCoordinates(this.boundingBox.x,this.boundingBox.y,this.getRootLayer());t.strokeRect(e.x,e.y,this.boundingBox.width,this.boundingBox.height),t.fillRect(e.x,e.y,this.boundingBox.width,this.boundingBox.height),super.render(),t.fillStyle="rgb(255, 255, 255)",t.textBaseline="bottom",t.lineWidth=3,t.font="14px Verdana";var i=reactor.getTypeForSlot(this.slotIndex),n=reactor.numOfTypeInInventory(i);if(n>0){var o=t.measureText(n).width;t.strokeText(n,e.x+this.boundingBox.width-(o+1),e.y+this.boundingBox.height-1),t.fillText(n,e.x+this.boundingBox.width-(o+1),e.y+this.boundingBox.height-1)}this.isDropCandidate&&t.restore()}onAcceptDrop(){if(super.onAcceptDrop(),null!=activeDraggingInstance.reactorComponentType&&2==activeDraggingInstance.parentBeforeDrag.displayType&&activeDraggingInstance.parentBeforeDrag.hasOwnProperty("row")){var t=activeDraggingInstance.parentBeforeDrag.column,e=activeDraggingInstance.parentBeforeDrag.row,i=reactor.grid.getComponentTypeInCellAtLocation(t,e);if(FUEL_ROD_TYPES.includes(i))if(reactorComponents[i].energyProductionPerSecond>0){if(reactor.grid.isFuelCellBurnedUp(t,e))return void activeDraggingInstance.onDropFailed();if(reactor.grid.getFuelCellRemainingEnergy(t,e)!=reactorComponents[i].totalEnergyOutput)return showConfirmationPrompt(_("This Fuel Rod has been partially used, it cannot be returned to inventory. Do you wish to delete it?"),_("Yes, Delete It"),function(t,e){reactor.grid.deleteFuelCellState(t,e),reactor.grid.deleteComponentInCellAndRemoveQuantityOwned(t,e),redrawInventoryAndGrid(),hideSimpleInput()}.bind(null,t,e),_("Cancel")),void activeDraggingInstance.onDropFailed();reactor.grid.deleteFuelCellState(t,e)}else reactor.grid.deleteFuelCellState(t,e);else if(BATTERY_TYPES.includes(i)){var n=reactor.grid.maxBatteryCapacity()-reactorComponents[i].energyStorage;if(reactor.currentBatteryCharge()>n)return showConfirmationPrompt(_("Returning this battery to storage will result in decreased total energy stored.  Do you want to proceed?"),_("Yes"),function(t,e){reactor.grid.removeComponentFromCell(t,e),redrawInventoryAndGrid(),hideSimpleInput()}.bind(null,t,e),_("Cancel")),void activeDraggingInstance.onDropFailed()}reactor.grid.removeComponentFromCell(t,e)}redrawInventoryAndGrid(),activeDraggingInstance.boundingBox.x=1,activeDraggingInstance.boundingBox.y=1}onChildRemoved(){super.onChildRemoved(),redrawInventoryAndGrid()}}class ReactorComponentUI extends DragDropUIComponent{reactorComponentType;gridSlotX;gridSlotY;isOnGrid;isMouseOver=!1;constructor(t,e){super(t),this.displayType=1,this.isDraggable=!0,this.reactorComponentType=e}cellTypeTop(){return this.isOnGrid&&this.gridSlotY>0?reactor.grid.getComponentTypeInCellAtLocation(this.gridSlotX,this.gridSlotY-1):null}cellTypeBottom(){return this.isOnGrid&&this.gridSlotY<MAX_REACTOR_CELLS_ROWS-1?reactor.grid.getComponentTypeInCellAtLocation(this.gridSlotX,this.gridSlotY+1):null}cellTypeRight(){return this.isOnGrid&&this.gridSlotX<MAX_REACTOR_CELLS_COLUMNS-1?reactor.grid.getComponentTypeInCellAtLocation(this.gridSlotX+1,this.gridSlotY):null}cellTypeLeft(){return this.isOnGrid&&this.gridSlotX>0?reactor.grid.getComponentTypeInCellAtLocation(this.gridSlotX-1,this.gridSlotY):null}render(){var t=this.getRootLayer().context;this.isDropCandidate&&(t.save(),t.shadowBlur=11,t.shadowColor="rgba(255, 255, 0, 1)"),t.strokeStyle="rgb(0, 0, 0)",t.fillStyle="rgb(255, 255, 255)",this.renderComponent(),super.render(),this.isDropCandidate&&t.restore()}onmouseenter(t){super.onmouseenter(t),reactorComponents[this.reactorComponentType].showTooltip(this),this.isMouseOver=!0,reactor.grid.setComponentAsInFocus(this.gridSlotX,this.gridSlotY)}onmouseexit(t){super.onmouseexit(t),hideTooltip(),this.isMouseOver=!1,reactor.grid.unsetComponentAsInFocus(this.gridSlotX,this.gridSlotY)}onmousedown(t){if(keysPressed.Shift)if(this.isOnGrid){var e=reactor.grid.getComponentTypeInCellAtLocation(this.gridSlotX,this.gridSlotY);console.log(e),FUEL_ROD_TYPES.includes(this.reactorComponentType)?reactor.grid.isFuelCellBurnedUp(this.gridSlotX,this.gridSlotY)?reactor.grid.collectFuelCell(this.gridSlotX,this.gridSlotY):reactor.grid.getFuelCellRemainingEnergy(this.gridSlotX,this.gridSlotY)!=reactorComponents[e].totalEnergyOutput&&reactorComponents[e].totalEnergyOutput>0?showConfirmationPrompt(_("This Fuel Rod has been partially used, it cannot be returned to inventory. Do you wish to delete it?"),_("Yes, Delete It"),function(t,e){reactor.grid.deleteFuelCellState(t,e),reactor.grid.deleteComponentInCellAndRemoveQuantityOwned(t,e),redrawInventoryAndGrid(),hideSimpleInput()}.bind(null,this.gridSlotX,this.gridSlotY),_("Cancel")):(reactor.grid.deleteFuelCellState(this.gridSlotX,this.gridSlotY),reactor.grid.removeComponentFromCell(this.gridSlotX,this.gridSlotY)):reactor.grid.removeComponentFromCell(this.gridSlotX,this.gridSlotY),redrawInventoryAndGrid()}else{var i=!1;reactor.grid.grid.forEach(((t,e)=>{0==i&&t.forEach(((t,n)=>{0==t&&0==i&&reactor.isCellUsable(n,e)&&(reactor.grid.addComponentToCell(n,e,this.reactorComponentType,null,null),i=!0,redrawInventoryAndGrid())}))}))}else super.onmousedown(t),this.isOnGrid&&FUEL_ROD_TYPES.includes(this.reactorComponentType)&&reactor.grid.isFuelCellBurnedUp(this.gridSlotX,this.gridSlotY)&&showConfirmationPrompt(_("Collect materials from decayed fuel rod?"),_("Yes"),function(){reactor.grid.collectFuelCell(this.gridSlotX,this.gridSlotY),hideSimpleInput(),redrawInventoryAndGrid()}.bind(this),_("Cancel"))}renderComponent(){var t=this.getRootLayer().context,e=this.parent.getRelativeCoordinates(this.boundingBox.x,this.boundingBox.y,this.getRootLayer());reactorComponents[this.reactorComponentType].render(this,t,e.x,e.y,this.boundingBox.width,this.boundingBox.height)}}