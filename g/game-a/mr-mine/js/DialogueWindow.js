class DialogueWindow extends PopupWindow{layerName="DialogueWindow";domElementId="DIALOGUED";context=DIALOGUE;allowBubbling=!1;dialogueFont="16px KanitM";nameFont="14px KanitM";backgroundImageSrc="Shared/Assets/UI/tooltip_background.png";backgroundImage;frameWidth;frameHeight;zIndex=999;currentDialogue;renderedTextInfo;currentCharIndex;dialogueSpeed=2;isTextAnimating=!1;textSounds=[new Audio("Shared/Audio/click1.wav"),new Audio("Shared/Audio/click2.wav"),new Audio("Shared/Audio/click3.wav"),new Audio("Shared/Audio/click4.wav"),new Audio("Shared/Audio/click5.wav")];constructor(t){super(t),t||this.setBoundingBox(),this.backgroundImage=new Image,this.backgroundImage.src=this.backgroundImageSrc,this.frameWidth=12,this.frameHeight=12,this.addHitbox(new Hitbox({x:0,y:0,width:this.boundingBox.width,height:this.boundingBox.height},{onmousedown:function(){this.isTextAnimating?(mutebuttons||clickAudio[rand(0,clickAudio.length-1)].play(),this.skipTextAnimation()):this.currentDialogue.clickToContinue&&(mutebuttons||clickAudio[rand(0,clickAudio.length-1)].play(),dialogueManager.next())}.bind(this)}));var i=.5*this.boundingBox.height,e=.1*this.boundingBox.height;for(var n of(this.addHitbox(new Button(upgradeb,_("Skip"),"9px KanitM","#000000",{x:this.frameWidth+.025*this.boundingBox.width,y:this.boundingBox.height-this.frameHeight-1.1*e,width:i,height:e},{onmousedown:function(){mutebuttons||clickAudio[rand(0,clickAudio.length-1)].play(),dialogueManager.finish()}})),this.textX=this.frameWidth+.5*this.boundingBox.height+.075*this.boundingBox.width,this.textY=this.frameHeight+.025*this.boundingBox.width,this.textSounds))n.volume=.1;this.updateCurrentDialogue()}render(){dialogueManager.isDirty&&this.updateCurrentDialogue(),this.context.save();this.getGlobalCoordinates(0,0);var t=.5*this.boundingBox.height,i=.025*this.boundingBox.width,e=this.frameWidth+i,n=this.frameHeight+i;if(this.context.drawImage(this.backgroundImage,0,0,this.boundingBox.width,this.boundingBox.height),drawFrame(this.context,popupFrame,0,0,this.boundingBox.width,this.boundingBox.height,this.frameWidth),this.context.fillStyle="#000000",this.context.globalAlpha=.35,this.context.fillRect(e,n,t,t),this.context.globalAlpha=1,this.currentDialogue.spritesheet?(this.isTextAnimating&&this.currentDialogue.spritesheet.isPaused?(this.currentDialogue.spritesheet.goToFrame(1),this.currentDialogue.spritesheet.play()):this.isTextAnimating||this.currentDialogue.spritesheet.playUntilFinished(),this.currentDialogue.spritesheet.drawAnimation(this.context,e,n,t,t)):drawImageFitInBox(this.context,this.currentDialogue.image,e,n,t,t),drawFrame(this.context,itemFrame,e,n,t,t,6,4,0,0),this.context.fillStyle="#333333",this.context.textBaseline="top",this.context.font=this.nameFont,fillTextWrap(this.context,this.currentDialogue.name,e,n+t+i/2,t,"center",.2),this.context.globalAlpha=.2,this.context.strokeStyle="#000000",this.context.lineWidth=1,this.context.beginPath(),this.context.moveTo(e+t+i,this.frameHeight),this.context.lineTo(e+t+i,this.boundingBox.height-this.frameHeight),this.context.stroke(),this.renderDialogue(),this.currentDialogue.clickToContinue){this.context.globalAlpha=.2+.8*oscillate(currentTime(),500),this.context.textBaseline="bottom";this.context.font="12px KanitM";var o=oscillate(currentTime(),500),h=Math.round(46*o),s=Math.round(163*o),a=Math.round(69*o);this.context.fillStyle=rgbToHex(h,s,a),fillTextWrap(this.context,_("Click to continue..."),this.frameWidth,this.boundingBox.height-this.frameHeight,this.boundingBox.width-2*this.frameWidth,"right")}this.context.restore(),this.renderChildren()}updateCurrentDialogue(){var t=dialogueManager.getCurrentSpeaker(),i=dialogueManager.getCurrentDialogue(),e={name:t.name,image:t.image,spritesheet:t.spritesheet,text:i.text,clickToContinue:i.clickToContinue,position:i.position};this.currentDialogue!=e&&this.setWindowPosition(e.position),dialogueManager.isDirty=!1,this.currentDialogue=e,this.currentCharIndex=0,this.context.font=this.dialogueFont,this.renderedTextInfo=fillTextWrapWithHeightLimit(this.context,this.currentDialogue.text,this.textX,this.textY,this.boundingBox.width-this.textX-this.frameWidth,this.boundingBox.height-2*this.textY,"left",.2,"top",!0),console.log(this.renderedTextInfo)}renderDialogue(){this.currentCharIndex<this.currentDialogue.text.length?(this.currentCharIndex+=this.dialogueSpeed,this.isTextAnimating=!0,mutebuttons||this.textSounds[rand(0,clickAudio.length-1)].play()):this.isTextAnimating=!1,this.context.save(),this.context.globalAlpha=1,this.context.fillStyle="#333333",this.context.font=this.renderedTextInfo.font;var t=this.currentCharIndex;for(var i of this.renderedTextInfo.lines)if(this.context.fillText(i.text.slice(0,t),i.x,i.y),(t-=i.text.length)<=0)break;this.context.restore()}skipTextAnimation(){this.currentCharIndex=this.currentDialogue.text.length}setWindowPosition(t){var i=document.getElementById(this.domElementId);t?(this.setWindowPositionValue(i,"left",t.x),this.setWindowPositionValue(i,"top",t.y),this.setWindowPositionValue(i,"width",t.width),this.setWindowPositionValue(i,"height",t.height)):(i.style.left="",i.style.top="",i.style.width="",i.style.height=""),this.setBoundingBox()}setWindowPositionValue(t,i,e){t.style[i]=e||0===e?"string"==typeof e?e:e+"px":""}}