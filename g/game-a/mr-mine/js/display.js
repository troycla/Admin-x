var main=document.getElementById("WRAPPER"),MAIN=main.getContext("2d");main.style.width="100%",main.style.height="100%",main.width=main.offsetWidth,main.height=main.offsetHeight;var mainw=main.width,mainh=main.height,mainwInit=mainw,mainhInit=mainh;if(MAIN.font="18px CFont",isMobile()){var mobileFooter=document.getElementById("MOBILEFOOTER"),MOBILEFOOTER=mobileFooter.getContext("2d");mobileFooter.style.width="100%",mobileFooter.style.height="100%",mobileFooter.width=mobileFooter.offsetWidth,mobileFooter.height=mobileFooter.offsetHeight;var mobileFooterW=mobileFooter.width,mobileFooterH=mobileFooter.height,mobileFooterWInit=mobileFooterW,mobileFooterHInit=mobileFooterH;MOBILEFOOTER.font="18px CFont"}var stage=document.getElementById("STAGE"),STAGE=stage.getContext("2d");stage.style.width="100%",stage.style.height="100%",stage.width=stage.offsetWidth,stage.height=stage.offsetHeight;var stagew=stage.width,stageh=stage.height,stagewInit=stagew,stagehInit=stageh;STAGE.font="18px CFont";var particles=document.getElementById("PARTICLES"),PARTICLES=particles.getContext("2d");particles.style.width="100%",particles.style.height="100%",particles.width=particles.offsetWidth,particles.height=particles.offsetHeight;var particlesw=particles.width,particlesh=particles.height,particleswInit=particlesw,particleshInit=particlesh;PARTICLES.font="18px CFont";var transientEffectContainer=document.getElementById("TRANSIENTEFFECTS"),TransientEffectsC=transientEffectContainer.getContext("2d");transientEffectContainer.style.width="100%",transientEffectContainer.style.height="100%",transientEffectContainer.width=transientEffectContainer.offsetWidth,transientEffectContainer.height=transientEffectContainer.offsetHeight;var transientEffectContainerW=transientEffectContainer.width,transientEffectContainerH=transientEffectContainer.height;TransientEffectsC.font="24px CFont";var tut=document.getElementById("TUTORIAL"),TUT=tut.getContext("2d");tut.style.width="100%",tut.style.height="100%",tut.width=tut.offsetWidth,tut.height=tut.offsetHeight;var tutw=tut.width,tuth=tut.height;TUT.font="16px Verdana",minimizeCanvas(TUT.canvas);var dialogueCanvas=document.getElementById("DIALOGUE");if(dialogueCanvas){var DIALOGUE=dialogueCanvas.getContext("2d");dialogueCanvas.style.width="100%",dialogueCanvas.style.height="100%",dialogueCanvas.width=dialogueCanvas.offsetWidth,dialogueCanvas.height=dialogueCanvas.offsetHeight}else console.error("Dialogue canvas is missing!");var sell=document.getElementById("SELL"),SL=sell.getContext("2d");SL.font="16px Verdana",minimizeCanvas(SL.canvas);var buyd=document.getElementById("BUY"),BY=buyd.getContext("2d");buyd.style.width="100%",buyd.style.height="100%",buyd.width=buyd.offsetWidth,buyd.height=buyd.offsetHeight;var buydw=buyd.width,buydh=buyd.height;BY.font="16px Verdana",minimizeCanvas(BY.canvas);var oild=document.getElementById("OIL"),OIL=oild.getContext("2d");OIL.font="16px Verdana",minimizeCanvas(OIL.canvas);var drilld=document.getElementById("DRILL"),DRILL=drilld.getContext("2d");DRILL.font="16px Verdana",minimizeCanvas(DRILL.canvas);var offlineprogressd=document.getElementById("OFFLINEPROGRESS"),OFFLINEPROGRESS=offlineprogressd.getContext("2d");offlineprogressd.style.width="100%",offlineprogressd.style.height="100%",offlineprogressd.width=offlineprogressd.offsetWidth,offlineprogressd.height=offlineprogressd.offsetHeight;var offlineprogressdw=offlineprogressd.width,offlineprogressdh=offlineprogressd.height;OFFLINEPROGRESS.font="16px Verdana",minimizeCanvas(OFFLINEPROGRESS.canvas);var archd=document.getElementById("ARCH"),ARCH=archd.getContext("2d");ARCH.font="16px Verdana",minimizeCanvas(ARCH.canvas);var craftingd=document.getElementById("CRAFTING"),CRAFTING=craftingd.getContext("2d");CRAFTING.font="16px Verdana",minimizeCanvas(CRAFTING.canvas);var settingsd=document.getElementById("SETTINGS"),SETTINGS=settingsd.getContext("2d");SETTINGS.font="16px Verdana",minimizeCanvas(SETTINGS.canvas);var questsd=document.getElementById("QUESTS"),QUESTS=questsd.getContext("2d");QUESTS.font="16px Verdana",minimizeCanvas(QUESTS.canvas);var purchased=document.getElementById("PURCHASE"),PU=purchased.getContext("2d");purchased.style.width="100%",purchased.style.height="100%",purchased.width=purchased.offsetWidth,purchased.height=purchased.offsetHeight;var purchasedw=purchased.width,purchasedh=purchased.height;PU.font="16px Verdana",minimizeCanvas(PU.canvas);var hired=document.getElementById("HIRE"),HR=hired.getContext("2d");HR.font="16px Verdana",minimizeCanvas(HR.canvas);var superd=document.getElementById("SUPER"),SPR=superd.getContext("2d");SPR.font="16px Verdana",minimizeCanvas(SPR.canvas);var supselld=document.getElementById("SUPSELL"),SSD=supselld.getContext("2d");SSD.font="16px Verdana",minimizeCanvas(SSD.canvas);var supbd=document.getElementById("SUPB"),SBD=supbd.getContext("2d");SBD.font="16px Verdana",minimizeCanvas(SBD.canvas);var battled=document.getElementById("BATTLE"),BA=battled.getContext("2d");BA.font="16px Verdana",minimizeCanvas(BA.canvas);var chestc=document.getElementById("CHEST"),CH=chestc.getContext("2d");chestc.style.width="100%",chestc.style.height="100%",chestc.width=chestc.offsetWidth,chestc.height=chestc.offsetHeight;var chestcw=chestc.width,chestch=chestc.height;CH.font="18px Verdana",minimizeCanvas(CH.canvas);var helpc=document.getElementById("HELP"),HE=helpc.getContext("2d");if(HE.font="18px Verdana",minimizeCanvas(HE.canvas),!isMobile()){var titlec=document.getElementById("TITLE"),TI=titlec.getContext("2d");titlec.style.width="100%",titlec.style.height="100%",titlec.width=titlec.offsetWidth,titlec.height=titlec.offsetHeight;var titlecw=titlec.width,titlech=titlec.height;TI.font="18px Verdana"}var tradingpostd=document.getElementById("TRADINGPOST"),TRADINGPOST=tradingpostd.getContext("2d");TRADINGPOST.font="16px Verdana",minimizeCanvas(TRADINGPOST.canvas);var reactord=document.getElementById("REACTOR"),REACTOR=reactord.getContext("2d");REACTOR.font="16px Verdana",minimizeCanvas(REACTOR.canvas);var cavesystemd=document.getElementById("CAVESYSTEM"),CAVESYSTEM=cavesystemd.getContext("2d");CAVESYSTEM.font="16px Verdana",minimizeCanvas(CAVESYSTEM.canvas);var promod=document.getElementById("PROMO"),PROMO=promod.getContext("2d");PROMO.font="16px Verdana",minimizeCanvas(PROMO.canvas);var weaponForgeD=document.getElementById("WEAPONFORGE"),WEAPONFORGE=weaponForgeD.getContext("2d");WEAPONFORGE.font="16px Verdana",minimizeCanvas(WEAPONFORGE.canvas);var gemForgeD=document.getElementById("GEMFORGE"),GEMFORGE=gemForgeD.getContext("2d");GEMFORGE.font="16px Verdana",minimizeCanvas(GEMFORGE.canvas);var pitd=document.getElementById("PIT"),PIT=pitd.getContext("2d");PIT.font="16px Verdana",minimizeCanvas(PIT.canvas);var smsd=document.getElementById("SMS"),SMS=smsd.getContext("2d");SMS.font="16px Verdana",minimizeCanvas(SMS.canvas);var confirmation=document.getElementById("CONFIRMATION"),CON=confirmation.getContext("2d");CON.font="18px Verdana",minimizeCanvas(CON.canvas);var special=document.getElementById("SPECIAL"),SPC=special.getContext("2d");SPC.font="18px Verdana",minimizeCanvas(SPC.canvas),window.addEventListener("resize",handleWindowResizeEvent);var hasResized=!1;function handleWindowResizeEvent(){main.style.width="100%",main.style.height="100%",main.width=main.offsetWidth,main.height=main.offsetHeight,mainw=main.width,mainh=main.height,MAIN.font="18px CFont",stage.style.width="100%",stage.style.height="100%",stage.width=stage.offsetWidth,stage.height=stage.offsetHeight,stagew=stage.width,stageh=stage.height,STAGE.font="18px CFont",particles.style.width="100%",particles.style.height="100%",particles.width=particles.offsetWidth,particles.height=particles.offsetHeight,particlesw=particles.width,particlesh=particles.height,PARTICLES.font="18px CFont",hasResized&&(uiScaleX=mainw/mainwInit,uiScaleY=mainh/mainhInit,activeLayers.MainUILayer&&(activeLayers.MainUILayer.setBoundingBox(),activeLayers.WorldLayer.setBoundingBox(),activeLayers.Stage.setBoundingBox(),activeLayers.Particles.setBoundingBox(),activeLayers.PinnedBlueprintsLayer&&activeLayers.PinnedBlueprintsLayer.setBoundingBox())),hasResized=!0,isMobile()&&setGlobalDpiScale(GLOBAL_DPI_SCALE),initWorldConfig&&initWorldConfig()}function openUi(e,...t){var i=new e(...t);return closeOtherUIs(i.layerName)?(activeLayers[i.layerName]=i,activeLayers[i.layerName].open(),maximizeCanvas(i.context.canvas),animate(),i):null}function openUiWithoutClosing(e,...t){var i=new e(...t);return activeLayers[i.layerName]&&(closeUi(activeLayers[i.layerName]),maximizeCanvas(i.context.canvas)),activeLayers[i.layerName]=i,activeLayers[i.layerName].open(),animate(),i}function closeUi(e){return!!e.close()&&(delete activeLayers[e.layerName],!0)}function getUiByName(e){if(activeLayers[e])return activeLayers[e]}function closeUiByName(e){return!!activeLayers[e]&&closeUi(activeLayers[e])}function closeOtherUIs(e){for(var t in logui(0,!0),hireui(0,!0),helpui(0,!0),activeLayers)if(t!=e&&activeLayers[t].isPopup&&!closeUiByName(t))return!1;for(var i in windowState)i!=e&&(windowState[i]=0);return!0}function maximizeCanvas(e){var t=e.getContext("2d"),i=t.font;e.style.width="100%",e.style.height="100%",e.width=e.offsetWidth/uiScaleX,e.height=e.offsetHeight/uiScaleY,t.font=i,setDpi(e,GLOBAL_DPI_SCALE)}function minimizeCanvas(e){var t=e.getContext("2d"),i=t.font;e.style.width=0,e.style.height=0,e.width=0,e.height=0,t.font=i}function sellui(e){closeOtherUIs(1)&&(windowState[1]=e,1==e?(animate(),showDiv("SELLD",3)):hideDiv("SELLD"))}function buyui(e){closeOtherUIs(2)&&(5!==e&&(windowState[2]=e),5==e&&depth>49?windowState[2]=5:5==e?windowState[2]=0:6==e&&depth>224?windowState[2]=6:6==e&&(windowState[2]=0),2!=e&&0!=e||(drillPurchasePage=0),1==e||5==e&&depth>49||6==e&&depth>224?(animate(),showDiv("BUYD",3)):(hideDiv("BUYD"),hideequips()))}function purchaseui(e){closeOtherUIs(7)&&(windowState[7]=e,e>0?(animate(),"undefined"!=typeof buildTarget&&buildTarget==WEB_BUILD?1==e?(isPaypalWindowVisible=!0,showDiv("paypalPopup",4),showDiv("PURCHASED",3)):(isPaypalWindowVisible=!1,hideDiv("paypalPopup")):showDiv("PURCHASED",3)):"undefined"!=typeof buildTarget&&buildTarget==WEB_BUILD?(isPaypalWindowVisible=!1,hideDiv("paypalPopup"),hideDiv("PURCHASED")):hideDiv("PURCHASED"))}function archui(e){closeOtherUIs(12)&&(windowState[12]=e,e>0?(animate(),showDiv("ARCHD",3)):hideDiv("ARCHD"))}function settingsui(e){closeOtherUIs(14)&&(windowState[14]=e,e>0?(animate(),showDiv("SETTINGSD",3)):hideDiv("SETTINGSD"))}function tradingpostui(e,t){(t||closeOtherUIs(15))&&(windowState[15]=e,e>0?(tradeConfig.tradingPosts[e-1].playerHasSeenNewTrade=!0,animate(),showDiv("TRADINGPOSTD",3)):hideDiv("TRADINGPOSTD"))}function battleui(){isBossBattleActive||battleActive?(closeUiByName("Battle"),battleActive=!1):(preparebattle(),openUi(BattleWindow,null,battleWaiting[2]),battleActive=!0)}function logui(e,t){(t||closeOtherUIs(11))&&(windowState[11]=e,1==e?(animate(),showDiv("LOGGERD",3)):hideDiv("LOGGERD"))}function hireui(e,t){(t||closeOtherUIs(3))&&(windowState[3]=e,1==e?(animate(),showDiv("HIRED",3)):hideDiv("HIRED"))}function helpui(e,t){(t||closeOtherUIs(5))&&(windowState[5]=e,1==e?(animate(),showDiv("HELPD",3)):hideDiv("HELPD"))}function showequips(){showDiv("EQUIPS",3),showDiv("ENGINEM",4),showDiv("DRILLM",4),showDiv("RADIATORM",4),showDiv("CARGOBAYM",4),showDiv("DELETEE",4);for(var e=1;e<11;e++)showDiv("ENGINE"+e,4),showDiv("DRILL"+e,4),showDiv("RADIATOR"+e,4),showDiv("CARGOBAY"+e,4)}function hideequips(){hideDiv("EQUIPS"),hideDiv("ENGINEM"),hideDiv("DRILLM"),hideDiv("RADIATORM"),hideDiv("CARGOBAYM"),hideDiv("DELETEE");for(var e=1;e<11;e++)hideDiv("ENGINE"+e),hideDiv("DRILL"+e),hideDiv("RADIATOR"+e),hideDiv("CARGOBAY"+e)}var lightlogic=[0,-5,-4,-4,-3,-3,-3,-2,-2,-2,-2,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,1,1,1,1,1,2,2,2,2,3,3,3,4,4,5,0],lights=[30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30],isAllowingAds=0;function hideDiv(e){var t=document.getElementById(e);return!!t&&(t.style.visibility="hidden",t.style.zIndex=-1,!0)}function showDiv(e,t){var i=document.getElementById(e);return!!i&&(i.style.visibility="visible",i.style.zIndex=t,!0)}function isDivVisible(e){var t=document.getElementById(e);return t&&t.style&&"hidden"!=t.style.visibility}function setDivToVisibileLocation(e,t){document.getElementById(e).style.visibility="visible",document.getElementById(e).style.zIndex=2,document.getElementById(e).style.top=t+"%"}function movedivs(){if(!isMobile()){if(currentlyViewedDepth<4){var e=46.2-17.8*currentlyViewedDepth;setDivToVisibileLocation("PLACE1",e=Math.ceil(e)),setDivToVisibileLocation("PLACE3",e),setDivToVisibileLocation("PLACE2",e+5),setDivToVisibileLocation("METALDETECTORPLACE",e+19),setDivToVisibileLocation("GARAGE",e+8.8),currentlyViewedDepth<2?(setDivToVisibileLocation("PLACE4",e-20),setDivToVisibileLocation("ARCHPLACE",e-18)):(hideDiv("PLACE4"),hideDiv("ARCHPLACE"))}else hideDiv("PLACE1"),hideDiv("PLACE3"),hideDiv("PLACE2"),hideDiv("PLACE4"),hideDiv("METALDETECTORPLACE"),hideDiv("ARCHPLACE"),hideDiv("GARAGE");var t=46.2-17.8*(currentlyViewedDepth-304);if(t=Math.ceil(t),currentlyViewedDepth>300&&currentlyViewedDepth<308?(setDivToVisibileLocation("PLACE5",t),setDivToVisibileLocation("PLACE6",t-25),setDivToVisibileLocation("PLACE7",t)):(hideDiv("PLACE5"),hideDiv("PLACE6"),hideDiv("PLACE7")),currentlyViewedDepth==depth?showDiv("drillHitbox",3):hideDiv("drillHitbox"),BattleManager.bosses.length>bossesDefeated)for(var i=0;i<5;i++){if(BattleManager.isActiveBossLevel(currentlyViewedDepth-i)&&BattleManager.bosses[bossesDefeated].minDepth==currentlyViewedDepth-i){showDiv("bossLevel",3),document.getElementById("bossLevel").style.top=82.2-17.8*i+"%";break}4==i&&hideDiv("bossLevel")}else hideDiv("bossLevel")}}function changeViewedDepth(e,t=!1){if(0!=e&&void 0!==activeLayers.WorldLayer){var i,n=!1,a=activeLayers.WorldLayer.minVisibleDepth;if(i=isMobile()?depth>=1e3&&depth<1032?depth+1+subTickDistancePercent():depth+1:depth,e>0&&!hasBranchTriggered(0)&&setBranchToTriggered(0),!t&&(e>0&&currentlyViewedDepth+partialDepthOffset<i||e<0&&currentlyViewedDepth+partialDepthOffset>a)){e>0&&currentlyViewedDepth+partialDepthOffset+e>i?e=i-currentlyViewedDepth-partialDepthOffset:e<0&&currentlyViewedDepth+partialDepthOffset+e<a&&(e=a-currentlyViewedDepth-partialDepthOffset);var o=Math.floor(e);if(currentlyViewedDepth+=o,"undefined"!=typeof partialDepthOffset&&(partialDepthOffset+=e-o,partialDepthOffset>=1)){var d=Math.floor(partialDepthOffset);currentlyViewedDepth+=d,partialDepthOffset-=d}n=!0}else t&&(e<0?(0==chestService.totalBlackChestsOpened&&currentlyViewedDepth>SUPER_MINER_DEPTH+2?currentlyViewedDepth=SUPER_MINER_DEPTH+2:playerNeedsHelpCraftingTradingPost()&&currentlyViewedDepth>tradeConfig.tradingPosts[0].depth+2?currentlyViewedDepth=tradeConfig.tradingPosts[0].depth+2:playerNeedsHelpFindingGolem()&&currentlyViewedDepth>52?currentlyViewedDepth=52:playerNeedsHelpFindingChestCollector()&&currentlyViewedDepth>102?currentlyViewedDepth=102:playerNeedsHelpFindingBrokenRobot()&&currentlyViewedDepth>227?currentlyViewedDepth=227:currentlyViewedDepth<=1032?currentlyViewedDepth=a:currentlyViewedDepth<=1814?currentlyViewedDepth=1032:currentlyViewedDepth=1814,n=!0):e>0&&(0==chestService.totalBlackChestsOpened&&currentlyViewedDepth<SUPER_MINER_DEPTH+2?currentlyViewedDepth=SUPER_MINER_DEPTH+2:playerNeedsHelpCraftingTradingPost()&&currentlyViewedDepth<tradeConfig.tradingPosts[0].depth+2?currentlyViewedDepth=tradeConfig.tradingPosts[0].depth+2:playerNeedsHelpFindingGolem()&&currentlyViewedDepth<48?currentlyViewedDepth=52:playerNeedsHelpFindingChestCollector()&&currentlyViewedDepth<98?currentlyViewedDepth=102:playerNeedsHelpFindingBrokenRobot()&&currentlyViewedDepth<223?currentlyViewedDepth=227:currentlyViewedDepth>=1814?currentlyViewedDepth=depth:currentlyViewedDepth>=1032?currentlyViewedDepth=1814:currentlyViewedDepth<1032&&(currentlyViewedDepth=1032),n=!0),"undefined"!=typeof partialDepthOffset&&(partialDepthOffset=0));currentlyViewedDepth>i?(currentlyViewedDepth=Math.max(a,i),"undefined"!=typeof partialDepthOffset&&(partialDepthOffset=0)):currentlyViewedDepth<a&&(currentlyViewedDepth=a,"undefined"!=typeof partialDepthOffset&&(partialDepthOffset=0)),n&&(animate(),hasAnimatedThisFrame=1,movedivs())}}function getVisibleDepthRange(){var e={};return e.max=currentlyViewedDepth+partialDepthOffset,e.min=e.max-worldConfig.numberOfDepthsVisible+1,e}function isDepthVisible(e){var t=getVisibleDepthRange();return e>=Math.floor(t.min)&&e<=Math.ceil(t.max)}function panToViewDepth(e){e>depth||e<0||(e+2<=depth?e+=2:e+1<=depth&&(e+=1),currentlyViewedDepth=e,movedivs())}function openNewGamePrompt(){RSc<3&&showSimpleInput(_("GAME NAME"),_("START"),getFirstUnusedGameName(),(()=>createNewGame(document.getElementById("simpleInputFieldText").value)),_("CANCEL"))}function showAlertPrompt(e,t="Ok"){openUiWithoutClosing(ConfirmationWindow,null,e,t,"")}function showConfirmationPrompt(e,t,i,n,a=null){activeLayers.confirmationLayer||openUiWithoutClosing(ConfirmationWindow,null,e,t,n,i,a)}function isConfirmationPromptOpen(){for(var e in activeLayers)if(e.includes("confirmationLayer"))return!0;return!1}function showSimpleInput(e,t,i,n,a,o=0,d=null){showDiv("SIMPLEINPUTFIELD",999),document.getElementById("simpleInputFieldText").style.visibility="visible",document.getElementById("simpleInputFieldText").value=i,document.getElementById("simpleInputFieldText").onclick=null,null!=d&&(document.getElementById("simpleInputFieldText").onclick=d),o>0?document.getElementById("simpleInputFieldText").maxLength=o:document.getElementById("simpleInputFieldText").removeAttribute("maxLength"),openUiWithoutClosing(ConfirmationWindow,null,e,t,a,n)}function hideSimpleInput(){hideDiv("SIMPLEINPUTFIELD")}function hideSimpleInputAlert(){hideDiv("SIMPLEINPUTFIELDALERT"),document.getElementById("simpleInputAlertButton").onclick=null}function isSimpleInputVisible(){return"visible"==document.getElementById("SIMPLEINPUTFIELD").style.visibility}function showTooltipForDiv(e,t,i,n=120){var a=window.innerWidth,o=window.innerHeight,d=document.getElementById(i).getBoundingClientRect();showTooltip(e,t,d.right+document.getElementById("TOOLTIP").style.width>=a?d.left-document.getElementById("TOOLTIP").style.width:d.right,d.top+document.getElementById("TOOLTIP").style.height>=o?o-document.getElementById("TOOLTIP").style.height:d.top,n)}alert=function(e){showAlertPrompt(e)};var updatingTooltipState={isLive:!1,updateTextFunction:null,x:0,y:0,width:120};function showUpdatingTooltip(e,t=0,i=0,n=120){updatingTooltipState.isLive=!0,updatingTooltipState.updateTextFunction=e,updatingTooltipState.x=t,updatingTooltipState.y=i,updatingTooltipState.width=n,updateUpdatingTooltip()}function isScrolling(e=null){if(!isMobile()||!isDragging||dragDistance()<=1)return!1;if(null==e){if(null==currentTargetHitbox||null==currentTargetHitbox.hitbox)return!1;e=currentTargetHitbox.hitbox}return!!e.constructor.name.includes("Scroll")||null!=e.parent&&isScrolling(e.parent)}function showTooltip(e,t,i=-1,n=-1,a=120){if(isScrolling())hideTooltip();else{i=i<0?mouseX:convertCssSizeToPixels(i,"x"),n=n<0?mouseY:convertCssSizeToPixels(n,"y");var o=e+t,d=0;["<br>","<b>","</b>","<center>","</center>"].forEach((e=>{for(;o.includes(e);)o=o.replace(e," ")})),o.split(" ").forEach((e=>{MAIN.measureText(e).width>d&&(e.includes("data:image")||e.includes("file:")||e.includes("class=")||(d=MAIN.measureText(e).width,e))})),d>a&&(a=d),showDiv("TOOLTIP",999),platform.fadeOutTooltips&&(document.getElementById("TOOLTIP").classList.remove("fadeOut"),document.getElementById("TOOLTIP").offsetWidth,document.getElementById("TOOLTIP").classList.add("fadeOut"));var s=.02*mainw;i=Math.max(s,Math.min(mainw-s,i)),n=Math.max(s,Math.min(mainh-s,n)),"number"==typeof a&&(a=Math.max(0,Math.min(mainw-2*s,a))),document.getElementById("TOOLTIP").style.left=i,document.getElementById("TOOLTIP").style.top=n,document.getElementById("TOOLTIP").style.width=a,document.getElementById("TOOLTIP").innerHTML=""!=t?"<center><b>"+e+"</b></center><br>"+t:"<center><b>"+e+"</b></center>";var l=document.getElementById("TOOLTIP").offsetWidth/document.getElementById("TOOLTIP").offsetHeight,r="Shared/Assets/UI/tooltip.png";if(l<.8?r="Shared/Assets/UI/tooltip_narrow.png":l>2.25&&document.getElementById("TOOLTIP").offsetHeight<60?r="Shared/Assets/UI/tooltip_wide_short.png":l>1.75?r="Shared/Assets/UI/tooltip_wide.png":document.getElementById("TOOLTIP").offsetHeight<120&&(r="Shared/Assets/UI/tooltip_small.png"),document.getElementById("TOOLTIP").style.background="url('"+r+"') no-repeat 0 0",document.getElementById("TOOLTIP").style.backgroundSize="100% 100%",document.getElementById("TOOLTIP").getBoundingClientRect().bottom>document.body.getBoundingClientRect().bottom){var h=parseFloat(document.getElementById("TOOLTIP").getBoundingClientRect().top);h-=document.getElementById("TOOLTIP").getBoundingClientRect().bottom-document.body.getBoundingClientRect().bottom,document.getElementById("TOOLTIP").style.top=h}if(document.getElementById("TOOLTIP").getBoundingClientRect().right>document.body.getBoundingClientRect().right){h=parseFloat(document.getElementById("TOOLTIP").getBoundingClientRect().left);h-=document.getElementById("TOOLTIP").getBoundingClientRect().right-document.body.getBoundingClientRect().right,document.getElementById("TOOLTIP").style.left=h}}}function convertCssSizeToPixels(e,t){if("string"==typeof e){if("px"==e.substring(e.length-2))return parseFloat(e.substring(0,e.length-2));if("%"==e[e.length-1]){var i=parseFloat(e.substring(0,e.length-1))/100;if("x"==t)return i*window.innerWidth;if("y"==t)return i*window.innerHeight;throw"convertCssSizeToPixels(): Dimension param must be 'x' or 'y'"}}return parseFloat(e)}function updateUpdatingTooltip(){if(updatingTooltipState&&updatingTooltipState.isLive){var e=updatingTooltipState.updateTextFunction();showTooltip(e.header,e.body,updatingTooltipState.x,updatingTooltipState.y,updatingTooltipState.width)}}function hideTooltip(){hideDiv("TOOLTIP"),updatingTooltipState.isLive=!1,updatingTooltipState.updateTextFunction=null,updatingTooltipState.x=0,updatingTooltipState.y=0,updatingTooltipState.width=120}function showLanguageSelection(){var e=document.getElementById("LANGUAGESELECTIOND");if("visible"!=e.style.visibility){for(var t of e.childNodes)disableOnClickHtmlEvent(t,500);var i;i=platform.getSystemLanguage()==language?"english"==language?"SELECT LANGUAGE &#128491;":translate("Select Language",platform.getSystemLanguage()).toUpperCase()+" (SELECT LANGUAGE) &#128491;":translate("Select Language",language).toUpperCase()+" ("+translate("Select Language",platform.getSystemLanguage()).toUpperCase()+") &#128491;",document.getElementById("selectLanguageTitle").innerHTML=i;var n=document.getElementsByClassName("languageSelection"),a=document.querySelector("[data-language='"+platform.getSystemLanguage()+"']"),o=document.querySelector("[data-language='"+language+"']");null!=a&&a.parentNode.insertBefore(a,n[0]),null!=o&&o.parentNode.insertBefore(o,a),e.style.zIndex=20,e.style.visibility="visible",isMobile()&&"undefined"!=typeof cordova&&navigator.splashscreen&&navigator.splashscreen.hide()}}function hideLanguageSelection(){document.getElementById("LANGUAGESELECTIOND").style.zIndex=-1,document.getElementById("LANGUAGESELECTIOND").style.visibility="hidden"}function setDpi(e,t){if(isMobile()){var i,n,a=e.getContext("2d").font;if(i=e.style.width?"%"!=e.style.width[e.style.width.length-1]?parseFloat(e.style.width):parseFloat(e.style.width)*e.parentElement.clientWidth/100:e.width,n=e.style.height?"%"!=e.style.height[e.style.height.length-1]?parseFloat(e.style.height):parseFloat(e.style.height)*e.parentElement.clientHeight/100:e.height,0!=i&&0!=n){i/=uiScaleX,n/=uiScaleY;var o=e.getContext("2d");e.width=Math.ceil(i*t),e.height=Math.ceil(n*t),o.setTransform(t,0,0,t,0,0),o.font=a}}}function setGlobalDpiScale(e){var t=document.getElementsByTagName("canvas");for(var i in Object.values(t))setDpi(t[i],e)}