var cachedKnownblueprints,lastDepthCached,hasCraftedABlueprint=!1;function canCraftBlueprint(e,n,t=0,r=null,i=!1){if(!i&&!isBlueprintKnown(e,n))return!1;var l=getBlueprintById(e,n);if(!l.craftedItem.item.canCraft())return!1;if(-1==t&&l.levels&&(t=0==Object.keys(l.levels[0]).length||0==l.levels[0].ingredients.length?l.craftedItem.item.getCurrentLevel()+1:l.craftedItem.item.getCurrentLevel()),null===r&&(r=getBlueprintIngredients(e,n,t)),!r)return!1;for(var u in r)if(!r[u].item.hasQuantity(r[u].quantity))return!1;return!0}function canCraftAnyBlueprint(e=-1){var n=getKnownBlueprints(e);for(var t in n)if(canCraftBlueprint(n[t].category,n[t].id))return!0;return!1}function getCraftableBlueprintCount(e=-1){var n=0,t=getKnownBlueprints(e);for(var r in t)canCraftBlueprint(t[r].category,t[r].id,-1)&&++n;return n}function getBlueprintNotCraftableReason(e,n,t=0){if(!isBlueprintKnown(e,n))return _("You do not know this blueprint");var r=getBlueprintById(e,n);if(isBlueprintUpgradeable(e,n)&&(t>r.levels.length-1||t>=r.craftedItem.item.getMaxLevel()))return _("You have fully upgraded this item");if(!r.craftedItem.item.canCraft())return r.craftedItem.item.getNotCraftableReason();var i=getBlueprintIngredients(e,n,t);for(var l in i)if(!i[l].item.hasQuantity(i[l].quantity))return _("You do not have the required ingredients");return""}function craftBlueprint(e,n,t=0,r=null){var i=getBlueprintById(e,n);if(!canCraftBlueprint(e,n,t,r))return!1;for(var l in null===r&&(r=getBlueprintIngredients(e,n,t)),r)r[l].item.spendQuantity(r[l].quantity);return t>0&&i.levels?i.craftedItem.item.upgradeToLevel(t):i.craftedItem.item.grantQuantity(i.craftedItem.quantity),hasCraftedABlueprint=!0,!0}function getBlueprintById(e,n){if(!craftingBlueprints[e])return null;if(craftingBlueprints[e][n]&&craftingBlueprints[e][n].id==n)return craftingBlueprints[e][n];for(var t=0;t<craftingBlueprints[e].length;++t)if(craftingBlueprints[e][t].id==n)return craftingBlueprints[e][t];throw"Invalid blueprint ID"}function getKnownBlueprints(e=-1){if(isSimulating&&-1==e&&lastDepthCached==depth)return cachedKnownblueprints;{for(var n=[],t=0;t<knownBlueprints.length;++t)if(""!=knownBlueprints[t]){var r=knownBlueprints[t].split("."),i=r[0],l=r[1];-1!=e&&e!=i||n.push(getBlueprintById(i,l))}let u=n.sort(((e,n)=>e.id-n.id));return-1==e&&(cachedKnownblueprints=u,lastDepthCached=depth),u}}function getAvailableBlueprints(e=!0){for(var n=[],t=0;t<availableBlueprints.length;++t){var r=availableBlueprints[t].split("."),i=r[0],l=r[1];e&&isBlueprintKnown(i,l)||n.push(getBlueprintById(i,l))}return n}function getUnownedBlueprints(e){return craftingBlueprints[e]?craftingBlueprints[e].filter((n=>!isBlueprintKnown(e,n.id))):[]}function learnBlueprint(e,n,t=!0,r=!1){r||(r=!isBlueprintKnown(e,n)),getBlueprintById(e,n)&&r&&(1==e&&t&&!isDrillBlueprintHigherLevelThanEquippedPart(getBlueprintById(e,n))&&(t=!1),knownBlueprints.push(e+"."+n),isKnownBlueprintsDirty=!0,t&&flagBlueprintAsUnseen(e,n))}function learnAllBlueprints(){for(var e in knownBlueprints=[],craftingBlueprints)for(var n in craftingBlueprints[e])knownBlueprints.push(e+"."+craftingBlueprints[e][n].id),flagBlueprintAsUnseen(e,craftingBlueprints[e][n].id);isKnownBlueprintsDirty=!0}function learnReachedBlueprints(){depth>=1032&&!isBlueprintKnown(1,61)&&(learnRangeOfBlueprints(1,61,69),newNews(_("You reached the moon!")),newNews(_("New blueprints are for sale in the drill center."))),depth>=1814&&!isBlueprintKnown(1,107)&&(learnRangeOfBlueprints(1,107,119),newNews(_("You reached Titan!")),newNews(_("New blueprints are for sale in the drill center."))),learnReachedStructures(),learnReachedDroneBlueprints()}function learnRangeOfBlueprints(e,n,t){for(var r=n;r<=t;++r)learnBlueprint(e,r,!1)}function unlearnBlueprint(e,n){for(var t=0;t<knownBlueprints.length;++t)knownBlueprints[t]==e+"."+n&&knownBlueprints.splice(t)}function makeBlueprintAvailable(e,n){getBlueprintById(e,n)&&!isBlueprintAvailable(e,n)&&(availableBlueprints.push(e+"."+n),isKnownBlueprintsDirty=!0)}function isBlueprintKnown(e,n){for(var t=0;t<knownBlueprints.length;++t)if(knownBlueprints[t]==e+"."+n)return!0;return!1}function isAllBlueprintsInCategoryKnown(e){for(var n in craftingBlueprints[e])if(!isBlueprintKnown(e,craftingBlueprints[e][n].id))return!1;return!0}function isBlueprintAvailable(e,n){for(var t=0;t<availableBlueprints.length;++t)if(availableBlueprints[t]==e+"."+n)return!0;return!1}function getBlueprintNotAvailableReason(e,n){var t=getBlueprintById(e,n);return t.price&&money.lessThan(t.price)?_("You can't afford this blueprint"):""}function getCompleteBlueprintPrice(e){return doBigNumberDecimalMultiplication(e.price,STAT.blueprintPriceMultiplier())}function isBlueprintUnseen(e,n){return unseenBlueprints.includes(e+"."+n)}function flagBlueprintAsUnseen(e,n){isBlueprintUnseen(e,n)||unseenBlueprints.push(e+"."+n)}function flagBlueprintAsSeen(e,n){var t=unseenBlueprints.indexOf(e+"."+n);t>=0&&unseenBlueprints.splice(t,1)}function getUnseenBlueprints(){for(var e=[],n=0;n<unseenBlueprints.length;++n)if(""!=unseenBlueprints[n]){var t=unseenBlueprints[n].split("."),r=t[0],i=t[1];e.push(getBlueprintById(r,i))}return e}function filterBlueprintsByCategory(e,n){return filterBlueprints(e,(function(e){return e.category==n}))}function filterBlueprints(e,n){var t=[];for(var r in e){var i=e[r];if("string"==typeof i){var l=i.split(".");if(2!=l.length)continue;if(!(i=getBlueprintById(l[0],l[1])))continue}n(i)&&t.push(e[r])}return t}function filterBlueprintsByCategoryAndLevel(e,n){return filterBlueprints(e,(function(e){return e.category==n&&isDrillBlueprintHigherLevelThanEquippedPart(e)}))}function filterLowLevelDrillBlueprints(e){return filterBlueprints(e,(function(e){return 1!=e.category||isDrillBlueprintHigherLevelThanEquippedPart(e)}))}function isDrillBlueprintHigherLevelThanEquippedPart(e){var n=getDrillEquipByBlueprintId(e.id);return n.level>drillState.equipFromType(n.type).level}function sortBlueprintsBySubcategory(e){var n={};for(var t in e)n[e[t].subcategory]||(n[e[t].subcategory]=[]),n[e[t].subcategory].push(e[t]);return n}function sortBlueprintsByShopSubcategory(e){var n={};for(var t in e)n[e[t].shopSubcategory]||(n[e[t].shopSubcategory]=[]),n[e[t].shopSubcategory].push(e[t]);return n}function getBlueprintForCraftingItem(e,n){var t;for(var r in t=n?getKnownBlueprints():craftingBlueprints.flat())if(t[r].craftedItem.item.constructor.name==e.constructor.name&&t[r].craftedItem.item.id==e.id)return t[r];return null}function getBlueprintIngredients(e,n,t=0){var r=getBlueprintById(e,n);return r.levels?r.levels[t]?r.levels[t].ingredients:null:r.ingredients}function getRawIngredientsForBlueprint(e,n=0){var t,r={};for(var i in t=e.levels?e.levels[n].ingredients:e.ingredients){var l=getBlueprintForCraftingItem(t[i].item);if(l){var u=getRawIngredientsForBlueprint(l,n);for(var a in u)r[a]||(r[a]=0),r[a]+=u[a]*t[i].quantity}else r[t[i].item.getName()]=t[i].quantity}return r}function generateTooltipForBlueprint(e){var n=getRawIngredientsForBlueprint(e),t="";for(key in n)t+=key+" x"+n[key]+"\n";return{title:e.name,description:t}}function generateHtmlForIngredients(e,n=!0){var t={};for(var r in e)t[e[r].item.getName()]={quantity:e[r].quantity,hasQuantity:e[r].item.hasQuantity(e[r].quantity),image:e[r].item.getIcon(),imageUrl:e[r].item.getIcon().src};var i="";for(var r in t){var l="",u="";if(n)l=t[r].hasQuantity?"":"Insufficient",u="<div class='tooltipImageCheckMark'><img src='"+(t[r].hasQuantity?"Shared/Assets/UI/checkmark2b.png":"Shared/Assets/UI/xmark.png")+"' style='width: 10px; height: 10px;'></div>";i+="<div class='tooltipImageContainer"+l+"'><img src='"+t[r].imageUrl+"' style='width: 40px; height: 40px;'><div class='tooltipImageTextOverlay"+l+"'>x"+shortenNum(t[r].quantity)+"</div>"+u+"</div>"}return i}function generatePrettyBlueprintTooltip(e,n=0){var t=generateHtmlForIngredients(e.levels?e.levels[n].ingredients:e.ingredients);return{title:e.name,description:t}}function isBlueprintUpgradeable(e,n){return!!getBlueprintById(e,n).levels}function initAvailableBlueprints(){learnRangeOfBlueprints(craftingCategories.miners,0,craftingBlueprints[craftingCategories.miners].length-1),learnRangeOfBlueprints(craftingCategories.minerLevels,0,craftingBlueprints[craftingCategories.minerLevels].length-1),learnRangeOfBlueprints(4,0,5);for(var e=0;e<6;e++)learnBlueprint(4,e,!1);learnRangeOfBlueprints(1,0,15),1==hasFoundGolem&&learnRangeOfBlueprints(1,16,31),depth>=225&&(learnRangeOfBlueprints(1,32,47),hasFoundGidget=1),depth>=1032&&learnRangeOfBlueprints(1,61,69),depth>=1257&&learnRangeOfBlueprints(1,79,87),depth>=1814&&learnRangeOfBlueprints(1,107,119),reactor.learnReactorBlueprintsForLevel(),learnReachedStructures(),learnReachedDroneBlueprints()}function hasIngredientsForDrillUpgradeLevel(e){for(var n=0,t=0;t<e.length;t++)e[t].item.hasQuantity(e[t].quantity/10)&&n++;return n>=e.length}function getIngredientListWithDiscounts(e,n=!1){var t=[];for(var r in e)t[r]={item:e[r].item,quantity:getDiscountedIngredientQuantity(e[r],n)};return t}function getRealBlueprintCost(e){let n=new BigNumber(0);return e.forEach((e=>{let t,r=new BigNumber(e.quantity);t=e.item instanceof MoneyCraftingItem||!e.hasOwnProperty("sellValue")?new BigNumber(1):new BigNumber(e.sellValue),n=t.equals(0)?n.add(r.multiply(1800).multiply(valueOfMineralsPerSecond())):n.add(r.multiply(t))})),n}function getDiscountedIngredientQuantity(e,n=!1){return e.item instanceof MoneyCraftingItem?n?doBigNumberDecimalMultiplication(e.quantity,STAT.minerUpgradeAndHireCostMultiplier()):doBigNumberDecimalMultiplication(e.quantity,STAT.blueprintPriceMultiplier()):e.quantity}