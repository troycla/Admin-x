class Scrollbox extends Hitbox{contentWidth;contentHeight;canvas;context;targetContext;scale;cursor="";scrollbarColor="#519650";scrollbarDefaultColor="#519650";scrollbarHoverColor="#51AA50";scrollbarDragColor="#51AA50";scrollbarTroughColor="#151515";currentScrollY=0;isDraggingBar=!1;isScrollbarInitialized=!1;isDirty=!0;isUsingOptimizedRerender=!1;constructor(t,i,s,h,o,e,n,r){var l={x:h,y:o,width:e,height:n};super(l,{},""),this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=Math.max(1e3,i),this.context=this.canvas.getContext("2d"),this.targetContext=s,this.contentWidth=t,this.contentHeight=i,this.boundingBox=l,this.scrollbarWidth=r,this.setScale(),this.onwheel=function(t){this.scroll(t.deltaY)}.bind(this)}render(){this.targetContext.save();var t=this.canvas.width,i=this.boundingBox.height/this.scale,s=this.boundingBox.width-this.scrollbarWidth,h=this.boundingBox.height;i>this.canvas.height&&(h=(i=this.canvas.height)*s/t),this.targetContext.drawImage(this.canvas,0,this.currentScrollY,t,i,this.boundingBox.x,this.boundingBox.y,s,h),this.renderScrollBar(this.targetContext,this.scrollbarWidth),this.isDirty&&(super.render(),this.isDirty=!1),this.targetContext.restore(),this.postRender()}postRender(){}renderScrollBar(t,i){if(this.checkIfScrollbarIsVisible()){var s=this.boundingBox.height*(this.boundingBox.height/this.scale)/this.contentHeight;this.isDraggingBar&&this.scrollTo(this.contentHeight*(this.getLocalCoordinates(mouseX/uiScaleX,mouseY/uiScaleX+this.hitboxYOffset,this).y-s/2)/this.boundingBox.height);this.boundingBox.x,this.boundingBox.width;var h=this.boundingBox.y+this.boundingBox.height*(this.currentScrollY/this.contentHeight);t.save(),t.strokeStyle=this.scrollbarTroughColor,t.lineCap="round",t.lineWidth=this.scrollbarWidth/2,t.beginPath(),t.moveTo(this.boundingBox.x+this.boundingBox.width-i/2,this.boundingBox.y+i/2),t.lineTo(this.boundingBox.x+this.boundingBox.width-i/2,this.boundingBox.y+this.boundingBox.height-i/2),t.stroke(),t.strokeStyle=this.scrollbarColor,t.beginPath(),t.moveTo(this.boundingBox.x+this.boundingBox.width-i/2,h+i/2),t.lineTo(this.boundingBox.x+this.boundingBox.width-i/2,h+s-i/2),t.stroke(),this.isScrollbarInitialized||this.initializeScrollbar(),t.restore()}else this.isScrollbarInitialized&&(this.getHitboxById("scrollbar").setEnabled(!1),this.isScrollbarInitialized=!1),t.save(),t.fillStyle="#777777",t.restore()}initializeScrollbar(){this.clearCanvas(),this.isDirty=!0,this.setScale(),this.currentScrollY+this.boundingBox.height>this.contentHeight&&(this.currentScrollY=this.contentHeight-this.boundingBox.height);var t=this.boundingBox.height*(this.boundingBox.height/this.scale)/this.contentHeight,i=new Hitbox({x:(this.boundingBox.width-this.scrollbarWidth)/this.scale,y:0,width:this.scrollbarWidth/this.scale,height:this.contentHeight},{onmousedown:function(){this.checkIfScrollbarIsVisible()&&(this.isDraggingBar=!0,this.scrollTo(this.contentHeight*(this.getLocalCoordinates(mouseX,mouseY+this.hitboxYOffset,this).y-t/2)/this.boundingBox.height),this.scrollbarColor=this.scrollbarDragColor)}.bind(this),onmousemove:function(){this.checkIfScrollbarIsVisible()&&this.isDraggingBar&&(this.scrollTo(this.contentHeight*(this.getLocalCoordinates(mouseX,mouseY+this.hitboxYOffset,this).y-t/2)/this.boundingBox.height),this.isUsingOptimizedRerender?(this.clearCanvas(),this.render()):animate())}.bind(this),onmouseup:function(){this.isDraggingBar=!1,this.scrollbarColor=this.scrollbarDefaultColor}.bind(this),onmouseenter:function(){this.isDraggingBar||(this.scrollbarColor=this.scrollbarHoverColor)}.bind(this),onmouseexit:function(){this.isDraggingBar||(this.scrollbarColor=this.scrollbarDefaultColor)}.bind(this)},"pointer","scrollbar");i.setEnabled(!0),i.isPermanent=!0,this.deleteHitboxWithId("scrollbar"),this.addHitbox(i),this.isScrollbarInitialized=!0}scroll(t){this.scrollTo(this.currentScrollY+t),this.isUsingOptimizedRerender?(this.clearCanvas(),this.render()):animate()}scrollTo(t){if(!this.checkIfScrollbarIsVisible())return this.currentScrollY=0,void(this.hitboxYOffset=0);this.currentScrollY=t,this.currentScrollY<0?this.currentScrollY=0:this.currentScrollY>this.contentHeight-this.boundingBox.height/this.scale&&(this.currentScrollY=this.contentHeight-this.boundingBox.height/this.scale),this.hitboxYOffset=-this.currentScrollY*this.scale}scrollToTop(){this.scrollTo(0)}scrollToBottom(){this.scrollTo(this.contentHeight)}setContentHeightToIncludeLastChild(t=0){var i=-1;for(var s in this.hitboxes)this.hitboxes[s].boundingBox.y+this.hitboxes[s].boundingBox.height>i&&(i=this.hitboxes[s].boundingBox.y+this.hitboxes[s].boundingBox.height);this.contentHeight=i+t,this.canvas.height=this.contentHeight,this.initializeScrollbar()}setScale(){this.scale=(this.boundingBox.width-this.scrollbarWidth)/this.contentWidth,Math.floor(this.canvas.width)!=Math.floor(this.contentWidth)&&(this.canvas.width=this.contentWidth),Math.floor(this.canvas.height)<Math.floor(this.contentHeight)&&(this.canvas.height=this.contentHeight)}checkIfScrollbarIsVisible(){return this.contentHeight*this.scale>this.boundingBox.height}getScrollbarWidth(){return this.checkIfScrollbarIsVisible()?this.scrollbarWidth:0}clearCanvas(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}generateTestPattern(){for(var t=0;t<this.contentHeight;){for(var i=0;i<this.contentWidth;)this.context.fillStyle=(i+t)%2==0?"white":"black",this.context.fillRect(i,t,55,55),i+=55;t+=55}}}