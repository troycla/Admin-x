const SUPER_MINER_DEPTH=10;class SuperMinerManager{baseSuperMiners=[];currentSuperMiners=[];slots=2;pendingSuperMiner;statBonusCache={};cacheTime;recievedInitialSuperMiner=!1;constructor(){}numSuperMiners(){return this.currentSuperMiners.length}update(e){for(var r=this.numSuperMiners()-1;r>=0;r--)this.currentSuperMiners[r].update(e)}render(){for(var e=this.numSuperMiners()-1;e>=0;e--)this.currentSuperMiners[e]&&this.currentSuperMiners[e].render&&this.currentSuperMiners[e].render()}registerBaseMiner(e){this.baseSuperMiners.push(e)}addSuperMiner(e){if(!this.isFull()&&e){var r=e.clone();return r.init(),this.currentSuperMiners.push(r),r}return null}removePendingSuperMiner(){return!!this.pendingSuperMiner&&(this.pendingSuperMiner=null,!0)}superMinersOnDepth(e){let r=[];for(var t=this.numSuperMiners()-1;t>=0;t--){let i=this.currentSuperMiners[t];i.currentDepth==e&&r.push(i)}return r}buffsForDepth(e){let r={minerals:0,isotopes:0};if(e<0)return r;for(var t=this.numSuperMiners()-1;t>=0;t--){let i=this.currentSuperMiners[t];i.type==superMinerTypes.MINER&&i.affectedDepth==e&&("mineral"==i.subType?r.minerals+=i.getMiningSpeed():"isotope"==i.subType&&(r.isotopes+=i.getMiningSpeed()))}return r}filterBaseSuperMiners(e,r={},t=!0){if(null==e)return this.baseSuperMiners;var i=function(t){for(var i in e){if("isOwned"==i){if(this.isSuperMinerOwned(t.id)!=e[i])return!1}else if(void 0===t[i]||t[i]!=e[i])return!1}for(var i in r){if("isOwned"==i){if(this.isSuperMinerOwned(t.id)==e[i])return!1}else if(void 0!==t[i]&&t[i]==r[i])return!1}return!0}.bind(this),s=t?"filter":"find";return this.baseSuperMiners[s](i)}isSuperMinerOwned(e){return void 0!==this.currentSuperMiners.find((r=>r.id==e))}getRandomBaseSuperMiner(e=null,r={}){let t=this.filterBaseSuperMiners(e,r);return t[blackChestRewardRoller.rand(0,t.length-1)]}removeSuperMinerById(e){this.currentSuperMiners=this.currentSuperMiners.filter((r=>r.uniqueId!=e))}getSuperMinerById(e){return this.filterBaseSuperMiners({id:e},{},!1)}isFull(){return this.numSuperMiners()>=this.slots}nextSlotCost(){let e=this.slots;return 5*Math.round(e**1.5*Math.log10(e)*35/5)}canUpgradeSlot(){return worldResources[SUPER_MINER_SOULS_INDEX].numOwned>=this.nextSlotCost()}upgradeSlots(){worldResources[SUPER_MINER_SOULS_INDEX].numOwned-=this.nextSlotCost(),this.slots++}dirtyCache(){this.cacheTime=currentTime()}getStatBonus(e){if(void 0===this.statBonusCache[e]||this.statBonusCache[e].cacheTime<this.cacheTime){let i=0;for(var r=0;r<this.numSuperMiners();r++){let s=this.currentSuperMiners[r];if(s.statBonuses)for(var t=0;t<s.statBonuses.length;t++){let r=s.statBonuses[t];r.id==e&&(i+=r.amount())}}this.statBonusCache[e]={amount:i,cacheTime:currentTime()}}return this.statBonusCache[e].amount}get saveState(){for(var e=[this.slots],r=0;r<this.numSuperMiners();r++)e.push(this.currentSuperMiners[r].getSaveString());return e.join("*")}set saveState(e){if(""!=e){var r=e.split("*");this.slots=parseInt(r[0]);for(var t=1;t<r.length;t++){var i=r[t].split("!"),s=this.getSuperMinerById(i[0]);this.addSuperMiner(s).restore(i)}}}debugAddRandomSuperMiner(e=null){var r=this.getRandomBaseSuperMiner(e);return!!r&&(this.isFull()&&this.slots++,this.addSuperMiner(r),!0)}addAllSuperMiners(){this.currentSuperMiners=[],this.baseSuperMiners.forEach((e=>{this.addSuperMiner(e),this.slots++})),this.currentSuperMiners.sort(((e,r)=>e.rarity.id-r.rarity.id))}}var superMinerManager=new SuperMinerManager;