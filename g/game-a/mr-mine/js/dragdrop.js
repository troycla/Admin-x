const DEFAULT_PIXEL_DISTANCE_TO_TREAT_AS_DRAGGING=6;var activeDraggingInstance,activeDroppableInstance,numDragDropSprites=0;class DragDropUIComponent extends Hitbox{displayType;isDropRegion=!1;dropTypesAccepted=[];isDraggable=!1;mouseDistanceThresholdBeforeTreatedAsDragged=6;parentBeforeDrag;xPositionDisplayBeforeDrag;yPositionDisplayBeforeDrag;xPositionMouseBeforeDrag=-1;yPositionMouseBeforeDrag=-1;isDropCandidate=!1;constructor(e){super(e,{},"pointer","DD_"+ ++numDragDropSprites),this.allowBubbling=!0}onmouseenter(e){this.isDropRegion&&null!=activeDraggingInstance&&this!=activeDraggingInstance&&this.dropTypesAccepted.indexOf(activeDraggingInstance.displayType)>-1&&(activeDroppableInstance=this,this.onSelectedAsDropCandidate(activeDraggingInstance))}onmouseexit(e){null!=activeDraggingInstance&&activeDroppableInstance==this?(activeDroppableInstance=null,this.onUnselectedAsDropCandidate()):this.isDraggable&&null==activeDraggingInstance&&this.xPositionMouseBeforeDrag>-1&&this.beginDrag()}onmousedown(e){this.isDraggable&&null==activeDraggingInstance&&(this.xPositionMouseBeforeDrag=mouseX,this.yPositionMouseBeforeDrag=mouseY,this.onmousemove(e))}onmouseup=function(e){this.isDraggable&&null==activeDraggingInstance&&(this.xPositionMouseBeforeDrag=-1,this.yPositionMouseBeforeDrag=-1)}.bind(this);onmousemove(e){if(this.isDraggable&&null==activeDraggingInstance&&this.xPositionMouseBeforeDrag>-1){var t=this.mouseDistanceThresholdBeforeTreatedAsDragged<=0;if(!t){var i=Math.pow(this.xPositionMouseBeforeDrag-mouseX,2),n=Math.pow(this.yPositionMouseBeforeDrag-mouseY,2);t=Math.sqrt(i+n)>=this.mouseDistanceThresholdBeforeTreatedAsDragged}t&&this.beginDrag()}}beginDrag(){this.xPositionDisplayBeforeDrag=this.boundingBox.x,this.yPositionDisplayBeforeDrag=this.boundingBox.y,this.parentBeforeDrag=this.parent,this.parent.deleteHitboxWithId(this.id),this.parent.onChildRemoved(),this.parent=activeLayers.Stage,activeLayers.Stage.addHitbox(this),activeDraggingInstance=this,document.addEventListener("mousemove",this.onStageMouseMove),document.addEventListener("mouseup",this.onStageMouseUp),activeLayers.Stage.showStage(),this.boundingBox.x=mouseX-this.boundingBox.width/2,this.boundingBox.y=mouseY-this.boundingBox.height/2,this.onDragStarted()}onStageMouseMove(e){activeDraggingInstance&&(activeDraggingInstance.boundingBox.x=mouseX-activeDraggingInstance.boundingBox.width/2,activeDraggingInstance.boundingBox.y=mouseY-activeDraggingInstance.boundingBox.height/2)}onStageMouseUp(e){document.removeEventListener("mousemove",activeDraggingInstance.onStageMouseMove),document.removeEventListener("mouseup",activeDraggingInstance.onStageMouseUp),activeLayers.Stage.hideStage(),null!=activeDroppableInstance?("DragDropUIComponent"==typeof parentBeforeDrag&&parentBeforeDrag.onDropRemoved(activeDraggingInstance),activeDroppableInstance.onAcceptDrop(activeDraggingInstance),activeDroppableInstance.onUnselectedAsDropCandidate()):activeDraggingInstance.onDropFailed(),activeDraggingInstance.onDragEnded(),activeDraggingInstance.xPositionMouseBeforeDrag=-1,activeDraggingInstance.yPositionMouseBeforeDrag=-1,activeDraggingInstance=null,activeDroppableInstance=null}onDropFailed(){this.parent=this.parentBeforeDrag,this.parent.addHitbox(this),this.boundingBox.x=this.xPositionDisplayBeforeDrag,this.boundingBox.y=this.yPositionDisplayBeforeDrag,this.xPositionMouseBeforeDrag=-1,this.yPositionMouseBeforeDrag=-1}onChildRemoved(){}onAcceptDrop(){activeLayers.Stage.deleteHitboxWithId(activeDraggingInstance.id)}onDropRemoved(){}onDragStarted(){}onDragEnded(){}onSelectedAsDropCandidate(){this.isDropCandidate=!0}onUnselectedAsDropCandidate(){this.isDropCandidate=!1}render(){super.render()}}