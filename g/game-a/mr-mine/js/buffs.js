class StaticBuff{id;stat;name;image;pausedDuringTimelapse;isSaved=!0;canGetFromChestsAndTrades=!0;onStartFunction;updateFunction;endingFunction;canStartFunction=function(){return!0};constructor(t){this.id=t}}class Buff extends StaticBuff{statBuffAmount;durationSeconds;millisecondsRemaining;startSource;tier;constructor(t){super(t),Object.assign(this,buffs.getStaticBuffById(t))}secondsElapsed(){return this.durationSeconds-Math.floor(this.millisecondsRemaining/1e3)}formattedDescription(){return _(this.description,this.statBuffAmount,Math.round(this.durationSeconds/60))}getSaveString(){return[this.id,this.statBuffAmount,this.durationSeconds,this.millisecondsRemaining,this.startSource,this.tier].join("!")}createFromSaveString(t){var e=t.split("!");this.id=parseInt(e[0]),Object.assign(this,buffs.getStaticBuffById(this.id)),this.statBuffAmount=parseFloat(e[1]),this.durationSeconds=parseInt(e[2]),this.millisecondsRemaining=parseInt(e[3]),this.startSource=e[4],this.tier=parseInt(e[5])}}class Buffs{staticBuffs=[];activeBuffs=[];get saveState(){for(var t=[],e=0;e<this.activeBuffs.length;e++)this.activeBuffs[e].isSaved&&t.push(this.activeBuffs[e].getSaveString());return t.join("*")}set saveState(t){if(""!=t)for(var e=t.split("*"),i=0;i<e.length;i++){var f=new Buff;f.createFromSaveString(e[i]),isNaN(f.id)||this.activeBuffs.push(f)}}getChestAndTradeBuffs(){return this.staticBuffs.filter((t=>t.canGetFromChestsAndTrades))}getStaticBuffById(t){return this.staticBuffs[t]}registerStaticBuff(t){this.staticBuffs[t.id]=t}update(){for(var t=!1,e=this.activeBuffs.length-1;e>=0;e--)isTimelapseOn&&this.activeBuffs[e].pausedDuringTimelapse||(this.activeBuffs[e].millisecondsRemaining-=1e3,null!=this.activeBuffs[e].updateFunction&&this.activeBuffs[e].updateFunction()),"BuffLab"==this.activeBuffs[e].startSource&&(t=!0,bufflab.totalSecsBuffed++),this.getBuffTimeRemaining(e)<=0&&(null!=this.activeBuffs[e].endingFunction&&this.activeBuffs[e].endingFunction(),this.activeBuffs.splice(e,1));t?bufflab.maxConsecutiveSecondsBuffed++:bufflab.maxConsecutiveSecondsBuffed=0}startBuff(t,e,i,f=0,s=0){var n=new Buff(t);if(n.canStartFunction()){e*=STAT.buffDurationMultiplier(),n.durationSeconds=e,n.millisecondsRemaining=1e3*e,n.startSource=i,n.statBuffAmount=f,n.tier=s;var a=this.getExistingMatchingBuff(n);null!=a?(a.millisecondsRemaining+=1e3*e,a.durationSeconds+=e):(this.activeBuffs.push(n),isSimulating||activeLayers.MainUILayer.displayNewBuff(this.activeBuffs.length-1))}}getExistingMatchingBuff(t){for(var e=0;e<this.activeBuffs.length;e++)if(this.activeBuffs[e].id==t.id&&this.activeBuffs[e].tier==t.tier&&this.activeBuffs[e].startSource==t.startSource)return this.activeBuffs[e];return null}endAllBuffs(){for(var t=this.activeBuffs.length-1;t>=0;t--)null!=this.activeBuffs[t].endingFunction&&this.activeBuffs[t].endingFunction();this.activeBuffs=[]}numActiveBuffs(){return this.activeBuffs.length}numActiveChestBuffs(){var t=0;return this.activeBuffs.forEach((e=>{"Chest"==e.startSource&&t++})),t}isBuffWithIdRunning(t){for(var e=this.activeBuffs.length-1;e>=0;e--)if(this.activeBuffs[e].id==t)return!0;return!1}getBuffValue(t){for(var e=0,i=0;i<this.activeBuffs.length;i++)this.activeBuffs[i].stat.id==t&&(isTimelapseOn&&this.activeBuffs[i].pausedDuringTimelapse||(e+=this.activeBuffs[i].statBuffAmount));return e}getBuffTimeRemaining(t){return this.activeBuffs[t].millisecondsRemaining}getBuffPercentComplete(t){return Math.min(1,1-this.activeBuffs[t].millisecondsRemaining/1e3/this.activeBuffs[t].durationSeconds)}showBuffTooltip(t,e,i){this.numActiveBuffs()>t&&showUpdatingTooltip(function(t){if(this.numActiveBuffs()>t){var e=this.activeBuffs[t],i=e.formattedDescription(),f=this.getBuffTimeRemaining(t);return i+="<br>"+(e.pausedDuringTimelapse?_("Paused during timelapse"):_("Active during timelapse"))+"<br><center>"+formattedCountDown(f/1e3)+"</center>",{header:e.name,body:"<center>"+i+"</center>"}}return{header:"",body:""}}.bind(this,t),e,i)}showInactiveBuffTooltip(t,e,i,f,s){var n=this.staticBuffs[t].name,a=_(this.staticBuffs[t].description,f,s);showTooltip(n,a,e,i)}}var newStaticBuff,buffs=new Buffs;(newStaticBuff=new StaticBuff(0)).stat=MINER_SPEED_MULTIPLIER,newStaticBuff.name=_("Miner Speed Potion"),newStaticBuff.description=_("Increases the speed miners find minerals by {0}% for {1} minutes"),newStaticBuff.image=speedPotion1,newStaticBuff.pausedDuringTimelapse=!1,buffs.registerStaticBuff(newStaticBuff),(newStaticBuff=new StaticBuff(1)).stat=CHEST_SPAWN_FREQUENCY,newStaticBuff.name=_("Key of Luck"),newStaticBuff.description=_("Increases chest spawn frequency by {0}% for {1} minutes"),newStaticBuff.image=whiteKey,newStaticBuff.pausedDuringTimelapse=!0,buffs.registerStaticBuff(newStaticBuff),(newStaticBuff=new StaticBuff(2)).stat=PERCENT_CHANCE_OF_SELLING_FOR_DOUBLE,newStaticBuff.name=_("Midas Touch"),newStaticBuff.description=_("Increases chance of selling for 2x the price when selling minerals and isotopes by {0}% for {1} minutes"),newStaticBuff.image=goldHand,newStaticBuff.pausedDuringTimelapse=!0,newStaticBuff.isSaved=!1,buffs.registerStaticBuff(newStaticBuff),(newStaticBuff=new StaticBuff(3)).stat=ISOTOPE_DISCOVERY_CHANCE_MULTIPLIER,newStaticBuff.name=_("Elemental Pike"),newStaticBuff.description=_("Increases the chance of finding isotopes by {0}% for {1} minutes"),newStaticBuff.image=basicPike,newStaticBuff.pausedDuringTimelapse=!1,buffs.registerStaticBuff(newStaticBuff),(newStaticBuff=new StaticBuff(4)).stat=CHEST_MONEY_MULTIPLIER,newStaticBuff.name=_("Nugget of Attraction"),newStaticBuff.description=_("Increases money from treasure chests by {0}% for {1} minutes"),newStaticBuff.image=goldRock,newStaticBuff.pausedDuringTimelapse=!0,buffs.registerStaticBuff(newStaticBuff),(newStaticBuff=new StaticBuff(5)).stat=DRILL_SPEED_MULTIPLIER,newStaticBuff.name=_("Drill Speed Potion"),newStaticBuff.description=_("Increases drill speed by {0}% for {1} minutes"),newStaticBuff.image=speedPotion3,newStaticBuff.pausedDuringTimelapse=!1,buffs.registerStaticBuff(newStaticBuff),(newStaticBuff=new StaticBuff(6)).stat=UNUSED_STAT,newStaticBuff.name=_("Raining Chests"),newStaticBuff.description=_("Drastically increases the rate treasure chests spawn for 30 seconds. (All chest despawn when the time is up)"),newStaticBuff.image=basicChest,newStaticBuff.pausedDuringTimelapse=!0,newStaticBuff.isSaved=!1,newStaticBuff.updateFunction=function(){null!=this.millisecondsRemaining&&this.millisecondsRemaining>=5e3&&chestService.spawnChestAtRandomDepth(Chest.buff)},newStaticBuff.endingFunction=function(){chestService.removeChestsBySource(Chest.buff)},newStaticBuff.canStartFunction=function(){return!buffs.isBuffWithIdRunning(6)},buffs.registerStaticBuff(newStaticBuff),(newStaticBuff=new StaticBuff(7)).stat=CARGO_CAPACITY_MULTIPLIER,newStaticBuff.name=_("Cargo Expansion"),newStaticBuff.description=_("Increases cargo capacity by {0}% for {1} minutes"),newStaticBuff.image=purpleBag,newStaticBuff.pausedDuringTimelapse=!1,newStaticBuff.canGetFromChestsAndTrades=!1,buffs.registerStaticBuff(newStaticBuff),(newStaticBuff=new StaticBuff(8)).stat=GEM_SPEED_MULTIPLIER,newStaticBuff.name=_("Endless Gem Speed Potion"),newStaticBuff.description=_("Decrease gem crafting time by {0}% for {1} minutes"),newStaticBuff.image=speedPotion4,newStaticBuff.pausedDuringTimelapse=!1,newStaticBuff.canGetFromChestsAndTrades=!1,buffs.registerStaticBuff(newStaticBuff),(newStaticBuff=new StaticBuff(9)).stat=RELIC_MULTIPLIER,newStaticBuff.name=_("Relic Effectiveness"),newStaticBuff.description=_("Increases the effectiveness of your relics by {0}% for {1} minutes"),newStaticBuff.image=superIcon7,newStaticBuff.pausedDuringTimelapse=!1,newStaticBuff.canGetFromChestsAndTrades=!1,buffs.registerStaticBuff(newStaticBuff);