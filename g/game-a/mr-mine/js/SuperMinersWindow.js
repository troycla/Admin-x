class SuperMinersWindow extends TabbedPopupWindow{layerName="Super";domElementId="SUPERD";context=SPR;zIndex=5;popupFrameImage=smFrame;slotsPerRow=4;fractionalSlotPadding=.025;superMinerHitboxes=[];constructor(t,e,i=!1){super(t),t||this.setBoundingBox(),this.initializeTabs(),this.windowYOffset=this.tabHeight-.023*this.boundingBox.height,this.bodyContainer.boundingBox={x:.037*this.boundingBox.width,y:this.windowYOffset+.048*this.boundingBox.height,width:.909*this.boundingBox.width,height:.877*(this.boundingBox.height-this.windowYOffset)},this.headerHeight=.1*this.bodyContainer.boundingBox.height,this.worldIndex=e,this.showScrapButtons=i,this.lastAnimation=currentTime(),this.sortedBy="",this.miners=superMinerManager.currentSuperMiners,this.initializeHitboxes(),this.intializeSortButtons(),this.initializeScrollboxContents(),this.sortSuperMiners()}initializeHitboxes(){var t=this.windowYOffset+.149*(this.boundingBox.height-this.windowYOffset);this.superMinerPane=new Scrollbox(this.bodyContainer.boundingBox.width-15,0,this.context,this.bodyContainer.boundingBox.x,t,this.bodyContainer.boundingBox.width,this.bodyContainer.boundingBox.height-t+2*this.windowYOffset,15),this.superMinerPane.scrollToTop(),this.addHitbox(this.superMinerPane)}intializeSortButtons(){var t=.95*this.headerHeight,e=(1-.95)/2*this.headerHeight,i=-t/2;this.createSortButton("rarity","left",{x:i+this.bodyContainer.boundingBox.width-3*t,y:e,width:t,height:t}),this.createSortButton("level","middle",{x:i+this.bodyContainer.boundingBox.width-2*t,y:e,width:t,height:t}),this.createSortButton("type","right",{x:i+this.bodyContainer.boundingBox.width-t,y:e,width:t,height:t})}createSortButton(t,e,i){var n=this.bodyContainer.addHitbox(new Hitbox(i,{onmousedown:()=>{this.sortSuperMiners(t)}},"pointer",""));n.render=function(i){var n=this.getRelativeCoordinates(0,0,i);let o=window[e+(i.sortedBy==t?"SMButtonDim":"SMButton")],s=window[t+(i.sortedBy==t?"dimSMIcon":"SMIcon")];i.context.drawImage(o,n.x,n.y,this.boundingBox.width,this.boundingBox.height),i.context.drawImage(s,n.x,n.y,this.boundingBox.width,this.boundingBox.height)}.bind(n,this)}initializeScrollboxContents(){this.superMinerPane.clearHitboxes(),this.superMinerPane.contentHeight=0,this.superMinerHitboxes=[];var t=this.superMinerPane.contentWidth*this.fractionalSlotPadding;this.slotWidth=(this.superMinerPane.contentWidth-t*(this.slotsPerRow+1))/this.slotsPerRow,this.slotHeight=getScaledImageDimensions(superMinerRarities.common.smallFrame,this.slotWidth).height,this.slotYPadding=this.showScrapButtons?.3*this.slotHeight:t;for(var e=0;e<superMinerManager.numSuperMiners();e++){let i=getItemCoordsInList(this.slotWidth,this.slotHeight,t,this.slotYPadding,this.slotsPerRow,e),n=i.x,o=i.y,s=this.miners[e];this.superMinerHitboxes.push(this.superMinerPane.addHitbox(new Hitbox({x:n,y:o,width:this.slotWidth,height:this.slotHeight},{onmousedown:()=>{this.showScrapButtons||(openUi(SuperMinerWindow,null,s),s.currentDepth&&panToViewDepth(Math.min(depth,s.currentDepth)))}},"pointer","superMiner_"+e))),this.showScrapButtons&&this.superMinerPane.addHitbox(new Hitbox({x:n,y:o+this.slotHeight,width:this.slotWidth,height:.25*this.slotHeight},{onmousedown:()=>{showConfirmationPrompt(_("Are you sure you want to scrap {0} for {1} Super Miner Souls?",s.name,s.scrapAmount()),_("Yes"),(()=>{s.scrap(),this.miners=superMinerManager.currentSuperMiners,this.initializeScrollboxContents()}),_("No"))}},"pointer","scrapButton_"+e))}let i=getItemCoordsInList(this.slotWidth,this.slotHeight,t,this.slotYPadding,this.slotsPerRow,e);this.purchaseButton=this.superMinerPane.addHitbox(new Hitbox({x:i.x,y:i.y,width:this.slotWidth,height:this.slotHeight},{onmousedown:()=>{superMinerManager.canUpgradeSlot()?showConfirmationPrompt(_("Purchase another super miner slot for {0} Super Miner Souls",superMinerManager.nextSlotCost()),_("Purchase"),(()=>{superMinerManager.upgradeSlots()}),_("Cancel")):activeLayers.SuperMinerSelectorWindow||showConfirmationPrompt(_("You don't have enough Super Miner Souls. Open more Black Chests or scrap Super Miners",superMinerManager.nextSlotCost()),_("Open Black Chests"),(()=>{openUi(PurchaseWindow,null,0,Math.abs(purchaseWindowTabOrder-1))}),_("Scrap Super Miners"),(()=>{this.showScrapButtons=!0,this.initializeScrollboxContents(),this.superMinerPane.scrollToBottom()}))}},"pointer","purchaseSlotButton"));var n=this.slotWidth/2;this.trashButton=this.superMinerPane.addHitbox(new Hitbox({x:.5*(this.superMinerPane.boundingBox.width-n),y:i.y+this.slotHeight+this.slotYPadding,width:n,height:n},{onmousedown:()=>{activeLayers.SuperMinerSelectorWindow||(this.showScrapButtons=!this.showScrapButtons,this.initializeScrollboxContents(),this.superMinerPane.scrollToBottom())}},"pointer","trash")),this.superMinerPane.setContentHeightToIncludeLastChild(),this.superMinerPane.scrollToTop()}close(){if(!activeLayers.SuperMinerSelectorWindow||activeLayers.SuperMinerSelectorWindow.madeAChoice)return super.close();{let t=activeLayers.SuperMinerSelectorWindow.superMiner;showConfirmationPrompt(_("Are you sure you want to scrap {0} for {1} Super Miner Souls?",t.name,t.scrapAmount()),_("Yes"),(()=>{t.scrap(),activeLayers.SuperMinerSelectorWindow.madeAChoice=!0,closeUi(activeLayers.SuperMinerSelectorWindow),closeUi(this)}),_("No"))}}sortSuperMiners(t){"rarity"==t?this.miners.sort(((t,e)=>e.rarity.id-t.rarity.id)):"level"==t?this.miners.sort(((t,e)=>e.level-t.level)):"type"==t?this.miners.sort(((t,e)=>e.type-t.type)):this.miners.sort(((t,e)=>(e.hasButton&&1==e.percentageUntilAction())-(t.hasButton&&1==t.percentageUntilAction()))),this.sortedBy=t,this.initializeScrollboxContents()}render(){this.context.save(),this.context.clearRect(0,0,this.boundingBox.width,this.boundingBox.height),this.context.restore(),super.render(),this.context.font=.05*this.boundingBox.height+"px KanitM",this.context.textBaseline="middle",this.superMinerPane.context.clearRect(0,0,this.superMinerPane.contentWidth,this.superMinerPane.contentHeight),this.context.fillStyle=superMinerManager.isFull()?"#FF0000":"#FFFFFF",this.context.textBaseline="middle",fillTextShrinkToFit(this.context,_("Slots: {0}/{1}",superMinerManager.numSuperMiners(),superMinerManager.slots),0,this.bodyContainer.boundingBox.y+this.headerHeight/2,this.boundingBox.width,"center");var t=.95*this.headerHeight;this.context.fillStyle="#FFFFFF";let e=worldResources[SUPER_MINER_SOULS_INDEX];this.context.drawImage(e.largeIcon,.05*this.boundingBox.width,this.bodyContainer.boundingBox.y+(this.headerHeight-t)/2,.06*this.boundingBox.width,.06*this.boundingBox.width),fillTextShrinkToFit(this.context,e.numOwned,.12*this.boundingBox.width,this.bodyContainer.boundingBox.y+this.headerHeight/2,this.boundingBox.width,"left"),this.superMinerPane.context.font=.1*this.superMinerPane.boundingBox.height+"px KanitM",this.superMinerPane.context.fillStyle="#000000";for(var i=0;i<superMinerManager.numSuperMiners();i++){let t=this.miners[i],e=t.buttonIcon,o=t.needsProgressBar?t.rarity.smallFrame:t.rarity.smallFrameNoFill,s=t.portrait,r=this.superMinerHitboxes[i];if(r){let h=r.boundingBox,a=t.needsProgressBar?.045*h.width:.36*h.width;h.width;t.needsProgressBar&&(this.superMinerPane.context.fillStyle="#000000",this.superMinerPane.context.fillRect(h.x+.33*h.width,h.y+.78*h.height,.65*h.width,.195*h.height),this.superMinerPane.context.fillStyle="#FF8800",this.superMinerPane.context.fillRect(h.x+.33*h.width,h.y+.78*h.height,.65*h.width*t.percentageUntilAction(),.195*h.height)),o&&o.drawAnimation?(o.phaseShift=7*i,o.drawAnimation(this.superMinerPane.context,h.x,h.y,h.width,h.height)):this.superMinerPane.context.drawImage(o,h.x,h.y,h.width,h.height),drawImageFitInBox(this.superMinerPane.context,s,h.x+.04*h.width,h.y+.145*h.height,.92*h.width,.6*h.height),this.superMinerPane.context.font=.05*this.superMinerPane.boundingBox.height+"px KanitB",this.superMinerPane.context.textBaseline="bottom";var n=[this.superMinerPane.context,_("LVL. {0}",t.level),h.x,h.y+.75*h.height,h.width,"center"];this.superMinerPane.context.lineWidth=3,this.superMinerPane.context.strokeStyle="#000000",strokeTextShrinkToFit(...n),this.superMinerPane.context.fillStyle="#FFFFFF",fillTextShrinkToFit(...n),e&&this.superMinerPane.context.drawImage(e,0,0,e.width,e.height,h.x+a,h.y+.79*h.height,.27*h.width,.27*h.width),this.superMinerPane.context.fillStyle="#000000",this.superMinerPane.context.textBaseline="middle",fillTextWrapWithHeightLimit(this.superMinerPane.context,t.name,h.x,h.y+.08*h.height,h.width,.1*h.height,"center")}let h=this.superMinerPane.getHitboxById("scrapButton_"+i);h&&(this.superMinerPane.context.drawImage(stopb,0,0,stopb.width,stopb.height,h.boundingBox.x,h.boundingBox.y,h.boundingBox.width,h.boundingBox.height),this.superMinerPane.context.lineWidth=5,this.superMinerPane.context.strokeStyle="#000000",this.superMinerPane.context.fillStyle="#FFFFFF",this.superMinerPane.context.textBaseline="middle",strokeTextWrapWithHeightLimit(this.superMinerPane.context,_("Scrap"),h.boundingBox.x+.1*h.boundingBox.width,h.boundingBox.y+.5*h.boundingBox.height,.8*h.boundingBox.width,.7*h.boundingBox.height,"center"),fillTextWrapWithHeightLimit(this.superMinerPane.context,_("Scrap"),h.boundingBox.x+.1*h.boundingBox.width,h.boundingBox.y+.5*h.boundingBox.height,.8*h.boundingBox.width,.7*h.boundingBox.height,"center"))}let o=this.purchaseButton;this.superMinerPane.context.drawImage(smallAddFrame,0,0,smallAddFrame.width,smallAddFrame.height,o.boundingBox.x,o.boundingBox.y,o.boundingBox.width,o.boundingBox.height),this.superMinerPane.context.font=.05*this.superMinerPane.boundingBox.height+"px KanitM",this.superMinerPane.context.fillStyle=superMinerManager.canUpgradeSlot()?"#bebebe":"#b65d5e",this.superMinerPane.context.drawImage(e.smallIcon,0,0,e.smallIcon.width,e.smallIcon.height,o.boundingBox.x+.15*o.boundingBox.width,o.boundingBox.y+.7*o.boundingBox.height,.03*this.boundingBox.width,.03*this.boundingBox.width),fillTextWrapWithHeightLimit(this.superMinerPane.context,superMinerManager.nextSlotCost(),o.boundingBox.x+.4*o.boundingBox.width,o.boundingBox.y+.8*o.boundingBox.height,.5*o.boundingBox.width,.7*o.boundingBox.height,"left");let s=this.trashButton,r=this.showScrapButtons?window.trashb2:window.trashb;this.superMinerPane.context.drawImage(r,0,0,r.width,r.height,s.boundingBox.x,s.boundingBox.y,s.boundingBox.width,s.boundingBox.height)}}