const MINING_DISPLAY_TYPE_NONE=0,MINING_DISPLAY_TYPE_CALCULATE=1,MINING_DISPLAY_TYPE_FAKE=2;class WanderingSuperMinerRenderer{heightFraction;yOffset;leftBound;rightBound;flipHorizontal=!1;minMiningTime=5;maxMiningTime=12;walkSpeed=65;drillingSpritesheet;walkingSpritesheet;parent;facingRight=!0;currentPos;targetPos;moveTime;currentStateTimer=0;isWalking=!1;hasStartedStateAnimation=!1;miningDisplayType=0;mineralsFound=[];constructor(e){this.parent=e,void 0===this.heightFraction&&(this.heightFraction=worldConfig.superMiners.height),void 0===this.yOffset&&(this.yOffset=worldConfig.superMiners.yOffset),void 0===this.leftBound&&(this.leftBound=worldConfig.superMiners.leftBound),void 0===this.rightBound&&(this.rightBound=worldConfig.superMiners.rightBound),this.currentPos=(this.rightBound-this.leftBound)*Math.random()}getSpritePosition(){let e=0,t=worldConfig.topBound+worldConfig.levelHeight*(this.parent.currentDepth-(currentlyViewedDepth+partialDepthOffset-worldConfig.numberOfDepthsVisible)-this.heightFraction+this.yOffset);if(this.isWalking){let t=1-this.currentStateTimer/this.moveTime;e=lerp(this.currentPos,this.targetPos,t)*worldConfig.levelWidth}else e=worldConfig.levelWidth*this.currentPos;return e+=worldConfig.leftBound,{x:e,y:t}}updateSpriteState(e){this.currentStateTimer<=0?this.isWalking?(this.isWalking=!1,this.currentStateTimer=this.minMiningTime+Math.random()*(this.maxMiningTime-this.minMiningTime),this.currentPos=this.targetPos,this.hasStartedStateAnimation=!1):(this.isWalking=!0,this.setNewTargetPosition(),this.currentStateTimer=this.moveTime,this.hasStartedStateAnimation=!1):this.currentStateTimer-=e}setNewTargetPosition(){this.targetPos=this.leftBound+Math.random()*(this.rightBound-this.leftBound),this.moveTime=worldConfig.levelWidth*Math.abs(this.currentPos-this.targetPos)/this.walkSpeed,this.facingRight=this.targetPos>this.currentPos}render(e){this.updateSpriteState(renderDeltaTime/1e3);if(currentlyViewedDepth+partialDepthOffset-2-worldConfig.numberOfDepthsVisible<=this.parent.currentDepth&&this.parent.currentDepth<=currentlyViewedDepth+partialDepthOffset+2){var t,i=this.getSpritePosition();if(e.save(),!this.isWalking&&this.drillingSpritesheet){if(t=this.drillingSpritesheet,1==quality&&!isCapacityFull())if(1==this.miningDisplayType){for(var r=this.mineralsFound.length-1;r>=0;r--)this.mineralsFound[r].frames--,this.mineralsFound[r].frames<=0&&this.mineralsFound.splice(r,1);var n=estimatedMineralsPerMinuteAtLevel(this.parent.currentDepth,!0).reduce(((e,t)=>e+t),0)-estimatedMineralsPerMinuteAtLevel(this.parent.currentDepth,!1).reduce(((e,t)=>e+t),0),s=1e3*(p=12)/20,h=Math.round(s*n/6e4),a=20;if(Math.min(h,a)>this.mineralsFound.length&&0==rand(0,2)){var l=getSingleRandomMineralTypeAtDepthByWeight(this.parent.currentDepth),o=(rand(0,250)-125)/50;this.mineralsFound.push({mineralType:l,frames:p,xVel:o})}for(r=0;r<this.mineralsFound.length;r++){var d=this.mineralsFound[r].frames,g=this.mineralsFound[r].mineralType,m=(p-d)*this.mineralsFound[r].xVel;e.globalAlpha=MINERAL_COLLECTED_POPUP_ALPHA_SEQUENCE[d];var u=2*MINERAL_COLLECTED_POPUP_OFFSET_SEQUENCE[d];e.drawImage(worldResources[g].smallIcon,i.x+m+worldConfig.levelHeight*this.heightFraction/2-Math.ceil(.012*mainw)/2,i.y+u,Math.floor(.021*mainh),Math.floor(.021*mainh)),e.globalAlpha=1}}else if(2==this.miningDisplayType){for(r=this.mineralsFound.length-1;r>=0;r--)this.mineralsFound[r].frames--,this.mineralsFound[r].frames<=0&&this.mineralsFound.splice(r,1);var p;n=estimatedMineralsPerMinuteAtLevel(this.parent.currentDepth,!0).reduce(((e,t)=>e+t),0)/2,s=1e3*(p=12)/20,h=Math.round(s*n/6e4),a=20;if(Math.min(h,a)>this.mineralsFound.length&&0==rand(0,2)){l=getSingleRandomMineralTypeAtDepthByWeight(this.parent.currentDepth),o=(rand(0,250)-125)/50;this.mineralsFound.push({mineralType:l,frames:p,xVel:o})}for(r=0;r<this.mineralsFound.length;r++){d=this.mineralsFound[r].frames,g=this.mineralsFound[r].mineralType,m=(p-d)*this.mineralsFound[r].xVel;e.globalAlpha=MINERAL_COLLECTED_POPUP_ALPHA_SEQUENCE[d];u=2*MINERAL_COLLECTED_POPUP_OFFSET_SEQUENCE[d];e.drawImage(worldResources[g].smallIcon,i.x+m+worldConfig.levelHeight*this.heightFraction/2-Math.ceil(.012*mainw)/2,i.y+u,Math.floor(.021*mainh),Math.floor(.021*mainh)),e.globalAlpha=1}}}else t=this.walkingSpritesheet;if(this.facingRight^this.flipHorizontal){var f=fitBoxInBox(t.frameWidth,t.spritesheet.height,i.x,i.y,worldConfig.levelHeight*this.heightFraction,worldConfig.levelHeight*this.heightFraction);e.scale(-1,1),i.x=-(f.x+f.width)}this.hasStartedStateAnimation||(this.hasStartedStateAnimation=!0,t.goToFrame(0));t.drawAnimation(e,i.x,i.y,worldConfig.levelHeight*this.heightFraction,worldConfig.levelHeight*this.heightFraction,!0);e.restore()}}}class DrillMinerRenderer{parent;drillingSpritesheet;constructor(e){this.parent=e}update(){}render(e){if(currentlyViewedDepth>=depth-2){var t,i,r=worldConfig.levelHeight,n=r;isMobile()?(t=.5*(mainw-r),i=worldConfig.topBound+worldConfig.levelHeight*(worldConfig.numberOfDepthsVisible-1+depth-currentlyViewedDepth+.1)):(t=.818*mainw,i=worldConfig.topBound+worldConfig.levelHeight*(worldConfig.numberOfDepthsVisible-1+depth-currentlyViewedDepth)-this.drillingSpritesheet.spritesheet.height),this.drillingSpritesheet.drawAnimation(e,t,i,r,n)}}}