class UiLayer{layerName="";boundingBox;hitboxes;hitboxXOffset=0;hitboxYOffset=0;scale=1;isPopup=!1;_isEnabled=!0;_isVisible=!0;initialUiScaleX;initialUiScaleY;onOpen=new EventHook;onClose=new EventHook;constructor(t,i=[]){this.boundingBox=t,this.hitboxes=i,this.initialUiScaleX=uiScaleX,this.initialUiScaleY=uiScaleY}update(t){this.updateChildren(t)}render(){this.renderChildren()}updateChildren(t){if(this.hitboxes)for(var i=0;i<this.hitboxes.length;++i)this.hitboxes[i].update&&this.hitboxes[i].update(t)}renderChildren(){if(this.hitboxes)for(var t=0;t<this.hitboxes.length;++t)this.hitboxes[t].isVisible()&&this.hitboxes[t].render&&this.hitboxes[t].render()}addHitbox(t,i=!0,e=-1){if(i){var o=this.getAbsoluteScale();t.boundingBox.x*=o,t.boundingBox.y*=o,t.boundingBox.width*=o,t.boundingBox.height*=o}return e<0?this.hitboxes.push(t):this.hitboxes.splice(e,0,t),t.parent=this,t.onBecomeChild(this),t}onBecomeChild(t){}getHitboxById(t){for(var i in this.hitboxes)if(this.hitboxes[i].id==t)return this.hitboxes[i];return null}getHitboxIndexById(t){for(var i in this.hitboxes)if(this.hitboxes[i].id==t)return parseInt(i);return null}deleteHitboxWithId(t){var i=this.getHitboxIndexById(t);(i||0===i)&&this.deleteHitboxAtIndex(i)}deleteHitboxAtIndex(t){t>=0&&t<this.hitboxes.length&&this.hitboxes.splice(t,1)}enableAllHitboxes(){for(var t in this.hitboxes)this.hitboxes[t]._isEnabled=!0}disableAllHitboxes(){for(var t in this.hitboxes)this.hitboxes[t]._isEnabled=!1}clearHitboxes(){for(var t=[],i=0;i<this.hitboxes.length;++i)this.hitboxes[i].isPermanent&&t.push(this.hitboxes[i]);this.hitboxes=t}isMouseInLayer(){var t={},i=this.getGlobalCoordinates(0,0),e=this.getGlobalCoordinates(this.boundingBox.width,this.boundingBox.height);return t.x=i.x,t.y=i.y,t.width=e.x-i.x,t.height=e.y-i.y,isMouseWithinBounds(t)}findMatchingHitboxInLayer(){if(!this.hitboxes||0==this.hitboxes.length)return null;for(var t=0;t<this.hitboxes.length;++t)if(this.hitboxes[t].isEnabled()){var i=this.getGlobalCoordinates(this.hitboxes[t].boundingBox.x,this.hitboxes[t].boundingBox.y);if(i.x+=this.hitboxXOffset,i.y+=this.hitboxYOffset,i.width=this.hitboxes[t].boundingBox.width,i.height=this.hitboxes[t].boundingBox.height,isMouseWithinBounds(i))return this.hitboxes[t]}return null}findMatchingHitboxes(){if(!this.hitboxes||0==this.hitboxes.length)return[];for(var t=[],i=0;i<this.hitboxes.length;++i)if(this.hitboxes[i].isEnabled()&&("undefined"==typeof worldConfig||void 0===this.hitboxes[i].kmDepth||!(this.hitboxes[i].kmDepth>currentlyViewedDepth+1||this.hitboxes[i].kmDepth<currentlyViewedDepth-worldConfig.numberOfDepthsVisible-1))){var e=this.getGlobalCoordinates(this.hitboxes[i].boundingBox.x,this.hitboxes[i].boundingBox.y);e.x+=this.hitboxXOffset,e.y+=this.hitboxYOffset,e.width=this.hitboxes[i].boundingBox.width,e.height=this.hitboxes[i].boundingBox.height,isMouseWithinBounds(e)&&(t.push(this.hitboxes[i]),t=t.concat(this.hitboxes[i].findMatchingHitboxes()))}return t}getLayerOffset(t=!0){var i=this.boundingBox.x,e=this.boundingBox.y;return this.hitboxXOffset&&t&&(i+=this.hitboxXOffset),this.hitboxYOffset&&t&&(e+=this.hitboxYOffset),{x:i,y:e}}getGlobalCoordinates(t,i,e=!0){for(var o,s=this.boundingBox.x,h=this.boundingBox.y,n=this;n.parent;)s+=(o=n.parent.getLayerOffset(e)).x,h+=o.y,n=n.parent;return{x:t+s,y:i+h}}getLocalCoordinates(t,i){for(var e=this.getLayerOffset(),o=e.x,s=e.y,h=this;h.parent;)o+=(e=h.parent.getLayerOffset()).x,s+=e.y,h=h.parent;return{x:t-o,y:i-s}}getRelativeCoordinates(t,i,e,o=!0){var s=this.getGlobalCoordinates(0,0,o),h=e.getGlobalCoordinates(0,0,o);return{x:Math.floor(t+(s.x-h.x)),y:Math.floor(i+(s.y-h.y))}}getContext(){var t=this.getFirstElementWithContext();return t?t.context:null}getFirstElementWithContext(){if(this.context)return this;for(var t=this.parent;t;){if(t.context)return t;t=t.parent}return null}getRootLayer(){for(var t=this;t.parent;)t=t.parent;return t}getAbsoluteScale(){for(var t=this.scale,i=this;i.parent;)t*=i.parent.scale,i=i.parent;return t}rescaleBoundingBoxOnResize(){for(var t in this.boundingBox.x*=this.initialUiScaleX/uiScaleX,this.boundingBox.y*=this.initialUiScaleY/uiScaleY,this.boundingBox.width*=this.initialUiScaleX/uiScaleX,this.boundingBox.height*=this.initialUiScaleY/uiScaleY,this.initialUiScaleX=uiScaleX,this.initialUiScaleY=uiScaleY,this.hitboxes)this.hitboxes[t].rescaleBoundingBoxOnResize()}getBoundingBoxForAllChildren(){var t=this.boundingBox.x,i=this.boundingBox.x+this.boundingBox.width,e=this.boundingBox.y,o=this.boundingBox.y+this.boundingBox.height;for(var s in this.hitboxes)t=Math.min(this.hitboxes[s].boundingBox.x),i=Math.max(this.hitboxes[s].boundingBox.x+this.hitboxes[s].boundingBox.width),e=Math.min(this.hitboxes[s].boundingBox.y),o=Math.max(this.hitboxes[s].boundingBox.y+this.hitboxes[s].boundingBox.height);return{x:t,y:e,width:i-t,height:o-e}}clearCanvas(){this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height)}isVisible(){return this._isVisible}isEnabled(){return this._isEnabled}setVisible(t){this._isVisible=t}setEnabled(t){this._isEnabled=t}isDescendantOf(t){for(var i=this;i=i.parent;)if(i==t)return!0;return!1}isAncestorOf(t){for(var i=t;i=i.parent;)if(i==this)return!0;return!1}}class Hitbox extends UiLayer{isFixed=!1;isPermanent=!1;constructor(t,i,e,o=null){super(t);for(const[t,e]of Object.entries(i))this[t]=e;this.cursor=e,this.id=o||"hitbox_"+rand(0,9999999)}render(){super.render()}getRelativeBoundingBoxCoordinates(){return{x:(this.boundingBox.x/this.getRootLayer().boundingBox.width).toFixed(4),y:(this.boundingBox.y/this.getRootLayer().boundingBox.height).toFixed(4),width:(this.boundingBox.width/this.getRootLayer().boundingBox.width).toFixed(4),height:(this.boundingBox.height/this.getRootLayer().boundingBox.height).toFixed(4)}}stringifyRelativeBoundingBox(){var t="{\n",i=this.getRelativeBoundingBoxCoordinates();return t+="    x: "+i.x+" * this.boundingBox.width,\n",t+="    y: "+i.y+" * this.boundingBox.height,\n",t+="    width: "+i.width+" * this.boundingBox.width,\n",t+="    height: "+i.height+" * this.boundingBox.height\n",t+="}"}exportToJsCode(){var t,i,e=this.getRootLayer(),o="";for(var s in this.layerName||(this.parent&&!this.parent.layerName?(this.parent,void 0!==e[t=this.parent.id]&&(t="this."+t)):(e,t="this"),void 0!==e[this.id]?i="this."+this.id:(i=this.id,o+="var "),o+=i+" = new Hitbox(\n",o+="    "+this.stringifyRelativeBoundingBox()+",\n",o+="    {},\n",o+='    "'+this.cursor+'",\n',o+='    "'+this.id+'"\n',o+="}\n",o+=t+".addHitbox("+i+");\n"),this.hitboxes)o+=this.hitboxes[s].exportToJsCode();return o}}class WorldEntityHitbox extends Hitbox{kmDepth;constructor(t,i,e,o,s=""){i.y+=(.111*mainh+.178*(t+4)*mainh)/uiScaleY,super(i,e,o,s),this.kmDepth=t}}class NewWorldEntityHitbox extends Hitbox{kmDepth;maxDistanceFromViewportToRender=6;constructor(t,i,e,o,s=""){var h=worldConfig.topBound,n=worldConfig.levelHeight;i.y+=h+(t+worldConfig.numberOfDepthsVisible-1)*n/uiScaleY,super(i,e,o,s),this.kmDepth=t}isVisible(){var t=getVisibleDepthRange();return this.kmDepth>=t.min-this.maxDistanceFromViewportToRender&&this.kmDepth<=t.max+this.maxDistanceFromViewportToRender}}class Button extends Hitbox{text;image;font;color;context;useNineSliceRendering=!1;constructor(t,i,e,o,s,h,n,r=""){super(s,h,n,r),this.text=i,this.image=t,this.font=e,this.color=o}render(){if(this.context||(this.root=this.getFirstElementWithContext(),this.context=this.root.context),this.useNineSliceRendering){i=this.getRelativeCoordinates(0,0,this.root);var t=this.context;t.save(),t.font=this.font,t.fillStyle=this.color,t.textBaseline="middle",t.lineWidth=.08*this.boundingBox.height,drawNineSlice(t,this.image,i.x,i.y,this.boundingBox.width,this.boundingBox.height,31,24),fillTextShrinkToFit(t,this.text,i.x+.075*this.boundingBox.width,i.y+.51*this.boundingBox.height,.85*this.boundingBox.width,"center"),t.restore()}else{var i=this.getRelativeCoordinates(0,0,this.root);renderButton(this.context,this.image,this.text,i.x,i.y,this.boundingBox.width,this.boundingBox.height,this.font,this.color),super.render()}}}class TooltipImage extends Hitbox{image;tooltipHeader;tooltipBody;constructor(t,i,e,o,s,h,n,r,x=""){super(r,{onmouseenter:function(){showTooltip(h,n)},onmouseexit:function(){hideTooltip()}},"pointer",x),this.image=t,this.imageX=i,this.imageY=e,this.imageHeight=o,this.imageWidth=s,this.tooltipHeader=h,this.tooltipBody=n}render(){this.parent.context&&(this.parent.context.drawImage(this.image,this.imageX,this.imageY,this.imageWidth,this.imageHeight,this.boundingBox.x,this.boundingBox.y,this.boundingBox.width,this.boundingBox.height),super.render())}}