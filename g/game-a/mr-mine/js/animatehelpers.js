const FONT_SIZE_REGEX=new RegExp("^([0-9]+)px");function getCanvasTextHeightCenterOffset(e,t){var a=e.measureText(t);return(a.actualBoundingBoxAscent-a.actualBoundingBoxDescent)/2}function renderButton(e,t,a,i,r,l,n,h,o){e.save(),e.drawImage(t,0,0,t.width,t.height,i,r,l,n),e.fillStyle=o,e.font=h,e.textBaseline="middle",fillTextShrinkToFit(e,a,i+Math.round(.1*l),r+n/2,Math.round(.8*l),"center",.15),e.restore()}function renderButtonScaled(e,t,a,i,r,l,n,h,o){var d=e.font,c=e.fillStyle;e.drawImage(t,0,0,t.width,t.height,i,r,l,n),e.fillStyle=o,setFontToFit(e,a,l,n,h),e.fillText(a,i+l/2-e.measureText(a).width/2,r+n/2+getCanvasTextHeightCenterOffset(e,a)),e.font=d,e.fillStyle=c}function setFontToFit(e,t,a,i,r){let l=r,n=r.match(FONT_SIZE_REGEX);if(n){let r=.9*a,h=.95*i,o=parseInt(n[1]),d=e.measureText(t),c=d.actualBoundingBoxAscent-d.actualBoundingBoxDescent;(d.width>r||c>h)&&(widthFontSize=Math.floor(o*Math.min(1,r/d.width)),heightFontSize=Math.floor(o*Math.min(1,h/c)),l=l.replace(FONT_SIZE_REGEX,Math.min(widthFontSize,heightFontSize)+"px"))}e.font=l}function renderCheckbox(e,t,a,i,r,l,n,h){var o=e.fillStyle,d=e.strokeStyle;e.strokeStyle=n,e.fillStyle=l,e.fillRect(t,a,i,r),e.strokeRect(t,a,i,r),h&&e.drawImage(checkmark2b,0,0,checkmark2b.width,checkmark2b.height,t,a,i,r),e.fillStyle=o,e.strokeStyle=d}function relativeWidth(e,t=1280){return e.width/t*window.innerWidth}function relativeHeight(e,t=720){return e.height/t*window.innerHeight}function renderCheckboxWithText(e,t,a,i,r,l,n,h,o,d,c){renderCheckbox(e,r,l,n,h,o,d,c);var m=e.font,s=e.fillStyle;e.fillStyle=i,e.font=a,e.fillText(t,r+n+.1*n,l+h/2+getCanvasTextHeightCenterOffset(e,t)),e.font=m,e.fillStyle=s}var keepCopy=[];function modifyImageWithNewText(e,t,a,i,r,l){var n=document.createElement("canvas");n.width=e.naturalWidth,n.height=e.naturalHeight;var h=n.getContext("2d");h.drawImage(e,0,0,e.naturalWidth,e.naturalHeight),h.font=a,h.fillStyle=i,h.fillText(t,l-h.measureText(t).width/2,n.height/2+r);var o=n.toDataURL();e.src=o,keepCopy.push(o)}function drawImageLoop(e,t,a,i,r,l,n){e.drawImage(t,0,0,t.width*(1-n),t.height,a+r*n,i,r*(1-n),l),e.drawImage(t,t.width*(1-n),0,t.width*n,t.height,a,i,r*n,l)}function drawVerticalImageLoop(e,t,a,i,r,l,n){e.drawImage(t,0,0,t.width,t.height*(1-n),a,i+l*n,r,l*(1-n)),e.drawImage(t,0,t.height*(1-n),t.width,t.height*n,a,i,r,l*n)}function drawTiledImage(e,t,a,i,r,l,n,h){for(var o=a,d=i;d<i+l;){var c=Math.max(1,1-Math.abs(o+n-r)/n),m=Math.max(1,1-Math.abs(d+h-l)/h);e.drawImage(t,0,0,t.width*c,t.height*m,o,d,n*c,h*m),(o+=n)>=a+r&&(o=a,d+=h)}}function setupButtons(){document.getElementById("fontLoader1").style.display="none",document.getElementById("fontLoader1").style.visibility="hidden",document.getElementById("fontLoader2").style.display="none",document.getElementById("fontLoader2").style.visibility="hidden",document.getElementById("fontLoader3").style.display="none",document.getElementById("fontLoader3").style.visibility="hidden",document.getElementById("fontLoader4").style.display="none",document.getElementById("fontLoader4").style.visibility="hidden",paypalhtml=generateShopHtml(),modifyImageWithNewText(document.getElementById("cng"),_("CREATE"),"14px Verdana","#000000",3,document.getElementById("cng").width/2),modifyImageWithNewText(document.getElementById("cngc"),_("CANCEL"),"14px Verdana","#000000",3,document.getElementById("cngc").width/2),document.getElementById("gameNameText").innerHTML=_(document.getElementById("gameNameText").innerHTML)}function generateShopHtml(){}function drawDashedLine(e,t,a,i,r,l,n=1,h=1,o=1){e.save();var d=e.strokeStyle;e.strokeStyle=l,e.lineWidth=n,e.beginPath(),e.setLineDash([h,o]),e.moveTo(t,a),e.lineTo(i,r),e.stroke(),e.strokeStyle=d,e.restore()}function renderProgressBar(e,t,a,i,r,l,n,h,o,d){e.save(),e.lineWidth=1,e.textBaseline="middle",e.strokeStyle=o,e.fillStyle=o,e.drawImage(a,0,0,1,1,r,l,n,h),e.drawImage(i,0,0,1,1,r,l,n*d,h),e.drawImage(i,0,0,1,1,r,l,n*d,h),e.strokeRect(r,l,n,h),e.fillText(t,r+n/2-e.measureText(t).width/2,l+h/2),e.restore()}var gr=.4;function renderFancyProgressBar(e,t,a,i,r,l,n,h,o,d,c,m=!0,s=null){var g,w,f;if(s?(g=s.frameWidth,w=s.frameRightShadowWidth,f=s.frameBottomShadowHeight):(g=4,w=0,f=0),a=Math.max(0,Math.min(1,a)),e.save(),e.font="14px Verdana",e.textBaseline="middle",e.fillStyle=o,e.fillRect(i+1,r+1,l-2,n-2),e.fillStyle=h,e.fillRect(i+1,r+1,(l-1)*a,n-2),m){var u=e.createLinearGradient(i+1,r+1-n*gr,i+1,r+1+n-2+n/4);u.addColorStop(0,"#FFFFFF"),u.addColorStop(.4,h),u.addColorStop(.6,h),u.addColorStop(1,"#000000"),e.fillStyle=u,e.fillRect(i+1,r+1,(l-1)*a,n-2)}e.globalAlpha=1,c&&drawFrame(e,c,i,r,l,n,g,g,w,f),e.fillStyle=d,e.strokeStyle="#000000",e.lineWidth=3,e.textBaseline="middle",strokeTextShrinkToFit(e,t,i+.05*l,r+n/2+1,.9*l,"center"),fillTextShrinkToFit(e,t,i+.05*l,r+n/2+1,.9*l,"center"),e.restore()}function generateFullMineScreenshot(){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=mainw-Math.ceil(.082*mainw),e.height=mainh-.11*mainh,currentlyViewedDepth=0;for(var a="";currentlyViewedDepth<depth-5;)t.clearRect(0,0,e.width,e.height),t.drawImage(MAIN.canvas,Math.ceil(.082*mainw),Math.ceil(.11*mainh)+1,mainw-Math.ceil(.082*mainw),mainh-(Math.ceil(.11*mainh)+1),0,0,e.width,e.height),a+="<img src='"+e.toDataURL("image/png").replace("image/png","image/octet-stream")+"'>",currentlyViewedDepth+=5,animate();document.body.innerHTML=a}var currentScroll=0,totalHeight=53e3;function smoothScroll(){var e=Math.max(Math.min(.004*totalHeight,.025*currentScroll),5);currentScroll+=e,window.scroll({top:currentScroll,left:0}),currentScroll<totalHeight&&setTimeout(smoothScroll,17)}function drawImageRot(e,t,a,i,r,l,n,h,o,d,c,m=0,s=0){var g=c*Math.PI/180;e.translate(s+n+o/2,h+d/2),e.rotate(g),e.drawImage(t,a,i,r,l,s/2+o/2*-1,m/2+d/2*-1,o,d),e.rotate(-1*g),e.translate(-1*(s+n+o/2),-1*(h+d/2))}function drawImageFitInBox(e,t,a,i,r,l,n="center",h="center"){var o=fitBoxInBox(t.width,t.height,a,i,r,l,n,h);return e.drawImage(t,o.x,o.y,o.width,o.height),o}function greyScaleRect(e,t,a,i,r,l){colorSaturate(e,a,i,r,l,"#FFF",t)}function colorSaturate(e,t,a,i,r,l,n){e.save(),e.globalCompositeOperation="saturation",e.fillStyle="hsl(0,"+Math.round(100*n)+"%,50%)",e.fillStyle=l,e.globalAlpha=n,e.fillRect(t,a,i,r),e.restore()}function drawBlurredImage(e,t,a,i,r,l,n,h,o,d,c){drawImageWithFilters(e,t,a,i,r,l,n,h,o,d,"blur("+c+"px)")}function drawInvertedImage(e,t,a,i,r,l,n,h,o,d){drawImageWithFilters(e,t,a,i,r,l,n,h,o,d,"invert(1)")}function drawHueRotatedImage(e,t,a,i,r,l,n,h,o,d,c){drawImageWithFilters(e,t,a,i,r,l,n,h,o,d,"hue-rotate("+c+"deg)")}function drawContrastedImage(e,t,a,i,r,l,n,h,o,d,c){drawImageWithFilters(e,t,a,i,r,l,n,h,o,d,"contrast("+c+"%)")}function drawImageWithFilters(e,t,a,i,r,l,n,h,o,d,c){e.save(),e.filter=c,e.drawImage(t,a,i,r,l,n,h,o,d),e.restore()}function drawWavy(e,t,a,i,r,l){var n=l,h=.25*r,o=.5*r,d=.75*r,c=r,m=t.width/r,s=t.height/l,g=document.createElement("canvas"),w=g.getContext("2d");w.filter="invert(1) contrast(200%) hue-rotate(180deg) grayscale(33%)",w.drawImage(t,0,0,t.width,t.height,0,0,t.width,t.height);for(var f=0;f<n;f+=6){var u=h+1.25*Osc(numFramesRendered,.2*f,.05),I=o+1.25*Osc(numFramesRendered,.2*f,.03),y=d+1.25*Osc(numFramesRendered,.2*f,.06),v=u,S=I-u,T=y-I,p=c-y;e.drawImage(g,0*m,f*s,h*m,6*s,a,i+f,v,6),e.drawImage(g,h*m,f*s,(o-h)*m,6*s,a+u-.5,i+f,S,6),e.drawImage(g,o*m,f*s,(d-o)*m,6*s,a+I-1,i+f,T,6),e.drawImage(g,d*m,f*s,(c-d)*m,6*s,a+y-1.5,i+f,p,6)}e.restore()}function Osc(e,t,a){e=3*e*a;return Math.sin(e+t*a*10)}const CHANNELS=["r","g","b"],CHANNELS_INCLUDING_ALPHA=["r","g","b","a"];var chromaShiftChannelData={};function drawChromaShift(e,t,a,i,r,l,n){const h=document.createElement("canvas"),o=h.getContext("2d");if(h.width=l,h.height=n,t=t+"_"+l,!chromaShiftChannelData.hasOwnProperty(t)){chromaShiftChannelData[t]={},o.filter="invert(1) contrast(200%) hue-rotate(180deg) grayscale(33%)",o.drawImage(a,0,0,h.width,h.height);var d=o.getImageData(0,0,h.width,h.height);o.filter="",CHANNELS.forEach((e=>{chromaShiftChannelData[t][e]=o.createImageData(d.width,d.height);const a=chromaShiftChannelData[t][e].data,i=d.data;for(let t=0;t<i.length;t+=4)a[t]="r"===e?i[t]:0,a[t+1]="g"===e?i[t+1]:0,a[t+2]="b"===e?i[t+2]:0,a[t+3]=i[t+3]}))}e.save(),e.globalCompositeOperation="screen",e.globalAlpha=1;var c={r:{x:-1.33*oscillate(numFramesRendered,9),y:1*oscillate(numFramesRendered,5)},g:{x:.5*oscillate(numFramesRendered,3),y:.25*oscillate(numFramesRendered,2)},b:{x:1*oscillate(numFramesRendered,11),y:-1.5*oscillate(numFramesRendered,7)}};CHANNELS.forEach((a=>{o.clearRect(0,0,l,n),o.putImageData(chromaShiftChannelData[t][a],0,0),e.drawImage(h,0,0,h.width,h.height,i+c[a].x,r+c[a].y,l,n)})),e.restore()}function drawBlessedEffect(e,t,a,i,r,l,n=""){if(1==quality){e.save();for(var h=2;h<36;h++){var o=Math.floor((getAnimationFrameIndex(3e3,10)+h)/28),d=Math.pow(h,o)%101,c=Math.pow(h,o)%49,m=a+r*Math.abs(Math.cos(d)),s=i+l*Math.abs(Math.sin(c));e.globalAlpha=1-oscillate(getAnimationFrameIndex(3e3,10)+h,14),e.fillStyle="#FFFFFF",e.fillRect(m,s,1,1)}e.restore()}if(e.save(),"???"!=n){e.shadowBlur=15;var g=.75+.22*oscillate(numFramesRendered,18);e.shadowColor="rgba(255, 255, 64, "+g+")"}e.filter="brightness("+(180+60*oscillate(numFramesRendered,40))+"%) saturate(200%)",e.globalAlpha=1;const w=document.createElement("canvas"),f=w.getContext("2d");w.width=r,w.height=l,getAnimationFrameIndex(32,10)<4&&(f.globalAlpha=.5,f.drawImage(shineOverlay,shineOverlay.width/4*getAnimationFrameIndex(4,10),0,Math.floor(shineOverlay.width/4),shineOverlay.height,0,0,r,l),f.globalAlpha=1),f.globalCompositeOperation="destination-atop",f.drawImage(t,0,0,t.width,t.height,0,0,r,l),e.drawImage(w,0,0,r,l,a,i,r,l),e.restore()}var cachedTintedAssetData={};function drawTintedImage(e,t,a,i,r,l,n,h,o,d){const c=document.createElement("canvas"),m=c.getContext("2d");if(c.width=l,c.height=n,t=t+"_"+Math.floor(l),!cachedTintedAssetData.hasOwnProperty(t)){cachedTintedAssetData[t]={},m.drawImage(a,0,0,c.width,c.height);var s=m.getImageData(0,0,c.width,c.height);CHANNELS_INCLUDING_ALPHA.forEach((e=>{cachedTintedAssetData[t][e]=m.createImageData(s.width,s.height);const a=cachedTintedAssetData[t][e].data,i=s.data;for(let t=0;t<i.length;t+=4)a[t]="r"===e?i[t]:0,a[t+1]="g"===e?i[t+1]:0,a[t+2]="b"===e?i[t+2]:0,a[t+3]=i[t+3]/2}))}e.save(),e.globalAlpha=1,e.globalCompositeOperation="lighter",m.globalCompositeOperation="lighter",h>0&&(m.clearRect(0,0,l,n),m.globalAlpha=h,m.putImageData(cachedTintedAssetData[t].r,0,0),e.drawImage(c,0,0,c.width,c.height,i,r,l,n)),o>0&&(m.clearRect(0,0,l,n),m.globalAlpha=o,m.putImageData(cachedTintedAssetData[t].g,0,0),e.drawImage(c,0,0,c.width,c.height,i,r,l,n)),d>0&&(m.clearRect(0,0,l,n),m.globalAlpha=d,m.putImageData(cachedTintedAssetData[t].b,0,0),e.drawImage(c,0,0,c.width,c.height,i,r,l,n)),e.restore()}function standardRelicRenderFunction(e,t,a,i,r,l){if(e.save(),"???"!=excavationRewards[t].name){e.shadowBlur=11;var n=.2+.22*oscillate(numFramesRendered,8);e.shadowColor="rgba(164, 252, 166, "+n+")"}var h=excavationRewards[t].image;e.drawImage(h,0,0,h.width,h.height,a,i,r,l),e.restore()}function warpedRelicRenderFunction(e,t,a,i,r,l){drawChromaShift(e,"reward_"+t,excavationRewards[t].image,a,i,r,l)}function divineRelicRenderFunction(e,t,a,i,r,l){drawBlessedEffect(e,excavationRewards[t].image,a,i,r,l,excavationRewards[t].name)}function renderChestSliderDots(){for(var e=0;e<worldClickables.length;e++)if(worldClickables[e].type==MINERAL_DEPOSIT_ID||worldClickables[e].type==CAVE_SYSTEM_ID||worldClickables[e].type==ORANGE_FISH_ID&&metalDetectorStructure.level>4){if(metalDetectorStructure.level>4){var t=worldClickables[e].expireTime-currentTime();if(t<120){var a=Math.max(3,t/60*8);MAIN.globalAlpha=.25+.75*oscillate(numFramesRendered,a)}}worldClickables[e].type==MINERAL_DEPOSIT_ID?MAIN.drawImage(clickableDot,0,0,6,10,Math.ceil(.0544*mainw),Math.ceil(mainh*(.317+Math.min(worldClickables[e].depth+2,depth)/depth*.49))-Math.ceil(.007*mainh),Math.floor(.0048*mainw),Math.ceil(.007*mainh)):worldClickables[e].type==CAVE_SYSTEM_ID?MAIN.drawImage(caveClickableDot,0,0,10,10,Math.ceil(.0544*mainw),Math.ceil(mainh*(.317+Math.min(worldClickables[e].depth+2,depth)/depth*.49))-Math.ceil(.007*mainh),Math.floor(.0048*mainw),Math.ceil(.007*mainh)):worldClickables[e].type==ORANGE_FISH_ID&&MAIN.drawImage(orangeClickableDot,0,0,6,10,Math.ceil(.0544*mainw),Math.ceil(mainh*(.317+Math.min(worldClickables[e].depth+2,depth)/depth*.49))-Math.ceil(.007*mainh),Math.floor(.0048*mainw),Math.ceil(.007*mainh)),metalDetectorStructure.level>4&&(MAIN.globalAlpha=1)}if(metalDetectorStructure.level>1)for(e=chestService.chests.length;e>0;e--){let t=chestService.chests[e-1],i=sliderc;if(metalDetectorStructure.level>2&&(t.type==ChestType.gold?i=sliderg:t.type==ChestType.black&&(i=sliderblack)),metalDetectorStructure.level>4&&t.source==Chest.natural.name&&t.timeToLive<=120){a=Math.max(3,t.timeToLive/60*8);MAIN.globalAlpha=.25+.75*oscillate(numFramesRendered,a)}MAIN.drawImage(i,0,0,6,10,Math.ceil(.0544*mainw),Math.ceil(mainh*(.3165+Math.min(t.depth,depth)/depth*.49))-Math.ceil(.007*mainh),Math.floor(.0048*mainw),Math.ceil(.007*mainh)),metalDetectorStructure.level>4&&(MAIN.globalAlpha=1)}if(battleWaiting.length>0){var i=battleWaiting[1];MAIN.drawImage(battleDot,0,0,6,10,Math.ceil(.0544*mainw),Math.ceil(mainh*(.3165+Math.min(i+2,depth)/depth*.49))-Math.ceil(.007*mainh),Math.floor(.0048*mainw),Math.ceil(.007*mainh))}}function drawTradeAsSymbols(e,t,a,i,r,l){e.save();var n=.14*r,h=.12*r,o=generateTradeOfferStrings(t);TRADINGPOST.globalCompositeOperation="destination-over",e.fillStyle="#FFFFFF",e.textBaseline="top",e.font="14px Verdana";var d=fillTextWrap(e,_("YOU PAY:"),a+r/4-n/4-(r/2-n/2-10)/2,i+5,r/2-n/2-10,"center",.25),c=drawTradeIcon(e,t[TRADE_INDEX_PAYMENT_TYPE],t[TRADE_INDEX_PAYMENT_SUBTYPE],a+r/4-n/4-27.5,d.y2+5,55,55),m=fillTextWrap(e,o.paymentString,a+r/4-n/4-(r/2-n/2-10)/2,d.y2+55+10,r/2-n/2-10,"center",.25),s=fillTextWrap(e,_("YOU RECEIVE:"),a+3*r/4+n/4-(r/2-n/2-10)/2,i+5,r/2-n/2-10,"center",.25),g=drawTradeIcon(e,t[TRADE_INDEX_REWARD_TYPE],t[TRADE_INDEX_REWARD_SUBTYPE],a+3*r/4+n/4-27.5,s.y2+5,55,55),w=fillTextWrap(e,o.rewardString,a+3*r/4+n/4-(r/2-n/2-10)/2,s.y2+55+10,r/2-n/2-10,"center",.25);return m.y2>l&&(l=m.y2-i+5),w.y2>l&&(l=w.y2-i+5),e.fillStyle="#FFFFFF",e.strokeStyle="#FFFFFF",e.lineWidth=3,e.beginPath(),e.moveTo(a+r/2-n/2,i+l/2+h/4),e.lineTo(a+r/2+n/12,i+l/2+h/4),e.lineTo(a+r/2+n/12,i+l/2+h/2),e.lineTo(a+r/2+n/2,i+l/2),e.lineTo(a+r/2+n/12,i+l/2-h/2),e.lineTo(a+r/2+n/12,i+l/2-h/4),e.lineTo(a+r/2-n/2,i+l/2-h/4),e.closePath(),e.fill(),e.globalCompositeOperation="destination-over",e.fillStyle="#555555",e.fillRect(a,i,r,l),e.restore(),{x1:a,y1:i,x2:a+r,y2:i+l,width:r,height:l,children:{paymentIcon:c,rewardIcon:g}}}function drawTradeIcon(e,t,a,i,r,l=20,n=20){switch(t){case TRADE_TYPE_ORE:drawImageFitInBox(e,worldResources[a].largeIcon,i,r,l,n);break;case TRADE_TYPE_MONEY:drawImageFitInBox(e,moneyicon,i,r,l,n);break;case TRADE_TYPE_BUFF:drawImageFitInBox(e,buffs.staticBuffs[a].image,i,r,l,n);break;case TRADE_TYPE_RELIC:drawImageFitInBox(e,excavationRewards[a].image,i,r,l,n);break;case TRADE_TYPE_BLUEPRINT:drawImageFitInBox(e,getDrillEquipByBlueprintId(a).icon,i,r,l,n);break;case TRADE_TYPE_CHEST:drawImageFitInBox(e,a?goldchesticon:basicchesticon,i,r,l,n);break;default:return null}return{x1:i,y1:r,x2:i+l,y2:r+l,width:l,height:n}}function drawCircle(e,t,a,i,r,l,n){saveCanvasState(e),e.beginPath(),e.arc(t,a,i,0,2*Math.PI,!1),e.fillStyle=r,e.fill(),e.lineWidth=n,e.strokeStyle=l,e.stroke(),restoreCanvasState(e)}function getImageFromMergedImages(e,t,a,i,r,l,n,h=null,o=null,d=null,c=null,m=null,s=null,g=null,w=null,f=null){if(!assetCache.exists(e)){let u=document.createElement("canvas"),I=u.getContext("2d");u.width=Math.max(i.x+i.width,n.x+n.width),u.height=Math.max(i.y+i.height,n.y+n.height),null!=h&&(u.width=Math.max(u.width,d.x+d.width),u.height=Math.max(u.height,d.y+d.height)),null!=c&&(u.width=Math.max(u.width,s.x+s.width),u.height=Math.max(u.height,s.y+s.height)),null!=g&&(u.width=Math.max(u.width,f.x+f.width),u.height=Math.max(u.height,f.y+f.height)),I.drawImage(t,a.x,a.y,a.width,a.height,i.x,i.y,i.width,i.height),I.drawImage(r,l.x,l.y,l.width,l.height,n.x,n.y,n.width,n.height),null!=h&&I.drawImage(h,o.x,o.y,o.width,o.height,d.x,d.y,d.width,d.height),null!=c&&I.drawImage(c,m.x,m.y,m.width,m.height,s.x,s.y,s.width,s.height),null!=g&&I.drawImage(g,w.x,w.y,w.width,w.height,f.x,f.y,f.width,f.height),assetCache.set(e,u)}return assetCache.get(e)}function getSingleColoredPixelImage(e,t=1){var a="singlePixelColor_"+e+t;if(!assetCache.exists(a)){let i=document.createElement("canvas"),r=i.getContext("2d");i.width=1,i.height=1,r.fillStyle=e,r.globalAlpha=t,r.fillRect(0,0,1,1),assetCache.set(a,i)}return assetCache.get(a)}function drawColoredRect(e,t,a,i,r,l,n){e.save(),e.fillStyle=l,e.globalAlpha=n,e.fillRect(t,a,i,r),e.restore()}function drawRgbColoredRect(e,t,a,i,r,l,n,h,o){e.save(),e.fillStyle="rgb("+l+","+n+","+h+")",e.globalAlpha=o,e.fillRect(t,a,i,r),e.restore()}function rgbToHex(e,t,a){return"#"+((1<<24)+(e<<16)+(t<<8)+a).toString(16).slice(1)}function drawTinyProgressBar(e,t,a,i,r,l,n,h,o,d){e.save(),e.strokeStyle=h,e.fillStyle=o,e.lineWidth=l,e.fillRect(t,a,i,r),e.strokeRect(t,a,i,r),e.fillStyle=n;var c=i*d;e.fillRect(t,a,c,r),e.restore()}function renderBuff(e,t,a,i,r,l){if(buffs.numActiveBuffs()>l){var n=buffs.activeBuffs[l],h=n.image,o=buffs.getBuffPercentComplete(l);"Chest"==n.startSource&&drawImageFitInBox(e,smallgoldchesticon,t,Math.floor(a+r/8),Math.round(i/3),Math.round(r/3)),e.drawImage(h,t,a,i,r);var d=e.fillStyle;e.fillStyle="#FFFFFF",e.fillRect(t,a+r-5,i,3),e.fillStyle="#000000",e.fillRect(t+1,a+r-4,(i-2)*o,1),e.fillStyle=d}}function renderRoundedRectangle(e,t,a,i,r,l,n,h,o=1){saveCanvasState(e);var d=t+i,c=a+r;e.beginPath(),e.strokeStyle=n,e.fillStyle=h,e.lineWidth=o,e.moveTo(t+l,a),e.lineTo(d-l,a),e.quadraticCurveTo(d,a,d,a+l),e.lineTo(d,a+r-l),e.quadraticCurveTo(d,c,d-l,c),e.lineTo(t+l,c),e.quadraticCurveTo(t,c,t,c-l),e.lineTo(t,a+l),e.quadraticCurveTo(t,a,t+l,a),e.fill(),e.stroke(),restoreCanvasState(e)}function generateIconWithCooldownOverlay(e,t,a,i){let r=document.createElement("canvas"),l=r.getContext("2d");return r.width=t,r.height=a,l.drawImage(e,0,0,r.width,r.height),l.globalCompositeOperation="source-atop",l.globalAlpha=.6,l.fillStyle="#000000",l.moveTo(r.width/2,r.height/2),l.arc(r.width/2,r.height/2,r.width,3*Math.PI/2,3*Math.PI/2-2*Math.PI*i,!0),l.closePath(),l.fill(),r}function renderCheckmark(e,t,a,i,r){e.save(),e.strokeStyle="#00FF00",e.lineWidth=2,e.beginPath(),e.moveTo(t,a+r/2),e.lineTo(t+i/2,a+r),e.lineTo(t+i,a),e.stroke(),e.restore()}function renderXMark(e,t,a,i,r){e.save(),e.strokeStyle="#FF0000",e.lineWidth=2,e.beginPath(),e.moveTo(t,a),e.lineTo(t+i,a+r),e.moveTo(t+i,a),e.lineTo(t,a+r),e.stroke(),e.restore()}function drawFrame(e,t,a,i,r,l,n,h=24,o=11,d=8){var c=n/h;e.drawImage(t,0,0,h,h,a,i,n,n),e.drawImage(t,h,0,t.width-2*h-d,h,a+n,i,r-2*n,n),e.drawImage(t,t.width-h-d,0,h+d,h,a+r-n,i,n+d*c,n),e.drawImage(t,t.width-h-d,h,h+d,t.height-2*h-o,a+r-n,i+n,n+d*c,l-2*n),e.drawImage(t,t.width-h-d,t.height-h-o,h+d,h+o,a+r-n,i+l-n,n+d*c,n+o*c),e.drawImage(t,h,t.height-h-o,t.width-2*h-d,h+o,a+n,i+l-n,r-2*n,n+o*c),e.drawImage(t,0,t.height-h-o,h,h+o,a,i+l-n,n,n+o*c),e.drawImage(t,0,h,h,t.height-2*h-o,a,i+n,n,l-2*n)}function drawNineSlice(e,t,a,i,r,l,n,h,o=!1){a=Math.ceil(a),i=Math.ceil(i),r=Math.ceil(r),l=Math.ceil(l);var d=r/t.width,c=l/t.height,m=Math.min(d,c,o?Number.MAX_SAFE_INTEGER:1),s=Math.ceil(m*n),g=Math.ceil(m*h);if(s>.5*r||g>.5*l){let e=Math.ceil(Math.min(.5*r,.5*l));s=e,g=e}var w=[n,t.width-2*n,n],f=[h,t.height-2*h,h],u=[s,r-2*s,s],I=[g,l-2*g,g],y=0,v=0,S=0,T=0;for(let r=0;r<3;++r){y=0,S=0;for(let l=0;l<3;++l)e.drawImage(t,y,v,w[l],f[r],S+a,T+i,u[l],I[r]),y+=w[l],S+=u[l];v+=f[r],T+=I[r]}}function getAnimationFrameIndex(e,t=IDLE_FRAMERATE,a=0){return Math.floor((a+numFramesRendered)*(t/IDLE_FRAMERATE))%e}