class OfferManager{isEnabled=!1;currentOffer=null;lastRequestTime=0;lastOfferTime=0;offerHistory=[];storedChests={};hasSeenOffer=!1;logDebugMessages=!0;requireStore=!0;availableRewards={tickets:{image:ticketicon,name:_("Tickets"),onPurchase:function(e){tickets+=e}},basicChest:{image:basicChestIconClosed,name:_("Basic Chest"),onPurchase:function(e){offerManager.storeChests(ChestType.basic,e)}},goldChest:{image:goldChestIconClosed,name:_("Gold Chest"),onPurchase:function(e){offerManager.storeChests(ChestType.gold,e)}},blackChest:{image:blackChestIconClosed,name:_("Black Chest"),onPurchase:function(e){offerManager.storeChests(ChestType.black,e)}}};offerSaveDataMap={id:{index:0},sku:{index:1},name:{index:2},image:{index:3,loadFunction:e=>{var t=new Image;return t.src=e,t},saveFunction:e=>e.src},price:{index:4,loadFunction:parseInt},valueDescription:{index:5},rewards:{index:6,loadFunction:e=>JSON.parse(atob(e)),saveFunction:e=>btoa(JSON.stringify(e))},duration:{index:7,loadFunction:parseInt},startTime:{index:8,loadFunction:parseInt}};offerEndpoint="https://mrmine.com/offers/requestoffer.php";constructor(){this.init()}init(){return!!this.isEnabled&&(this.currentOffer=null,this.lastRequestTime=0,this.lastOfferTime=0,this.offerHistory=[],this.storedChests={[ChestType.basic]:0,[ChestType.gold]:0,[ChestType.black]:0},!0)}update(){return!!this.isEnabled&&(this.isOfferExpired()&&this.clearOffer(),this.isReadyForOffer()&&this.requestOffer(),!0)}requestOffer(){return!(!this.isEnabled||this.requireStore&&!this.isStoreReady())&&(this.lastRequestTime=Math.floor((new Date).getTime()/1e3),this.offer=null,ajax(this.offerEndpoint,{gameId:"mrmine",uid:UID,lastOfferTime:this.lastOfferTime,offerHistory:JSON.stringify(this.offerHistory),platform:platformName(),gameStateInfo:JSON.stringify({depth:depth,money:money.toString()})},"GET",function(e){var t=JSON.parse(e);this.logDebugMessages&&console.log(t),200==t.code&&t.data.offer&&this.updateOffer(t.data.offer)}.bind(this)),!0)}updateOffer(e){return!!this.isEnabled&&(this.currentOffer=e,this.currentOffer.image=new Image,this.currentOffer.image.src=e.imageUrl,this.lastOfferTime=Math.floor((new Date).getTime()/1e3),this.offerHistory.push(e.id),platform.registerSinglePurchasePack(e.sku),store.update(),!0)}purchaseOffer(){return!!this.isEnabled&&(this.requireStore?platform.buyPack(this.currentOffer.sku):this.completePurchase())}grantRewards(){if(!this.isEnabled)return!1;for(var e in this.currentOffer.rewards)this.availableRewards[e].onPurchase(this.currentOffer.rewards[e]);return!0}completePurchase(){return!!this.isEnabled&&(this.grantRewards(),this.currentOffer=null,!0)}clearOffer(){this.currentOffer=null}isReadyForOffer(){return!!this.isEnabled&&!this.currentOffer}isOfferExpired(){return!!this.isEnabled&&(!!this.currentOffer&&this.getTimeRemainingForOffer()<=0)}getOfferPrice(){return this.isEnabled&&this.requireStore&&this.isStoreReady()?platform.getPackPrice(this.currentOffer.sku):this.requireStore?void 0:"$0.00"}getTimeRemainingForOffer(){if(this.isEnabled&&this.currentOffer){var e=Math.floor(Date.now()/1e3);return this.currentOffer.startTime+this.currentOffer.duration-e}return 0}storeChests(e,t){return!(!this.isEnabled||void 0===this.storedChests[e])&&(this.storedChests[e]+=t,!0)}grantStoredChest(e){return!!(this.isEnabled&&this.storedChests[e]&&this.storedChests[e]>0&&chestService.spawnChest(0,Chest.metaldetector,e))&&(chestService.presentChest(0),this.storedChests[e]--,!0)}getStoredChestsOfType(e){return this.isEnabled&&void 0!==this.storedChests[e]?this.storedChests[e]:-1}hasUnclaimedChests(){if(!this.isEnabled)return!1;for(var e in this.storedChests)if(this.storedChests[e]>0)return!0;return!1}getCurrentOffer(){return this.isEnabled&&(!this.requireStore||this.isStoreReady())?this.currentOffer:null}getRewardName(e){return this.availableRewards[e]?this.availableRewards[e].name:(console.error("Attempting to access invalid reward '%s'",e),"ERROR")}getRewardImage(e){return this.availableRewards[e]?this.availableRewards[e].image:(console.error("Attempting to access invalid reward '%s'",e),closei)}getRewardPurchaseFunction(e){return this.availableRewards[e]?this.availableRewards[e].onPurchase:(console.error("Attempting to access invalid reward '%s'",e),function(){})}isStoreReady(){return"undefined"!=typeof store}get saveState(){var e=[];if(this.currentOffer)for(var t in this.offerSaveDataMap)this.offerSaveDataMap[t].saveFunction?e[this.offerSaveDataMap[t].index]=this.offerSaveDataMap[t].saveFunction(this.currentOffer[t]):e[this.offerSaveDataMap[t].index]=this.currentOffer[t];var r=btoa(JSON.stringify(this.storedChests));return[this.lastOfferTime,this.offerHistory.join(".!"),e.join(".!"),r].join(".*.")}set saveState(e){var t=e.split(".*.");this.lastOfferTime=t[0];var r=t[1].split(".!");1==r.length&&""==r[0]?this.offerHistory=[]:this.offerHistory=r;var s=t[2].split(".!");if(1==s.length&&""==s[0])this.offerArray=null;else for(var i in this.currentOffer={},this.offerSaveDataMap)this.currentOffer[i]=s[this.offerSaveDataMap[i].index],this.offerSaveDataMap[i].loadFunction&&(this.currentOffer[i]=this.offerSaveDataMap[i].loadFunction(this.currentOffer[i]));this.storedChests=JSON.parse(atob(t[3]))}}var offerManager=new OfferManager;