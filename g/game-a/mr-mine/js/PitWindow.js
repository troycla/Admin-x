class PitWindow extends TabbedPopupWindow{layerName="pit";domElementId="PITD";context=PIT;paymentPane;paymentPaneDefaultWidth;paymentItemListHitboxes;sacrificePane;isSacrificePaneInitialized=!1;sacrificeType;selectedPaymentIndex;paymentFraction;paymentAmount;constructor(e){super(e),e||this.setBoundingBox(),this.sacrificeType=PitConfig.sacrificeTypes.ore,this.context.imageSmoothingEnabled=!1,this.initializeTabs([_("Ore"),_("Relics"),_("Scientists")]),this.paymentPaneDefaultWidth=.4*this.bodyContainer.boundingBox.width,this.paymentPane=new Scrollbox(this.paymentPaneDefaultWidth-15,this.bodyContainer.boundingBox.height,this.context,this.bodyContainer.boundingBox.x,this.bodyContainer.boundingBox.y,this.paymentPaneDefaultWidth,this.bodyContainer.boundingBox.height,15),this.addHitbox(this.paymentPane),this.sacrificePane=new Hitbox({x:this.paymentPaneDefaultWidth,y:0,width:this.bodyContainer.boundingBox.width-this.paymentPaneDefaultWidth,height:this.bodyContainer.boundingBox.height},{},"","sacrificePane"),this.sacrificePane.render=function(e){var i,t=this.getRootLayer(),n=this.getRelativeCoordinates(0,0,t),s=t.getContext();s.save(),void 0!==t.selectedPaymentIndex&&null!==t.selectedPaymentIndex&&(0==t.currentTabIndex?i=worldResources[t.selectedPaymentIndex+1].name:1==t.currentTabIndex?i=excavationRewards[equippedRelics[t.selectedPaymentIndex]].name:2==t.currentTabIndex&&(aliveScientists()[t.selectedPaymentIndex]?i=scientists[aliveScientists()[t.selectedPaymentIndex][0]].name:t.initializePaymentItemList())),s.fillStyle="#444444",s.fillRect(n.x,n.y,3,this.boundingBox.height),e.selectedPaymentIndex||0===e.selectedPaymentIndex?(s.fillStyle="#FFFFFF",s.textBaseline="top",s.font="24px Verdana",fillTextShrinkToFit(s,_("Sacrifice {0}",i),n.x+15,n.y+15,.9*this.boundingBox.width),0==e.currentTabIndex?(s.font="14px Verdana",fillTextWrap(s,_("How much {0} would you like to sacrifice to The Core?",i),n.x+15,n.y+50,.9*this.boundingBox.width),s.font="18px Verdana",fillTextWrap(s,beautifynum(e.paymentAmount)+" x "+i,n.x+15,n.y+140,.9*this.boundingBox.width)):1!=e.currentTabIndex&&2!=e.currentTabIndex||(s.font="14px Verdana",fillTextWrap(s,_("Would you like to sacrifice {0} to The Core?",i),n.x+15,n.y+50,.9*this.boundingBox.width)),this.renderChildren()):(s.fillStyle="#FFFFFF",s.textBaseline="middle",fillTextWrap(s,_("Click an item on the left to sacrifice it and potentially receive a reward"),n.x+15,n.y+this.boundingBox.height/2-30,this.boundingBox.width-15)),s.restore()}.bind(this.sacrificePane,this),this.sacrificePane.allowBubbling=!0,this.bodyContainer.addHitbox(this.sacrificePane),this.initializePaymentItemList(),this.initializeSacrificePane(),this.slider=this.sacrificePane.addHitbox(new Slider(this.context,.05*this.sacrificePane.boundingBox.width,100,.9*this.sacrificePane.boundingBox.width,25)),this.slider.onchange=function(e){this.paymentFraction=e.value}.bind(this,this.slider),this.slider.setPosition(.5);var i=new Hitbox({x:.05*this.sacrificePane.boundingBox.width,y:.8*this.sacrificePane.boundingBox.height,width:.9*this.sacrificePane.boundingBox.width,height:38},{onmousedown:function(){null!=this.selectedPaymentIndex&&(this.sacrificeType==PitConfig.sacrificeTypes.ore?pit.makeSacrifice(this.sacrificeType,this.selectedPaymentIndex+1,this.paymentAmount):(this.sacrificeType==PitConfig.sacrificeTypes.relic||this.sacrificeType==PitConfig.sacrificeTypes.scientist)&&(pit.makeSacrifice(this.sacrificeType,this.selectedPaymentIndex,this.paymentAmount),this.selectedPaymentIndex=null),mutebuttons||clickAudio[rand(0,clickAudio.length-1)].play(),this.initializePaymentItemList())}.bind(this)},"pointer","sacrificeButton");i.render=function(e){var i=e.context;i.save();var t,n=this.getRelativeCoordinates(0,0,e);if(isCoreBlessed)drawBlessedEffect(i,upgradeb,n.x,n.y,this.boundingBox.width,this.boundingBox.height),i.fillStyle="#000000",i.globalAlpha=.45;else if(isCoreWarped){drawChromaShift(i,"sacrifice_button",upgradeb,n.x,n.y,this.boundingBox.width,this.boundingBox.height),i.fillStyle="#CCCCCC";var s=.6+(.4+oscillate(currentTime(),79));i.shadowColor="rgba(150, 60, 100, "+s+")",i.shadowOffsetX=4*oscillate(currentTime(),499)-2,i.shadowOffsetY=2*oscillate(currentTime(),331)-1,i.shadowBlur=1.5+1.5*oscillate(currentTime(),oscillate(currentTime(),211))}else i.drawImage(upgradeb,n.x,n.y,this.boundingBox.width,this.boundingBox.height),i.fillStyle="#000000";i.textBaseline="middle",t=_("Sacrifice"),i.font="32px KanitB",fillTextShrinkToFit(i,t,n.x+10,n.y+this.boundingBox.height/2+2,this.boundingBox.width-20,"center"),i.restore()}.bind(i,this),this.sacrificePane.addHitbox(i),this.sacrificePane.setEnabled(!1)}onTabChange(){switch(this.selectedPaymentIndex=null,this.currentTabIndex){case 0:this.sacrificeType=PitConfig.sacrificeTypes.ore,this.slider.setVisible(!0),this.slider.setEnabled(!0);break;case 1:this.sacrificeType=PitConfig.sacrificeTypes.relic,this.slider.setVisible(!1),this.slider.setEnabled(!1),this.paymentAmount=1n;break;case 2:this.sacrificeType=PitConfig.sacrificeTypes.scientist,this.slider.setVisible(!1),this.slider.setEnabled(!1),this.paymentAmount=1n}this.initializePaymentItemList()}render(){this.context.clearRect(0,0,this.boundingBox.width,this.boundingBox.height),(this.selectedPaymentIndex||0===this.selectedPaymentIndex)&&(this.paymentAmount=parseInt(worldResources[this.selectedPaymentIndex+1].numOwned*this.slider.value)),super.render()}initializePaymentItemList(){var e=this.paymentPane;e.clearHitboxes(),this.paymentItemListHitboxes=[],this.generateMenuContents(this.currentTabIndex,this.paymentPane),e.isDirty=!0}generateMenuContents(e,i){var t;if(t=2==e?Math.min(100,i.contentWidth/2):Math.min(60,i.contentWidth/2),i.context.save(),i.context.imageSmoothingEnabled=!1,i.context.clearRect(0,0,i.canvas.width,i.canvas.height),e>=0){var n;0==this.currentTabIndex?n=12:1==this.currentTabIndex?n=numRelicsEquipped():2==this.currentTabIndex&&(n=aliveScientists().length);var s,a=Math.floor((i.boundingBox.width-6-15)/t),o=Math.ceil(n/a);s=a>1?(i.boundingBox.width-6-15-t*a)/(a-1):0,i.contentHeight=o*(t+s)+6,i.initializeScrollbar(),i.currentScrollY=0;for(var r=0;r<n;++r){var d,c,h,l=3+r%a*(t+s),x=3+Math.floor(r/a)*(t+s);if(i.context.fillStyle="#000000",i.context.globalAlpha=.5,i.context.fillRect(l,x,t,t),i.context.globalAlpha=1,0==this.currentTabIndex)d=worldResources[r+1].name,c="",h=worldResources[r+1].largeIcon,drawImageFitInBox(i.context,h,l,x,t,t);else if(1==this.currentTabIndex){d=excavationRewards[equippedRelics[r]].name,c=getRewardDescription(equippedRelics[r]),h=excavationRewards[equippedRelics[r]].image,(0,excavationRewards[equippedRelics[r]].renderFunction)(i.context,equippedRelics[r],l,x,t,t)}else 2==this.currentTabIndex&&(d=scientists[aliveScientists()[r][0]].name,c="",h=scientists[aliveScientists()[r][0]].image,drawImageFitInBox(i.context,h,l,x,t,t));drawFrame(i.context,itemFrame,l,x,t,t,4,4,0,0),this.selectedPaymentIndex==r&&(i.context.strokeStyle="#76E374",i.context.lineWidth=3,i.context.beginPath(),i.context.strokeRect(l+i.context.lineWidth,x+i.context.lineWidth,t-2*i.context.lineWidth,t-2*i.context.lineWidth),i.context.stroke());var u=new Hitbox({x:l,y:x,width:t,height:t},{onmousedown:function(e){this.selectedPaymentIndex=e,this.initializeSacrificePane(),this.sacrificePane.setEnabled(!0),this.sacrificePane.setVisible(!0),this.generateMenuContents(this.currentTabIndex,this.paymentPane)}.bind(this,r),onmouseenter:function(e,i,t,n){var s=this.getGlobalCoordinates(t,n);showTooltip(e,i,s.x*uiScaleX,s.y*uiScaleY)}.bind(i,d,c,l,x+t),onmouseexit:function(){hideTooltip()}},"pointer");i.addHitbox(u,!0)}}i.context.restore()}initializeSacrificePane(){}initializeEquipList(){for(var e=55,i=new Hitbox({x:30,y:this.bodyContainer.boundingBox.height/2-27.5,width:this.bodyContainer.boundingBox.width,height:e},{},"","equipList"),t=0;t<4;++t){var n=new Hitbox({x:65*t,y:0,width:e,height:e},{onmouseenter:function(e,i,t){var n=new DrillCraftingItem(drillState.equippedDrillEquips[e]),s=this.getGlobalCoordinates(i,t);showTooltip(_(n.getName()),_(n.getDescription()),s.x*uiScaleX,s.y*uiScaleY)}.bind(i,t,65*t,e),onmouseexit:function(){hideTooltip()}},"pointer");n.render=function(e,i){var t=new DrillCraftingItem(drillState.equippedDrillEquips[i]),n=this.getRelativeCoordinates(0,0,e);e.context.drawImage(t.getIcon(),n.x,n.y,this.boundingBox.width,this.boundingBox.height)}.bind(n,this,t),i.addHitbox(n)}this.equipList=i,this.addHitbox(i),2!=this.currentTabIndex&&(this.equipList.setEnabled(!1),this.equipList.setVisible(!1))}tutorialFlicker(){return 0==getBlueprintCount()?(this.flickerTab(0,500),!0):!(hasCraftedABlueprint||!canCraftAnyBlueprint())&&(this.flickerTab(1,500),!0)}}