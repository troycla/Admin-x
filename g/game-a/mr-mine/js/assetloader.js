class AssetLoader{endpoint="";maxSpriteSheetWidth=4096;maxSpriteSheetHeight=4096;totalAssets=0;assetsLoaded=0;assetQueue=[];allAssetsQueued=!1;loadStartTime;verboseLogging=!1;export="";constructor(){}setEndpoint(e){this.endpoint=e}async loadAsset(e,t,s=1,a=1,o=!1){"object"==typeof e&&(e="undefined"!=typeof isMobile&&e.mobile?e.mobile:e.desktop),0==this.totalAssets&&(this.loadStartTime=Date.now()),localStorage.debug_loadTinyAssets,++this.totalAssets,this.assetQueue.push([e,t]);var i=e.split(".")[e.split(".").length-1].toLowerCase();switch(i){case"png":case"jpg":case"webp":case"gif":var r=new Image;r.crossOrigin="Anonymous",r.id=t,r.onload=function(){assetLoader.verboseLogging&&console.log("[ASSETLOADER] LOADED "+e),assetLoader.assetsLoaded++,assetLoader.allAssetsQueued&&(assetLoader.verboseLogging&&console.log("[ASSETLOADER] LOADING: "+assetLoader.assetsLoaded+"/"+assetLoader.totalAssets+"("+Math.floor(100*assetLoader.assetsLoaded/assetLoader.totalAssets)+"%)"),assetLoader.assetQueue.length<10&&assetLoader.assetQueue.length>0||0==assetLoader.assetQueue.length&&assetLoader.verboseLogging&&console.log("[ASSETLOADER] FINISHED LOADING ASSETS ("+Math.round((Date.now()-assetLoader.loadStartTime)/1e3)+" seconds)"))},r.onerror=function(){console.error("Failed to load image '"+r.src+"'"),r.src.includes("darkdot")||assetLoader.loadAsset("Shared/Assets/darkdot.webp",t)},window[t]=r,this.verboseLogging&&console.log("[ASSETLOADER] LOADING "+e+" (."+i+")"),e+="?v=143B",r.src=this.endpoint+e,this.export+="<img id='"+t+"' src='"+this.endpoint+e+"' style='display:none;'>",assetLoader.assetQueue.splice(0,1)}}async loadWebm(e,t,s,a=1){let o;window[t]=new Image;let i=await fetch(e).then((e=>e.blob())),r=URL.createObjectURL(i),d=document.createElement("video");for(d.src=r,d.crossOrigin="anonymous",await d.play(),d.addEventListener("seeked",(async()=>{o&&o()}));(d.duration===1/0||isNaN(d.duration))&&d.readyState<2;)await new Promise((e=>setTimeout(e,1e3)));var n=document.createElement("canvas"),l=this.getPackDetails(s,d.videoWidth,d.videoHeight);if(l.success){n.width=l.data.totalWidth,n.height=l.data.totalHeight;for(var h=n.getContext("2d"),c=s/d.duration,g=0;g<s;g++){d.currentTime=(g+.5)*c,d.play(),await new Promise((e=>o=e));var u=Math.floor(g/l.data.numColumns),m=Math.floor(g%l.data.numColumns)*d.videoWidth,L=u*d.videoHeight;h.drawImage(d,m,L)}window[t].src=n.toDataURL("image/webp",a),n=null,h=null,d=null,i=null}else console.error("ERROR WHEN PACKING "+t)}generateWebmFromAsset(e,t){var s=document.createElement("canvas");s.width=e.width/t,s.height=e.height;for(var a=s.getContext("2d"),o=[],i=0;i<t;i++){a.clearRect(0,0,s.width,s.height),a.drawImage(e,i*e.width/t,0,e.width/t,e.height,0,0,s.width,s.height);var r=s.toDataURL("image/webp",1);o.push(r),console.log(r)}}getPackDetails(e,t,s){var a=Math.floor(this.maxSpriteSheetWidth/t),o=Math.floor(this.maxSpriteSheetHeight/s);if(o>0&&a>0){for(var i=Number.MAX_SAFE_INTEGER,r=-1,d=-1,n=1;n<=o;n++){var l=Math.ceil(e/n);if(l<=a){var h=l*t*(n*t);h<i&&(i=h,r=l,d=n)}}return-1==r||-1==d?{success:!1,data:null}:{success:!0,data:{numColumns:r,numRows:d,totalWidth:r*t,totalHeight:d*s}}}return{success:!1,data:null}}}