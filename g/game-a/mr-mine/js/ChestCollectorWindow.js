class ChestCollectorWindow extends TabbedPopupWindow{layerName="ChestCollector";domElementId="HIRED";context=HR;constructor(e){super(e),e||this.setBoundingBox(),this.setFrameImagesByWorldIndex(0);let t=chestCompressorStructure.level>0?[_("Compress"),_("Queue")]:[];this.initializeTabs(t),this.compressorPane=new Hitbox({x:this.bodyContainer.boundingBox.x,y:this.bodyContainer.boundingBox.y,width:this.bodyContainer.boundingBox.width,height:this.bodyContainer.boundingBox.height},{},"","compressorPane"),this.compressorPane.allowBubbling=!0,this.addHitbox(this.compressorPane),this.queuePane=new Scrollbox(this.bodyContainer.boundingBox.width-15,.9*this.bodyContainer.boundingBox.height+.16*this.bodyContainer.boundingBox.height*Math.max(0,chestCompressor.queuedChests.length-3),this.context,this.bodyContainer.boundingBox.x,this.bodyContainer.boundingBox.y+.1*this.bodyContainer.boundingBox.height,this.bodyContainer.boundingBox.width,.9*this.bodyContainer.boundingBox.height,15),this.addHitbox(this.queuePane),this.queuePane.setVisible(!0),this.queuePane.setEnabled(!0),this.onTabChange()}onTabChange(){0==this.currentTabIndex?(this.compressorPane.setVisible(!0),this.compressorPane.setEnabled(!0),this.queuePane.setVisible(!1),this.queuePane.setEnabled(!1),this.initializeBaseTab()):(this.compressorPane.setVisible(!1),this.compressorPane.setEnabled(!1),this.queuePane.setVisible(!0),this.queuePane.setEnabled(!0),this.initializeQueue())}initializeBaseTab(){this.compressorPane.clearHitboxes(),this.compressorPane.basicChestDisplay=new Hitbox({x:0,y:-.05*this.bodyContainer.boundingBox.height,width:.3*this.bodyContainer.boundingBox.width,height:.7*this.bodyContainer.boundingBox.height},{},""),this.compressorPane.basicChestDisplay.render=function(e){var t=this.getRelativeCoordinates(0,0,e),o=drawImageFitInBox(e.context,basicChestIconClosed,t.x,t.y,this.boundingBox.width,this.boundingBox.width);e.context.save(),e.context.font="24px Verdana",e.context.fillStyle="#FFFFFF",e.context.textBaseline="top",fillTextWrap(e.context,"x "+chestService.getStoredChestsOfType(ChestType.basic),t.x,o.y+o.height,this.boundingBox.width,"center"),e.context.restore(),this.renderChildren()}.bind(this.compressorPane.basicChestDisplay,this),this.compressorPane.addHitbox(this.compressorPane.basicChestDisplay),this.compressorPane.basicChestButton=this.compressorPane.addHitbox(new Button(upgradebg_blank,_("Open Basic Chest"),"18px KanitM","#000000",{x:this.compressorPane.basicChestDisplay.boundingBox.x,y:.7*this.compressorPane.basicChestDisplay.boundingBox.height,width:this.compressorPane.basicChestDisplay.boundingBox.width,height:.15*this.compressorPane.basicChestDisplay.boundingBox.height},{onmousedown:function(){chestService.grantStoredChest(ChestType.basic)}})),this.compressorPane.basicChestButton.isEnabled=()=>chestService.getStoredChestsOfType(ChestType.basic)>0,chestCompressorStructure.level>0&&(this.compressorPane.basicChestCompressButton=this.compressorPane.addHitbox(new Button(upgradebg_blank,_("Compress {0} to 1 Gold",chestCompressorStructure.statValueForCurrentLevel(0)),"18px KanitM","#000000",{x:this.compressorPane.basicChestDisplay.boundingBox.x,y:.88*this.compressorPane.basicChestDisplay.boundingBox.height,width:this.compressorPane.basicChestDisplay.boundingBox.width,height:.15*this.compressorPane.basicChestDisplay.boundingBox.height},{onmousedown:function(){chestCompressor.canQueueChest(ChestType.gold)&&(chestCompressor.addChestToQueue(ChestType.gold),this.parent.parent.flickerTab(1,500,3))},onmouseenter:function(){chestCompressor.canQueueChest(ChestType.gold)||showTooltip(_("Unable to compress chests"),_("Compressor slots are full or you don't have enough chests"),mouseX-90,mouseY+20,180)},onmouseexit:()=>hideTooltip()}))),this.compressorPane.goldChestDisplay=new Hitbox({x:.35*this.bodyContainer.boundingBox.width,y:-.05*this.bodyContainer.boundingBox.height,width:.3*this.bodyContainer.boundingBox.width,height:.7*this.bodyContainer.boundingBox.height},{},""),this.compressorPane.goldChestDisplay.render=function(e){var t=this.getRelativeCoordinates(0,0,e),o=drawImageFitInBox(e.context,goldChestIconClosed,t.x,t.y,this.boundingBox.width,this.boundingBox.width);e.context.save(),e.context.font="24px Verdana",e.context.fillStyle="#FFFFFF",e.context.textBaseline="top",fillTextWrap(e.context,"x "+chestService.getStoredChestsOfType(ChestType.gold),t.x,o.y+o.height,this.boundingBox.width,"center"),e.context.restore(),this.renderChildren()}.bind(this.compressorPane.goldChestDisplay,this),this.compressorPane.addHitbox(this.compressorPane.goldChestDisplay),this.compressorPane.goldChestButton=this.compressorPane.addHitbox(new Button(upgradebg_blank,_("Open Gold Chest"),"18px KanitM","#000000",{x:this.compressorPane.goldChestDisplay.boundingBox.x,y:.7*this.compressorPane.goldChestDisplay.boundingBox.height,width:this.compressorPane.goldChestDisplay.boundingBox.width,height:.15*this.compressorPane.goldChestDisplay.boundingBox.height},{onmousedown:function(){chestService.grantStoredChest(ChestType.gold)}})),this.compressorPane.goldChestButton.isEnabled=()=>chestService.getStoredChestsOfType(ChestType.gold)>0,chestCompressorStructure.level>0&&(this.compressorPane.goldChestCompressButton=this.compressorPane.addHitbox(new Button(upgradebg_blank,_("Compress {0} to 1 Ethereal",chestCompressorStructure.statValueForCurrentLevel(1)),"18px KanitM","#000000",{x:this.compressorPane.goldChestDisplay.boundingBox.x,y:.88*this.compressorPane.goldChestDisplay.boundingBox.height,width:this.compressorPane.goldChestDisplay.boundingBox.width,height:.15*this.compressorPane.goldChestDisplay.boundingBox.height},{onmousedown:function(){chestCompressor.canQueueChest(ChestType.black)&&(chestCompressor.addChestToQueue(ChestType.black),this.parent.parent.flickerTab(1,500,3))},onmouseenter:function(){chestCompressor.canQueueChest(ChestType.black)||showTooltip("Unable to compress chests","Compressor slots are full or you don't have enough chests",mouseX-90,mouseY+20,180)},onmouseexit:()=>hideTooltip()}))),this.compressorPane.blackChestDisplay=new Hitbox({x:.7*this.bodyContainer.boundingBox.width,y:-.05*this.bodyContainer.boundingBox.height,width:.3*this.bodyContainer.boundingBox.width,height:.7*this.bodyContainer.boundingBox.height},{},""),this.compressorPane.blackChestDisplay.render=function(e){var t=this.getRelativeCoordinates(0,0,e),o=drawImageFitInBox(e.context,blackChestIconClosed,t.x,t.y,this.boundingBox.width,this.boundingBox.width);e.context.save(),e.context.font="24px Verdana",e.context.fillStyle="#FFFFFF",e.context.textBaseline="top",fillTextWrap(e.context,"x "+chestService.getStoredChestsOfType(ChestType.black),t.x,o.y+o.height,this.boundingBox.width,"center"),e.context.restore(),this.renderChildren()}.bind(this.compressorPane.blackChestDisplay,this),this.compressorPane.addHitbox(this.compressorPane.blackChestDisplay),this.compressorPane.blackChestButton=this.compressorPane.addHitbox(new Button(upgradebg_blank,_("Open Ethereal Chest"),"18px KanitM","#000000",{x:this.compressorPane.blackChestDisplay.boundingBox.x,y:.7*this.compressorPane.blackChestDisplay.boundingBox.height,width:this.compressorPane.blackChestDisplay.boundingBox.width,height:.15*this.compressorPane.blackChestDisplay.boundingBox.height},{onmousedown:function(){chestService.grantStoredChest(ChestType.black)}})),this.compressorPane.collectButton=new Button(upgradebg_blank,_("Collect from worlds"),"16px KanitM","#000000",{x:this.bodyContainer.boundingBox.width/2-.33*this.bodyContainer.boundingBox.width/2,y:.675*this.boundingBox.height,width:.33*this.compressorPane.boundingBox.width,height:.1*this.boundingBox.height},{onmousedown:function(){chestService.forEachChest((e=>{chestService.isChestCollectorFull()||"natural"!=e.source&&"superminer"!=e.source||(chestService.storeChest(e.type),chestService.removeChest(e.depth,e.worker))}))}}),this.compressorPane.collectButton.isVisible=()=>metalDetectorStructure.level>=6,this.compressorPane.collectButton.isEnabled=()=>metalDetectorStructure.level>=6&&chestService.chests.length>0&&!chestService.isChestCollectorFull(),this.compressorPane.addHitbox(this.compressorPane.collectButton)}initializeQueue(){this.compressorPane.clearHitboxes(),this.queuePane.clearHitboxes();for(var e=0;e<chestCompressor.queuedChests.length;e++)this.queuePane.addHitbox(new Hitbox({x:.05*this.boundingBox.width,y:this.boundingBox.height*(.02+.16*e),width:.825*this.boundingBox.width,height:.15*this.boundingBox.height},{},"cursor","chestSlot"+e)),this.queuePane.addHitbox(new Hitbox({x:.71*this.boundingBox.width,y:this.boundingBox.height*(.04+.16*e),width:.13*this.boundingBox.width,height:.15*this.boundingBox.height*.75},{onmousedown:function(e){tickets>=chestCompressor.ticketCost(e)&&showConfirmationPrompt(_("Pay {0} tickets to skip the remaining time and immediately send the chest to storage",chestCompressor.ticketCost(e)),_("Yes"),(()=>{tickets>=chestCompressor.ticketCost(e)&&(tickets-=chestCompressor.ticketCost(e),chestCompressor.grantChestAndRemoveFromQueue(e),this.flickerTab(0,500,3),this.initializeQueue())}),_("Cancel"))}.bind(this,e)},"pointer","chestButton"+e))}render(){if(this.context.clearRect(0,0,this.boundingBox.width,this.boundingBox.height),super.render(),0==this.currentTabIndex)this.compressorPane.basicChestButton.image=chestService.getStoredChestsOfType(ChestType.basic)>0?upgradeb:upgradebg_blank,this.compressorPane.goldChestButton.image=chestService.getStoredChestsOfType(ChestType.gold)>0?upgradeb:upgradebg_blank,this.compressorPane.blackChestButton.image=chestService.getStoredChestsOfType(ChestType.black)>0?upgradeb:upgradebg_blank,chestCompressorStructure.level>0&&(this.compressorPane.basicChestCompressButton.image=chestCompressor.canQueueChest(ChestType.gold)?upgradeb:upgradebg_blank,this.compressorPane.goldChestCompressButton.image=chestCompressor.canQueueChest(ChestType.black)?upgradeb:upgradebg_blank),this.compressorPane.collectButton.image=chestService.chests.length>0&&!chestService.isChestCollectorFull()?upgradeb:upgradebg_blank;else if(1==this.currentTabIndex){this.queuePane.context.clearRect(0,0,this.queuePane.contentWidth,this.queuePane.contentHeight),this.context.font=.05*this.boundingBox.height+"px KanitM",this.context.fillStyle="#FFFFFF",fillTextShrinkToFit(this.context,_("Used Slots {0}/{1}",chestCompressor.queuedChests.length,chestCompressor.getSlotCount()),this.queuePane.boundingBox.x,this.queuePane.boundingBox.y-.025*this.queuePane.boundingBox.height,this.queuePane.boundingBox.width,"center");for(var e=0;e<chestCompressor.queuedChests.length;e++){let t=this.queuePane.getHitboxById("chestSlot"+e),o=this.queuePane.getHitboxById("chestButton"+e),s=chestCompressor.queuedChests[e],i=chestCompressor.chestStats[s[0]].time(),n=(i-s[1])/i;if(t){renderRoundedRectangle(this.queuePane.context,t.boundingBox.x,t.boundingBox.y,t.boundingBox.width,t.boundingBox.height,10,"hsla(0, 0%, 100%, 0.5)","hsla(0, 100%, 0%, 0.6)",1);let i=1==chestCompressor.queuedChests[e][0]?goldChestIconClosed:blackChestIconClosed;this.queuePane.context.drawImage(i,0,0,i.width,i.height,t.boundingBox.x,t.boundingBox.y+.05*t.boundingBox.height,.33*relativeWidth(i),.33*relativeHeight(i)),this.queuePane.context.font=.25*t.boundingBox.height+"px KanitM",renderFancyProgressBar(this.queuePane.context,_("Time Remaining: {0}",formattedCountDown(s[1])),n,.25*t.boundingBox.width,t.boundingBox.y+.2*t.boundingBox.height,.6*t.boundingBox.width,.6*t.boundingBox.height,"#5EB65D","#000000","#FFFFFF",timerFrame),this.queuePane.context.drawImage(bigb_blank,0,0,bigb_blank.width,bigb_blank.height,o.boundingBox.x,o.boundingBox.y,o.boundingBox.width,o.boundingBox.height),fillTextShrinkToFit(this.queuePane.context,_("Skip Time"),o.boundingBox.x,o.boundingBox.y+.6*o.boundingBox.height,o.boundingBox.width,"center")}}}}}