class BattleWindow extends PopupWindow{layerName="Battle";domElementId="BATTLED";context=BA;constructor(t,i){super(t),t||this.setBoundingBox(),this.monster=i,battleActive=!0;for(var e=0;e<16;e++){var n=Math.floor(e/4),o=e%4;this.addHitbox(new Hitbox({x:this.boundingBox.width*(.04+.227*n),y:this.boundingBox.height*(.626+.063*o),width:.219*this.boundingBox.width,height:.05*this.boundingBox.height},{onmousedown:function(){var t=parseInt(this.id.split("_")[1]);battleInventory[t].length>0&&atk(t)}},"pointer","weaponButton_"+e))}this.closeButton=this.addHitbox(new Button(closei,"","","",{x:.93*this.boundingBox.width,y:0,width:.06*this.boundingBox.width,height:.06*this.boundingBox.width},{onmousedown:function(){lostBattle(),mutebuttons||closeAudio[rand(0,closeAudio.length-1)].play()}},"pointer","closeButton"))}close(){return battleActive&&lostBattle(),super.close()}render(){this.context.save(),this.context.clearRect(0,0,this.boundingBox.width,this.boundingBox.height),this.context.drawImage(battleBackground,0,0,595,520,0,.02*this.boundingBox.height,this.boundingBox.width,.98*this.boundingBox.height),this.context.fillStyle="#FFFFFF";for(var t=0;t<16;t++){var i=Math.ceil((t+1)/4),e=t%4;if(battleInventory[t]&&battleInventory[t][0]>-1){var n=!1,o=0,h=this.boundingBox.width*(.087+.228*(i-1)),s=this.boundingBox.height*(.693+.0623*(e-1)),d=.173*this.boundingBox.width,l=.05*this.boundingBox.height;currentTime()-atkWeps[t]>=getInventoryWeaponSpeed(t)?(n=!0,o=1):o=(currentTime()-atkWeps[t])/getInventoryWeaponSpeed(t),this.context.fillStyle="#dddddd",this.context.globalAlpha=.8,this.context.fillRect(h,s,d*o,.05*this.boundingBox.height),this.context.globalAlpha=1,this.context.drawImage(getInventoryWeaponIcon(t),0,0,50,50,this.boundingBox.width*(.04+.227*(i-1)),s,.044*this.boundingBox.width,.05*this.boundingBox.height),n&&(this.context.drawImage(titlelight,2,Math.abs(7-(Math.floor(currentTime()/50)+t)%15),1,1,h,s,d,l),this.context.fillStyle="#77cc77",this.context.globalAlpha=.5,this.context.fillRect(h,s,d,l),this.context.globalAlpha=1)}}monsterHP>.07*monsterMaxHP?this.monster.animation.loopFrames(this.context,.4*this.boundingBox.width,.15*this.boundingBox.height,.25*this.boundingBox.width,.45*this.boundingBox.height,!0,0,this.monster.animation.frameCount-1):this.monster.animation.drawFrame(this.context,.4*this.boundingBox.width,.15*this.boundingBox.height,.25*this.boundingBox.width,.45*this.boundingBox.height,3),this.context.fillStyle="#991111",this.context.fillRect(.04*this.boundingBox.width,.065*this.boundingBox.height,.905*this.boundingBox.width*(monsterHP/monsterMaxHP),.051*this.boundingBox.height),this.context.fillStyle="#ffffff",this.context.fillText(beautifynum(monsterHP)+"/"+beautifynum(monsterMaxHP),.45*this.boundingBox.width,.1*this.boundingBox.height),isBossBattleActive?this.context.fillText(this.monster.name,.055*this.boundingBox.width,.1*this.boundingBox.height):this.context.fillText("Wild "+this.monster.name,.055*this.boundingBox.width,.1*this.boundingBox.height),this.context.fillStyle="#991111",this.context.fillRect(.04*this.boundingBox.width,.879*this.boundingBox.height,.905*this.boundingBox.width*(userHP/userMaxHP),.051*this.boundingBox.height),this.context.fillStyle="#ffffff",this.context.fillText(beautifynum(userHP)+"/"+beautifynum(userMaxHP),.45*this.boundingBox.width,.915*this.boundingBox.height);for(var g=0;g<dealtDmg.length;g++)if(currentTime()-dealtDmg[g][1]<1e3){var x=1-(currentTime()-dealtDmg[g][1])/1e3;this.context.globalAlpha=x,dealtDmg[g][2]?this.context.font="bold 18px Verdana":this.context.font="16px Verdana",this.context.fillText("-"+dealtDmg[g][0],.5*this.boundingBox.width+3*g,.35*this.boundingBox.height-.3*this.boundingBox.height*((currentTime()-dealtDmg[g][1])/1e3))}else dealtDmg.splice(g,1),g--;for(var a=0;a<takenDmg.length;a++)if(currentTime()-takenDmg[a][1]<1e3){x=1-(currentTime()-takenDmg[a][1])/1e3;this.context.globalAlpha=x,this.context.fillStyle="#FF2222",this.context.fillText("-"+takenDmg[a][0],.65*this.boundingBox.width+25*a,.915*this.boundingBox.height)}else takenDmg.splice(a,1),a--;this.context.globalAlpha=1,currentTime()-monsterAtkTime>this.monster.attackSpeed&&(monsterAtkTime=currentTime()-(currentTime()-monsterAtkTime-this.monster.attackSpeed),monsterAttacked()),this.context.fillStyle="#000000",super.render(),this.context.restore()}}