var headerFont="CFont";class MainUILayer extends UiLayer{layerName="MainUILayer";zIndex=3;isRendered=!0;isPopup=!1;allowBubbling=!0;context=MAIN;isOnScroller=!1;isHoveringOverScroller=!1;activeDialogue={dialogueText:"",dialogueImage:null,dialoguePartyName:"",popupId:"",x:0,y:0,isActive:!1};buffContainer;currentlyViewedWorld=EARTH_INDEX;constructor(t){super(t),this.context&&(this.context.canvas.style.x=t.x,this.context.canvas.style.y=t.y,this.context.canvas.style.width=t.width,this.context.canvas.style.height=t.height),this.setBoundingBox()}setBoundingBox(){this.boundingBox=this.context.canvas.getBoundingClientRect(),this.boundingBox.x/=uiScaleX,this.boundingBox.y/=uiScaleY,this.boundingBox.width/=uiScaleX,this.boundingBox.height/=uiScaleY,this.setupHeader()}setupHeader(){this.clearHitboxes(),this.addHitbox(new Hitbox({x:.803*this.boundingBox.width,y:.068*this.boundingBox.height,width:.13*this.boundingBox.width,height:.02*this.boundingBox.height},{onmousedown:function(){openUi(SellWindow,null,EARTH_INDEX)},onmouseenter:function(){showUpdatingTooltip((function(){if(maxHoldingCapacity()>=capacity){var t=formattedCountDown(timeUntilCapacityIsFullSeconds());return{header:_("Estimated Time Until Full"),body:"<center>"+t+"</center>"}}return{header:_("Capacity Full"),body:_("Sell your minerals to continue mining")}}),"80.5%","9.5%","120px"),document.body.style.cursor="pointer"},onmouseexit:function(){hideTooltip(),document.body.style.cursor=""}},"","capacityTooltip")),this.addHitbox(new Hitbox({x:.803*this.boundingBox.width,y:.039*this.boundingBox.height,width:.13*this.boundingBox.width,height:.02*this.boundingBox.height},{onmouseenter:function(){showUpdatingTooltip((function(){var t=estimatedTimeUntilNextDepth(),e=formattedCountDown(parseInt(t)+1);return{header:_("Time Until {0}km Depth",depth+1),body:"<center>"+e+"</center>"}}),"80.5%","9.5%","120px")},onmouseexit:function(){hideTooltip()},onmousedown:function(){openUi(SettingsWindow,"",3)}},"pointer","depthTooltip")),this.addHitbox(new Hitbox({x:.803*this.boundingBox.width,y:.009*this.boundingBox.height,width:.13*this.boundingBox.width,height:.02*this.boundingBox.height},{onmouseenter:function(){var t=10*money.toString(10).split("").length;t=Math.max(t,120),showUpdatingTooltip((function(){for(var t=money.toString(),e="",i=t.length-1,o=t.length;o>=0;o--)i-o>2&&(e+=",",i=o),e+=t.charAt(o);var n="$";for(o=e.length;o>=0;o--)n+=e.charAt(o);return{header:_("Total Money"),body:"<center>"+n+"</center>"}}),"80.5%","9.5%",t)},onmouseexit:function(){hideTooltip()}},"pointer","currencyTooltip")),this.addHitbox(new Hitbox({x:.045*this.boundingBox.width,y:0,width:.06*this.boundingBox.width,height:.03*this.boundingBox.height},{onmousedown:function(){currentlyViewedDepth=0,MAIN.clearRect(0,.11*this.boundingBox.height,this.boundingBox.width,.89*this.boundingBox.height),animate(),hasAnimatedThisFrame=1,movedivs()},onmouseenter:function(){document.body.style.cursor="pointer"},onmouseexit:function(){document.body.style.cursor=""}},"","EarthSelect")),this.addHitbox(new Hitbox({x:.045*this.boundingBox.width,y:.038*this.boundingBox.height,width:.06*this.boundingBox.width,height:.03*this.boundingBox.height},{onmousedown:function(){getMoon().hasReached()&&(currentlyViewedDepth=getMoon().startDepth,MAIN.clearRect(0,.11*this.boundingBox.height,this.boundingBox.width,.89*this.boundingBox.height),animate(),hasAnimatedThisFrame=1,movedivs())},onmouseenter:function(){getMoon().hasReached()&&(document.body.style.cursor="pointer")},onmouseexit:function(){document.body.style.cursor=""}},"","MoonSelect")),this.addHitbox(new Hitbox({x:.045*this.boundingBox.width,y:.076*this.boundingBox.height,width:.06*this.boundingBox.width,height:.03*this.boundingBox.height},{onmousedown:function(){getTitan().hasReached()&&(currentlyViewedDepth=getTitan().startDepth,MAIN.clearRect(0,.11*this.boundingBox.height,this.boundingBox.width,.89*this.boundingBox.height),animate(),hasAnimatedThisFrame=1,movedivs())},onmouseenter:function(){getTitan().hasReached()&&(document.body.style.cursor="pointer")},onmouseexit:function(){document.body.style.cursor=""}},"","TitanSelect")),this.addHitbox(new Hitbox({x:.037*this.boundingBox.width,y:.128*this.boundingBox.height,width:.039*this.boundingBox.width,height:.074*this.boundingBox.height},{onmousedown:function(){changeViewedDepth(-1,!0)},onmouseenter:function(){document.body.style.cursor="pointer"},onmouseexit:function(){document.body.style.cursor=""}},"","upAllButton")),this.addHitbox(new Hitbox({x:.037*this.boundingBox.width,y:.203*this.boundingBox.height,width:.039*this.boundingBox.width,height:.074*this.boundingBox.height},{onmousedown:function(){changeViewedDepth(-1)},onmouseenter:function(){document.body.style.cursor="pointer"},onmouseexit:function(){document.body.style.cursor=""}},"","upOneButton")),this.addHitbox(new Hitbox({x:.037*this.boundingBox.width,y:.907*this.boundingBox.height,width:.039*this.boundingBox.width,height:.074*this.boundingBox.height},{onmousedown:function(){changeViewedDepth(1,!0)},onmouseenter:function(){document.body.style.cursor="pointer"},onmouseexit:function(){document.body.style.cursor=""}},"","downAllButton")),this.addHitbox(new Hitbox({x:.037*this.boundingBox.width,y:.832*this.boundingBox.height,width:.039*this.boundingBox.width,height:.074*this.boundingBox.height},{onmousedown:function(){changeViewedDepth(1)},onmouseenter:function(){document.body.style.cursor="pointer"},onmouseexit:function(){document.body.style.cursor=""}},"","downOneButton")),this.addHitbox(new Hitbox({x:.032*this.boundingBox.width,y:.28*this.boundingBox.height,width:.05*this.boundingBox.width,height:.54*this.boundingBox.height},{onmouseenter:function(){activeLayers.MainUILayer.isHoveringOverScroller=!0},onmouseexit:function(){activeLayers.MainUILayer.isHoveringOverScroller=!1},onmousedown:function(){activeLayers.MainUILayer.isOnScroller=!0,changeViewedDepthBasedOnMouseScrollerPosition()},onmouseup:function(){activeLayers.MainUILayer.isOnScroller=!1},onmousemove:function(){activeLayers.MainUILayer.isOnScroller&&changeViewedDepthBasedOnMouseScrollerPosition()}},"pointer","scroller"));for(var t=0;t<worldBeingViewed().mineralIdsToSell.length;t++){var e=.125*this.boundingBox.width+.09*this.boundingBox.width*Math.floor(t/3)-20,i=.015*this.boundingBox.height-8+.03*this.boundingBox.height*(t%3);this.addHitbox(new Hitbox({x:e,y:i,width:.085*this.boundingBox.width,height:.03*this.boundingBox.height},{onmouseenter:function(){var t=parseInt(this.id.split("_")[1]);worldBeingViewed().mineralIdsToSell.length<=t||showUpdatingTooltip(function(){var t=this.mineralIndex,e=worldBeingViewed().mineralIdsToSell;if(!(e.length<=t)){var i=e[t];if(!worldResources[i].isIsotope&&worldResources[i].isOnHeader){if(highestOreUnlocked>=i){var o=worldResources[i].totalValue(),n=_("Value: $")+beautifynum(worldResources[i].sellValue)+"<br>"+_("Value Of Holdings: ${0}",beautifynum(o));return{header:worldResources[i].name,body:n}}if(99999!=getDepthMineralIsFoundAt(i))return{header:"???",body:_("Found around depth {0}km",beautifynum(5*Math.ceil(getDepthMineralIsFoundAt(i)/5)))};worldResources[i].isIsotope&&FUEL_ROD_TYPES.forEach((t=>{reactorComponents[t].rewardOutput.forEach((e=>{if(e.item.id==i)return{header:"???",body:_("Rewarded from {0} in the Reactor",reactorComponents[t].name)}}))}))}}}.bind({mineralIndex:t}),this.boundingBox.x+20,this.boundingBox.y+5,"120px")},onmousedown:function(){openUi(SellWindow,null,worldBeingViewed().index)},onmouseexit:function(){hideTooltip()}},"pointer","Mineral_"+t))}var o=.65*this.boundingBox.width,n=.015*this.boundingBox.height-8;if(this.addHitbox(new Hitbox({x:o,y:n,width:.085*this.boundingBox.width,height:.03*this.boundingBox.height},{onmouseenter:function(){showUpdatingTooltip((function(){return{header:_("Building Materials"),body:beautifynum(worldResources[BUILDING_MATERIALS_INDEX].numOwned)}}),this.boundingBox.x+26,this.boundingBox.y+5,"120px")},onmousedown:function(){openUi(CraftingWindow,null,worldBeingViewed().index,1)},onmouseexit:function(){hideTooltip()}},"pointer","BuildingMaterialsHeader")),depth>302){e=.65*this.boundingBox.width,i=.045*this.boundingBox.height-8;this.addHitbox(new Hitbox({x:e,y:i,width:.085*this.boundingBox.width,height:.03*this.boundingBox.height},{onmouseenter:function(){showUpdatingTooltip((function(){return{header:_("Oil"),body:beautifynum(worldResources[OIL_INDEX].numOwned)+" / "+beautifynum(oilrigStructure.statValueForCurrentLevel())}}),this.boundingBox.x+26,this.boundingBox.y+5,"120px")},onmousedown:function(){openUi(OilPumpWindow)},onmouseexit:function(){hideTooltip()}},"pointer","OilHeader"))}if(depth>1332){e=.65*this.boundingBox.width,i=.075*this.boundingBox.height-8;this.addHitbox(new Hitbox({x:e,y:i,width:.085*this.boundingBox.width,height:.03*this.boundingBox.height},{onmouseenter:function(){showUpdatingTooltip((function(){return{header:_("Nuclear Energy"),body:beautifynum(reactor.currentBatteryCharge())+" / "+beautifynum(reactor.grid.maxBatteryCapacity())}}),this.boundingBox.x+26,this.boundingBox.y+5,"120px")},onmousedown:function(){openUi(ReactorWindow)},onmouseexit:function(){hideTooltip()}},"pointer","EnergyHeader"))}for(t=0;t<worldBeingViewed().isotopeIdsToSell.length/3;t++){var a=worldBeingViewed().mineralIdsToSell.length/3;e=this.boundingBox.width*(.125*a)+.17*this.boundingBox.width*Math.floor(t/3)+5,i=.015*this.boundingBox.height-8+t%3*this.boundingBox.height*.03;this.addHitbox(new Hitbox({x:e,y:i,width:.085*this.boundingBox.width,height:.03*this.boundingBox.height},{onmouseenter:function(){var t=parseInt(this.id.split("_")[1]);showUpdatingTooltip(function(){var t=this.mineralIndex,e=worldBeingViewed().isotopeIdsToSell;if(!(e.length<=3*t)){var i=e[3*t];if(worldResources[i].isIsotope&&worldResources[i].isOnHeader){if(highestIsotopeUnlocked>=i){for(var o="",n=0;n<3;n++){o+="<center><u><b>"+worldResources[i+n].name+"</b></u></center><br>";var a=worldResources[i+n].totalValue();o+=_("Value: $")+beautifynum(worldResources[i+n].sellValue)+"<br>"+_("Value Of Holdings: ${0}",beautifynum(a))+"<br><br>"}return{header:"",body:o}}return{header:"???",body:""}}}}.bind({mineralIndex:t}),this.boundingBox.x+26,this.boundingBox.y+5,"120px")},onmousedown:function(){openUi(SellWindow,null,worldBeingViewed().index,1)},onmouseexit:function(){hideTooltip()}},"pointer","Mineral_"+t))}this.addHitbox(new Hitbox({x:.085*this.boundingBox.width,y:.12*this.boundingBox.height,width:.025*this.boundingBox.width,height:.045*this.boundingBox.height},{onmousedown:function(){0==currentlyViewedDepth&&(openDiscord(),mutebuttons||clickAudio[rand(0,clickAudio.length-1)].play())},onmouseenter:function(){0==currentlyViewedDepth&&(showTooltip(_("Discord"),_("Join us on discord for updates and occasional ticket redemption codes"),"11.5%","12%"),document.body.style.cursor="pointer")},onmouseexit:function(){hideTooltip(),document.body.style.cursor=""}},"","discordButton")),this.addHitbox(new Hitbox({x:.085*this.boundingBox.width,y:.1675*this.boundingBox.height,width:.025*this.boundingBox.width,height:.045*this.boundingBox.height},{onmousedown:function(){isEmailCollected()||0!=currentlyViewedDepth||(showMobileEmailPrompt(),mutebuttons||clickAudio[rand(0,clickAudio.length-1)].play())},onmouseenter:function(){isEmailCollected()||0!=currentlyViewedDepth||(showTooltip(_("Mr.Mine is coming to mobile devices 2022"),"","11.5%","16.75%"),document.body.style.cursor="pointer")},onmouseexit:function(){hideTooltip(),document.body.style.cursor=""}},"","emailCollectionButton")),this.addHitbox(new Hitbox({x:.085*this.boundingBox.width,y:.215*this.boundingBox.height,width:.025*this.boundingBox.width,height:.045*this.boundingBox.height},{onmousedown:function(){0==currentlyViewedDepth&&depth>20&&null==document.getElementById("surveyDiv")&&(hasTakenSurveyCheck()||"true"==localStorage.isSurveyPending||1==localStorage.isSurveyPending?hasTakenSurveyCheck()&&isFlashQuestionSurveyPromptVisible()&&"true"!=localStorage.isServerSurveyPending&&1!=localStorage.isServerSurveyPending&&platform.openFlashSurvey():platform.openSurvey())},onmouseenter:function(){0==currentlyViewedDepth&&depth>20&&null==document.getElementById("surveyDiv")&&(hasTakenSurveyCheck()||"true"==localStorage.isSurveyPending||1==localStorage.isSurveyPending?hasTakenSurveyCheck()&&isFlashQuestionSurveyPromptVisible()&&"true"!=localStorage.isServerSurveyPending&&1!=localStorage.isServerSurveyPending&&(showTooltip(_("Take a short {0} question survey and get {1} tickets. Answer accurately to qualify for more surveys.",numFlashQuestions,numFlashQuestions*surveyRewardMultiplier()),"","11.5%","21.5%"),document.body.style.cursor="pointer"):(showTooltip(_("Take a short survey and get {0} tickets. Answer accurately to qualify for more surveys.",5*surveyRewardMultiplier()),"","11.5%","21.5%"),document.body.style.cursor="pointer"))},onmouseexit:function(){hideTooltip(),document.body.style.cursor=""}},"","surveyButton")),this.addHitbox(new Hitbox({x:.112*this.boundingBox.width,y:.115*this.boundingBox.height,width:.13*this.boundingBox.width,height:.08*this.boundingBox.height},{onmousedown:function(){limitedTimeEventManager.isEventActive&&limitedTimeEventManager.activeEvent.displayCountdown&&(limitedTimeEventManager.openHolidayUI&&limitedTimeEventManager.openHolidayUI(),mutebuttons||clickAudio[rand(0,clickAudio.length-1)].play())},onmouseenter:function(){if(limitedTimeEventManager.isEventActive&&limitedTimeEventManager.activeEvent.displayCountdown){var t=limitedTimeEventManager.eventTooltip();showTooltip(t.header,t.body,"12.5%","18.75%")}document.body.style.cursor="pointer"},onmouseexit:function(){hideTooltip(),document.body.style.cursor=""}},"","holidayEventButton")),this.addHitbox(new Hitbox({x:.937*this.boundingBox.width,y:.115*this.boundingBox.height,width:.0305*this.boundingBox.width,height:.058*this.boundingBox.height},{onmousedown:function(){openUi(SettingsWindow),mutebuttons||clickAudio[rand(0,clickAudio.length-1)].play()},onmouseenter:function(){showTooltip(_("Settings"),_(""),"82%","11.3%"),document.body.style.cursor="pointer"},onmouseexit:function(){hideTooltip(),document.body.style.cursor=""}},"","settingsButton")),this.buffContainer=new Hitbox({x:Math.ceil(.902*this.boundingBox.width),y:0,width:0,height:.5*this.boundingBox.height},{},""),this.buffContainer.allowBubbling=!0,this.buffContainer.defaultX=this.buffContainer.boundingBox.x,this.addHitbox(this.buffContainer);var h=17.5,r=6*this.boundingBox.height/100,s=this.boundingBox.height*h/100;this.addHitbox(new Hitbox({x:.937*this.boundingBox.width,y:s,width:.0305*this.boundingBox.width,height:.058*this.boundingBox.height},{onmousedown:function(){openUi(CraftingWindow),isCraftNotificationOn=!1,mutebuttons||clickAudio[rand(0,clickAudio.length-1)].play()},onmouseenter:function(){showTooltip(_("Open Crafting UI"),_(""),"82%","17.5%"),document.body.style.cursor="pointer"},onmouseexit:function(){hideTooltip(),document.body.style.cursor=""}},"","craftingShortcut")),s+=r,this.addHitbox(new Hitbox({x:.937*this.boundingBox.width,y:s,width:.0305*this.boundingBox.width,height:.058*this.boundingBox.height},{onmousedown:function(){openUi(SuperMinersWindow),panToViewDepth(SUPER_MINER_DEPTH),mutebuttons||clickAudio[rand(0,clickAudio.length-1)].play()},onmouseenter:function(){showTooltip(_("Jump to Super Miner Building"),"","82%","29.5%"),document.body.style.cursor="pointer"},onmouseexit:function(){hideTooltip(),document.body.style.cursor=""}},"","superMinerShortcut")),s+=r,this.addHitbox(new Hitbox({x:.937*this.boundingBox.width,y:s,width:.0305*this.boundingBox.width,height:.058*this.boundingBox.height},{onmousedown:function(){depth>=tradeConfig.tradingPosts[0].depth&&(panToViewDepth(tradeConfig.tradingPosts[0].depth),closeOtherUIs(),mutebuttons||clickAudio[rand(0,clickAudio.length-1)].play())},onmouseenter:function(){depth>=tradeConfig.tradingPosts[0].depth&&(showTooltip(_("Jump to Trading Post"),_(""),"82%","23.5%"),document.body.style.cursor="pointer")},onmouseexit:function(){hideTooltip(),document.body.style.cursor=""}},"","tradePostShortcut")),s+=r,this.addHitbox(new Hitbox({x:.937*this.boundingBox.width,y:s,width:.0305*this.boundingBox.width,height:.058*this.boundingBox.height},{onmousedown:function(){depth>=CAVE_BUILDING_DEPTH&&(panToViewDepth(CAVE_BUILDING_DEPTH),closeOtherUIs(),mutebuttons||clickAudio[rand(0,clickAudio.length-1)].play())},onmouseenter:function(){if(depth>=CAVE_BUILDING_DEPTH){var t="";treasureStorage.isFull()&&(t=_("Treasure storage is full!")),showTooltip(_("Jump to Cave Building"),t,"82%","29.5%"),document.body.style.cursor="pointer"}},onmouseexit:function(){hideTooltip(),document.body.style.cursor=""}},"","caveMenuShortcut"));var d=document.createElement("canvas"),l=d.getContext("2d");caveb.crossOrigin="anonymous",d.width=caveb.width,d.height=caveb.height,l.drawImage(caveb,0,0),l.globalAlpha=.4,l.fillStyle="#FF0000",l.globalCompositeOperation="source-atop",l.fillRect(0,0,d.width,d.height),this.redCaveButtonIcon=new Image,this.redCaveButtonIcon.src=d.toDataURL(),s+=r,this.addHitbox(new Hitbox({x:.937*this.boundingBox.width,y:s,width:.0305*this.boundingBox.width,height:.058*this.boundingBox.height},{onmousedown:function(){hasUnlockedScientists&&(openUi(ScientistsWindow),mutebuttons||clickAudio[rand(0,clickAudio.length-1)].play())},onmouseenter:function(){if(hasUnlockedScientists){var t=document.createElement("canvas"),e=t.getContext("2d"),i=2*this.parent.boundingBox.width*.0305,o=i/4,n=firstOpenScientistSlot();if(0==n)return;for(var a in t.width=n*i+(n+1)*o,t.height=i+15,activeScientists)if(0!=activeScientists[a].length){var h,r=o+a*(o+i),s=activeScientists[a][0];h=isScientistDead(a)?1==a||3==a?death1:death2:scientists[s].image,e.globalAlpha=.15,e.fillStyle="#000000",e.fillRect(r-o/4,0,i+o/2,i+15),e.globalAlpha=1,e.strokeStyle="#794422",e.lineWidth=3,e.beginPath(),e.strokeRect(r-o/4,0,i+o/2,i+15),e.stroke(),e.drawImage(h,r,0,i,i),isScientistDead(a)?(e.fillStyle="#BC3434",e.fillRect(r,i,i,8)):isExcavationDone(a)?(e.fillStyle="#3ED23D",e.fillRect(r,i,i,8)):isOnActiveExcavation(a)?(e.fillStyle="#CCCCCC",e.fillRect(r,i,i,8),e.fillStyle="#FFDE3E",e.fillRect(r,i,i*excavationPercentComplete(a),8)):(e.save(),e.globalAlpha=.2,e.fillStyle="#888888",e.globalCompositeOperation="source-atop",e.fillRect(r,0,i,i),e.restore()),e.strokeStyle="#333333",e.lineWidth=1,e.beginPath(),e.strokeRect(r,i,i,8),e.stroke()}showTooltip('<img src="'+t.toDataURL()+'">',"",this.boundingBox.x-t.width,"35.5%",t.width),document.body.style.cursor="pointer"}},onmouseexit:function(){hideTooltip(),document.body.style.cursor=""}},"","scientistShortcut")),s+=r,this.addHitbox(new Hitbox({x:.937*this.boundingBox.width,y:s,width:.0305*this.boundingBox.width,height:.058*this.boundingBox.height},{onmousedown:function(){depth>=303&&(panToViewDepth(302),closeOtherUIs(),mutebuttons||clickAudio[rand(0,clickAudio.length-1)].play())},onmouseenter:function(){depth>=303&&(showTooltip(_("Jump to the Underground City")+"<br><br>"+_("Forge Workload: {0}",GemForger.currentLoad()),_(""),"82%","41.5%"),document.body.style.cursor="pointer")},onmouseexit:function(){hideTooltip(),document.body.style.cursor=""}},"","cityShortcut")),s+=r,this.addHitbox(new Hitbox({x:.937*this.boundingBox.width,y:s,width:.0305*this.boundingBox.width,height:.058*this.boundingBox.height},{onmousedown:function(){depth>=501&&(panToViewDepth(501),closeOtherUIs(),mutebuttons||clickAudio[rand(0,clickAudio.length-1)].play())},onmouseenter:function(){depth>=501&&(showTooltip(_("Jump to The Core"),_(""),"82%","47.5%"),document.body.style.cursor="pointer")},onmouseexit:function(){hideTooltip(),document.body.style.cursor=""}},"","coreShortcut")),s+=r,this.addHitbox(new Hitbox({x:.937*this.boundingBox.width,y:s,width:.0305*this.boundingBox.width,height:.058*this.boundingBox.height},{onmousedown:function(){depth>=tradeConfig.tradingPosts[1].depth&&(panToViewDepth(tradeConfig.tradingPosts[1].depth),closeOtherUIs(),mutebuttons||clickAudio[rand(0,clickAudio.length-1)].play())},onmouseenter:function(){depth>=tradeConfig.tradingPosts[1].depth&&(showTooltip(_("Jump to Lunar Trading Post"),_(""),"82%","53.5%"),document.body.style.cursor="pointer")},onmouseexit:function(){hideTooltip(),document.body.style.cursor=""}},"","lunarTradePostShortcut")),s+=r,this.addHitbox(new Hitbox({x:.937*this.boundingBox.width,y:s,width:.0305*this.boundingBox.width,height:.058*this.boundingBox.height},{onmousedown:function(){depth>=REACTOR_DEPTH+1&&(panToViewDepth(REACTOR_DEPTH+1),closeOtherUIs(),mutebuttons||clickAudio[rand(0,clickAudio.length-1)].play())},onmouseenter:function(){depth>=REACTOR_DEPTH+1&&(showTooltip(_("Jump to Reactor"),_(""),"82%","59.5%"),document.body.style.cursor="pointer")},onmouseexit:function(){hideTooltip(),document.body.style.cursor=""}},"","reactorShortcut")),this.displayAllBuffs()}render(){worldAtDepth(currentlyViewedDepth).index!=this.worldBeingViewed&&(this.worldBeingViewed=worldAtDepth(currentlyViewedDepth).index,this.setupHeader()),this.renderScrollbar(),this.renderHeader(),this.renderRightSideBar(),this.renderPopupDialogueAttachment(),this.renderChildren(),renderHintArrows(),this.renderVersionNumber()}renderVersionNumber(){this.context.save(),this.context.fillStyle="#FFFFFF",this.context.font="12px Consolas",this.context.textBaseline="top",this.context.globalAlpha=.4;var t="V"+(version-100)/100+buildLetter,e=this.context.measureText(t).width;this.context.fillText(t,.97*mainw-e,0),this.context.restore()}renderHeader(){this.context.clearRect(0,0,mainw,Math.ceil(.11*mainh)),this.context.fillStyle="#FFFFFF",this.context.font="16px "+headerFont,isHeaderTextBolded&&(this.context.font="bold 16px "+headerFont);for(var t=0,e=highestOreUnlocked;e<worldResources.length;e++)!worldResources[e].isIsotope&&worldResources[e].isOnHeader&&worldResources[e].numOwned>0&&highestOreUnlocked<e&&(highestOreUnlocked=e,t++);1==t&&(newNews(_("Discovered")+" "+worldResources[highestOreUnlocked].name,_("Discovered")+" "+worldResources[highestOreUnlocked].name,highestOreUnlocked),mutebuttons||discoverMineralAudio.play());var i=0;for(e=highestIsotopeUnlocked;e<worldResources.length;e++)worldResources[e].isIsotope&&worldResources[e].isOnHeader&&worldResources[e].numOwned>0&&highestIsotopeUnlocked<e&&(highestIsotopeUnlocked=e,i++);1==i&&(newNews(_("Discovered")+" "+worldResources[highestIsotopeUnlocked].name,_("Discovered")+" "+worldResources[highestIsotopeUnlocked].name,highestIsotopeUnlocked),mutebuttons||discoverMineralAudio.play()),this.context.font=Math.round(.013*mainw)+"px"+headerFont;for(e=0;e<worlds.length;e++)this.context.fillStyle="#BBBBBB",worlds[e].hasReached()?(worldBeingViewed()==worlds[e]&&(this.context.fillStyle="#FFFFFF"),this.context.fillText(_(worlds[e].name),.048*mainw,Math.floor(.023*mainh+.034*mainh*e))):this.context.fillText("???",.048*mainw,Math.floor(.023*mainh+.034*mainh*e));this.context.fillStyle="#BBBBBB",this.context.fillStyle="#FFFFFF";var o=worldBeingViewed().mineralIdsToSell;for(e=0;e<o.length;e++){var n=o[e];if(!worldResources[n].isIsotope&&worldResources[n].isOnHeader){var a=Math.floor(.125*mainw+.09*mainw*Math.floor(e/3))-20,h=Math.floor(.015*mainh-8+.03*mainh*(e%3)),r=8+Math.floor(.015*mainh+mainh*(e%3)*.03);highestOreUnlocked>=n?this.context.drawImage(worldResources[n].smallIcon,0,0,worldResources[n].smallIcon.width,worldResources[n].smallIcon.height,a,h,20,20):this.context.drawImage(worldResources[n].smallIconHidden,0,0,worldResources[n].smallIconHidden.width,worldResources[n].smallIconHidden.height,a,h,20,20),this.context.fillText(shortenNum(worldResources[n].numOwned,2,9),a+25,r)}}for(var s=worldBeingViewed().isotopeIdsToSell,d=worldBeingViewed().mineralIdsToSell.length/3,l=(e=0,0);e<s.length;){n=s[e];if(worldResources[n].isIsotope&&worldResources[n].isOnHeader){a=Math.floor(mainw*(.125*d)+.17*mainw*Math.floor(e/9))+5,h=Math.floor(.015*mainh-8+l%3*mainh*.03);highestIsotopeUnlocked>=n?this.context.drawImage(worldResources[n].smallIcon,0,0,worldResources[n].smallIcon.width,worldResources[n].smallIcon.height,a,h,20,20):this.context.drawImage(worldResources[n].smallIconHidden,0,0,worldResources[n].smallIconHidden.width,worldResources[n].smallIconHidden.height,a,h,20,20),this.context.fillText(shortenNum(worldResources[n].numOwned,1,6)+", "+shortenNum(worldResources[n+1].numOwned,1,6)+", "+shortenNum(worldResources[n+2].numOwned,1,6),a+25,h+16),e+=3,l++}else e++}this.context.drawImage(worldResources[BUILDING_MATERIALS_INDEX].smallIcon,0,0,worldResources[BUILDING_MATERIALS_INDEX].smallIcon.width,worldResources[BUILDING_MATERIALS_INDEX].smallIcon.height,8+.65*mainw,.014*mainh-6,20,20),this.context.fillText(shortenAndBeautifyNum(worldResources[BUILDING_MATERIALS_INDEX].numOwned),8+.67*mainw,8+.014*mainh),this.context.fillStyle="#666666",depth>302&&(this.context.drawImage(worldResources[OIL_INDEX].smallIcon,0,0,worldResources[OIL_INDEX].smallIcon.width,worldResources[OIL_INDEX].smallIcon.height,8+.65*mainw,.044*mainh-6,20,20),isOilRigFull()?this.context.fillRect(8+.67*mainw,.044*mainh-6,1*this.context.measureText(shortenAndBeautifyNum(oilRigStats[oilrigStructure.level][1])+" (100%)").width,18):this.context.fillRect(8+.67*mainw,.044*mainh-6,this.context.measureText(shortenAndBeautifyNum(oilRigStats[oilrigStructure.level][1])+" ("+Math.floor(100*worldResources[OIL_INDEX].numOwned/oilrigStructure.statValueForCurrentLevel())+"%)").width*(worldResources[OIL_INDEX].numOwned/oilrigStructure.statValueForCurrentLevel()),18)),depth>1332&&(this.context.drawImage(worldResources[NUCLEAR_ENERGY_INDEX].smallIcon,0,0,worldResources[NUCLEAR_ENERGY_INDEX].smallIcon.width,worldResources[NUCLEAR_ENERGY_INDEX].smallIcon.height,8+.65*mainw,.074*mainh-6,20,20),reactor.currentBatteryCharge()>0&&(reactor.currentBatteryCharge()>=reactor.grid.maxBatteryCapacity()?this.context.fillRect(8+.67*mainw,.074*mainh-6,1*this.context.measureText(shortenAndBeautifyNum(reactor.grid.maxBatteryCapacity())+" (100%)").width,18):this.context.fillRect(8+.67*mainw,.074*mainh-6,this.context.measureText(shortenAndBeautifyNum(reactor.grid.maxBatteryCapacity())+" ("+Math.floor(100*reactor.currentBatteryCharge()/reactor.grid.maxBatteryCapacity())+"%)").width*(reactor.currentBatteryCharge()/reactor.grid.maxBatteryCapacity()),18))),this.context.fillStyle="#FFFFFF",this.context.fillText("$"+beautifynum(money),8+.81*mainw,8+.015*mainh),this.context.fillStyle="#666666",capacity>0&&(isCapacityFull()?(this.context.fillRect(8+.81*mainw,.074*mainh-6,1*this.context.measureText(_("Capacity")+": "+shortenAndBeautifyNum(maxHoldingCapacity())+" (100%)").width,18),numFramesRendered%200==1&&playtime<7200&&newNews(_("Your Capacity is Full! Sell some minerals at the sell center so you can keep mining."))):this.context.fillRect(8+.81*mainw,.074*mainh-6,this.context.measureText(_("Capacity")+": "+shortenAndBeautifyNum(reactor.currentBatteryCharge())+" ("+Math.floor(100*capacity/maxHoldingCapacity())+"%)").width*(capacity/maxHoldingCapacity()),18));var u="";getMoon().hasReached()?getMoon().hasReached()&&!getTitan().hasReached()?u=depth+"Km (W2-"+getMoon().depthReached()+"Km) ("+(progressTowardsNextDepth.greaterThan(depthDifficultyTable[depth])?"100%)":Math.floor(100*divideBigNumberToDecimalNumber(progressTowardsNextDepth,depthDifficultyTable[depth]))+"%)"):getTitan().hasReached()&&(u=depth+"Km (W3-"+getTitan().depthReached()+"Km) ("+(progressTowardsNextDepth.greaterThan(depthDifficultyTable[depth])?"100%)":Math.floor(100*divideBigNumberToDecimalNumber(progressTowardsNextDepth,depthDifficultyTable[depth]))+"%)")):u=_("Depth")+": "+depth+"Km ("+(progressTowardsNextDepth.greaterThan(depthDifficultyTable[depth])?"100%)":Math.floor(100*divideBigNumberToDecimalNumber(progressTowardsNextDepth,depthDifficultyTable[depth]))+"%)"),progressTowardsNextDepth.greaterThan(0)&&this.context.fillRect(8+.81*mainw,.044*mainh-6,this.context.measureText(u).width*Math.min(1,divideBigNumberToDecimalNumber(progressTowardsNextDepth,depthDifficultyTable[depth])),18),this.context.fillStyle="#FFFFFF",this.context.fillText(u,8+.81*mainw,8+.044*mainh),framesRendered2++,1==getAnimationFrameIndex(2,10)&&isCapacityFull()&&(this.context.fillStyle="#FF0000",capacity>maxHoldingCapacity()?this.context.fillRect(8+.81*mainw,.074*mainh-7,this.context.measureText(_("Capacity")+": "+shortenAndBeautifyNum(maxHoldingCapacity())+" (100%)").width,18):this.context.fillRect(8+.81*mainw,.074*mainh-7,this.context.measureText(_("Capacity")+": "+shortenAndBeautifyNum(maxHoldingCapacity())+" ("+Math.floor(100*capacity/maxHoldingCapacity())+"%)").width,18),this.context.fillStyle="#000000"),isCapacityFull()?this.context.fillText(_("Capacity")+": "+shortenAndBeautifyNum(maxHoldingCapacity())+" (100%)",8+.81*mainw,8+.074*mainh):this.context.fillText(_("Capacity")+": "+shortenAndBeautifyNum(maxHoldingCapacity())+" ("+Math.floor(100*capacity/maxHoldingCapacity())+"%)",8+.81*mainw,8+.074*mainh),depth>302&&(this.context.fillStyle="#FFFFFF",this.context.fillText(shortenAndBeautifyNum(worldResources[OIL_INDEX].numOwned)+" ("+Math.floor(100*worldResources[OIL_INDEX].numOwned/oilRigStats[oilrigStructure.level][1])+"%)",8+.67*mainw,8+.044*mainh)),depth>1332&&(this.context.fillStyle="#FFFFFF",framesRendered2%2==1&&reactor.grid.maxBatteryCapacity()>0&&reactor.currentBatteryCharge()>=reactor.grid.maxBatteryCapacity()&&(this.context.fillStyle="#FF0000",reactor.currentBatteryCharge()>=reactor.grid.maxBatteryCapacity()?this.context.fillRect(8+.67*mainw,.074*mainh-7,this.context.measureText(shortenNum(reactor.grid.maxBatteryCapacity(),2)+" (100%)").width,18):this.context.fillRect(8+.67*mainw,.074*mainh-7,this.context.measureText(shortenNum(reactor.grid.maxBatteryCapacity(),2)+" ("+Math.floor(100*reactor.currentBatteryCharge()/reactor.grid.maxBatteryCapacity())+"%)").width,18),this.context.fillStyle="#000000"),reactor.currentBatteryCharge()>=reactor.grid.maxBatteryCapacity()?this.context.fillText(shortenNum(reactor.grid.maxBatteryCapacity(),2)+" (100%)",8+.67*mainw,8+.074*mainh):this.context.fillText(shortenNum(reactor.currentBatteryCharge(),2)+" ("+Math.floor(100*reactor.currentBatteryCharge()/reactor.grid.maxBatteryCapacity())+"%)",8+.67*mainw,8+.074*mainh)),this.context.fillStyle="#000000",this.context.font="18px "+headerFont}renderScrollbar(){this.context.clearRect(Math.ceil(.037*mainw),Math.ceil(.128*mainh),Math.floor(.039*mainw),Math.ceil(.907*mainh)+Math.ceil(.074*mainh)),0!==currentlyViewedDepth?(this.context.drawImage(upallb,0,0,upallb.width,upallb.height,Math.ceil(.037*mainw),Math.ceil(.128*mainh),Math.floor(.039*mainw),Math.ceil(.074*mainh)),this.context.drawImage(upb,0,0,upb.width,upb.height,Math.ceil(.037*mainw),Math.ceil(.203*mainh),Math.floor(.039*mainw),Math.ceil(.074*mainh))):(this.context.drawImage(upallbg,0,0,upallbg.width,upallbg.height,Math.ceil(.037*mainw),Math.ceil(.128*mainh),Math.floor(.039*mainw),Math.ceil(.074*mainh)),this.context.drawImage(upbg,0,0,upbg.width,upbg.height,Math.ceil(.037*mainw),Math.ceil(.203*mainh),Math.floor(.039*mainw),Math.ceil(.074*mainh))),currentlyViewedDepth!==depth?(this.context.drawImage(downb,0,0,downb.width,downb.height,Math.ceil(.037*mainw),Math.ceil(.832*mainh),Math.floor(.039*mainw),Math.ceil(.074*mainh)),this.context.drawImage(downallb,0,0,downallb.width,downallb.height,Math.ceil(.037*mainw),Math.ceil(.907*mainh),Math.floor(.039*mainw),Math.ceil(.074*mainh))):(this.context.drawImage(downbg,0,0,downbg.width,downbg.height,Math.ceil(.037*mainw),Math.ceil(.832*mainh),Math.floor(.039*mainw),Math.ceil(.074*mainh)),this.context.drawImage(downallbg,0,0,downallbg.width,downallbg.height,Math.ceil(.037*mainw),Math.ceil(.907*mainh),Math.floor(.039*mainw),Math.ceil(.074*mainh))),renderChestSliderDots(),activeLayers.MainUILayer.isOnScroller?this.context.globalAlpha=.4:activeLayers.MainUILayer.isHoveringOverScroller&&(this.context.globalAlpha=.7),drawCircle(this.context,Math.ceil(.0565*mainw),Math.ceil(mainh*(.314+currentlyViewedDepth/depth*.49)),Math.floor(.004*mainw),"#76de74","#76de74",0),this.context.globalAlpha=1}renderRightSideBar(){var t=Math.ceil(.937*mainw),e=.0305*this.boundingBox.width*uiScaleX,i=.058*this.boundingBox.height*uiScaleY;this.context.clearRect(t,Math.ceil(.115*mainh),e,Math.ceil(.885*mainh)),this.context.drawImage(settingsb,0,0,33,34,t,Math.ceil(.115*mainh),e,i);var o=Math.ceil(.175*mainh);Math.ceil(.06*mainh);if(isCraftNotificationOn?(this.context.globalAlpha=.5+.5*oscillate(currentTime(),500),console.log(this.context.globalAlpha),this.context.drawImage(hammerAnvil,0,0,hammerAnvil.width,hammerAnvil.height,t,o,e,i),this.context.globalAlpha=1):this.context.drawImage(hammerAnvil,0,0,hammerAnvil.width,hammerAnvil.height,t,o,e,i),depth>=tradeConfig.tradingPosts[0].depth){let o=this.getHitboxById("tradePostShortcut").boundingBox.y;if(isTradeAvailable(earthTradeOffer1))this.context.drawImage(tradingpostb,0,0,33,39,t,o*uiScaleY,e,i);else{let n,a=getNextTradeTimeForWorld(0)-playtime;if(tradingPostStructures[0].level>0){let t=getTimeBetweenTrades(0);n=generateIconWithCooldownOverlay(tradingpostb,e,i,a/t)}else n=generateIconWithCooldownOverlay(tradingpostb,e,i,1);this.context.drawImage(n,t,o*uiScaleY)}}if(superMinerManager.numSuperMiners()>0||chestService.totalBlackChestsOpened>0){let o=this.getHitboxById("superMinerShortcut").boundingBox.y;this.context.drawImage(superb,t,o*uiScaleY,e,i)}if(hasUnlockedScientists){var n="#888888",a="#FFFF00";var h=this.getHitboxById("scientistShortcut").boundingBox.y,r=e/6;for(var s in this.context.save(),this.context.drawImage(scientistb,t,h*uiScaleY,e,i),activeScientists)if(activeScientists[s].length>0){x=isScientistDead(s)?"#FF0000":isExcavationDone(s)?"#00FF00":isOnActiveExcavation(s)?a:n;var d=t+e/2+r*(s-1)*1.5,l=h+r;this.context.fillStyle=x,this.context.strokeStyle="#111111",this.context.beginPath(),this.context.arc(d,l*uiScaleY,r/2,0,2*Math.PI),this.context.fill(),this.context.stroke()}this.context.restore()}if(depth>=304){n="#888888",a="#FFFF00",h=this.getHitboxById("cityShortcut").boundingBox.y,r=e/6;this.context.save(),this.context.drawImage(undergroundb,t,h*uiScaleY,e,i),GemForger.currentLoad()>0?x=a:0==GemForger.currentLoad()&&(x=n);d=t+e/2+-1.5*r,l=h+r;this.context.fillStyle=x,this.context.strokeStyle="#111111",this.context.beginPath(),this.context.arc(d,l*uiScaleY,r/2,0,2*Math.PI),this.context.fill(),this.context.stroke(),this.context.restore()}if(depth>=501){h=this.getHitboxById("coreShortcut").boundingBox.y;this.context.drawImage(coreb,t,h*uiScaleY,e,i)}if(depth>=tradeConfig.tradingPosts[1].depth){h=this.getHitboxById("lunarTradePostShortcut").boundingBox.y;if(isTradeAvailable(moonTradeOffer1))this.context.drawImage(lunartradingpostb,0,0,33,39,t,h*uiScaleY,e,i);else{let o,n=getNextTradeTimeForWorld(1)-playtime;if(tradingPostStructures[1].level>0){let t=getTimeBetweenTrades(1);o=generateIconWithCooldownOverlay(lunartradingpostb,e,i,n/t)}else o=generateIconWithCooldownOverlay(lunartradingpostb,e,i,1);this.context.drawImage(o,t,h*uiScaleY)}}if(depth>=REACTOR_DEPTH+1){h=this.getHitboxById("reactorShortcut").boundingBox.y;this.context.drawImage(reactorb,t,h*uiScaleY,e,i);n="#FFFF00",a="#00FF00",r=e/6;if(this.context.save(),reactor.isRunning){x=a;for(s=0;s<reactor.grid.fuelCellRemainingEnergy.length;s++)0==reactor.grid.fuelCellRemainingEnergy[s].remainingEnergy&&(x=n)}else x="#FF0000";d=t+e/2-1.5*r,l=h+r;this.context.fillStyle=x,this.context.strokeStyle="#111111",this.context.beginPath(),this.context.arc(d,l*uiScaleY,r/2,0,2*Math.PI),this.context.fill(),this.context.stroke(),this.context.restore()}if(depth>=CAVE_BUILDING_DEPTH){var u=getAnimationFrameIndex(8,10);h=this.getHitboxById("caveMenuShortcut").boundingBox.y,r=e/6;if(0!=u&&2!=u||!treasureStorage.isFull())this.context.drawImage(caveb,t,h*uiScaleY,e,i);else{if(!this.redCaveButtonIcon||0==this.redCaveButtonIcon.width){var c=document.createElement("canvas"),g=c.getContext("2d");c.width=caveb.width,c.height=caveb.height,g.drawImage(caveb,0,0),g.globalAlpha=.4,g.fillStyle="#FF0000",c.globalCompositeOperation="source-atop",g.fillRect(0,0,c.width,c.height),this.redCaveButtonIcon=new Image,this.redCaveButtonIcon.src=c.toDataURL()}this.redCaveButtonIcon&&this.redCaveButtonIcon.width>0&&this.context.drawImage(this.redCaveButtonIcon,t,h*uiScaleY,e,i)}var x="#888888";for(var s in caves){if(caves[s].isActive&&!caves[s].isExplored){x="#00FF00";break}caves[s].isActive&&caves[s].currentFuel>=100&&(x="#FFFF00")}this.context.save();d=t+e/2+-1*r*1.5,l=h+r;this.context.fillStyle=x,this.context.strokeStyle="#111111",this.context.beginPath(),this.context.arc(d,l*uiScaleY,r/2,0,2*Math.PI),this.context.fill(),this.context.stroke(),this.context.restore()}}renderPopupDialogueAttachment(){if(this.activeDialogue.x>0)if(activeLayers.hasOwnProperty(this.activeDialogue.popupId)){var t=.125*this.boundingBox.width*uiScaleX,e=(this.boundingBox.height,uiScaleY,this.activeDialogue.x-t),i=.01*this.boundingBox.width*uiScaleX,o=this.activeDialogue.x-t+i,n=t-2*i;this.context.save(),this.context.textBaseline="top",this.context.font="12px Verdana";var a,h=fillTextWrap(this.context,this.activeDialogue.dialogueText,o,this.activeDialogue.y+1.5*i+n,n,"left",.2,!0);this.context.drawImage(narrowTooltip,0,0,narrowTooltip.width,narrowTooltip.height,e,this.activeDialogue.y,t,h.y2-this.activeDialogue.y+i),this.context.drawImage(darkdot,0,0,1,1,o,this.activeDialogue.y+i,n,n),this.context.strokeStyle="#70401e",this.context.strokeRect(o,this.activeDialogue.y+i,n,n),a=this.activeDialogue.extraImage&&0==getAnimationFrameIndex(CHARACTER_BLINK_PERIOD,10)?this.activeDialogue.extraImage:this.activeDialogue.dialogueImage,this.context.drawImage(a,0,0,a.width,a.height,o,this.activeDialogue.y+i,n,n),this.context.textBaseline="top",this.context.font="12px Verdana";h=fillTextWrap(this.context,this.activeDialogue.dialogueText,o,this.activeDialogue.y+1.5*i+n,n,"left",.2);this.context.textBaseline="bottom",this.context.fillStyle="#000000",this.context.strokeStyle="#000000",this.context.globalAlpha=.27,this.context.fillRect(o,this.activeDialogue.y+i+n-16,n,16),this.context.globalAlpha=1,this.context.fillStyle="#FFFFFF",strokeTextShrinkToFit(this.context,this.activeDialogue.dialoguePartyName,o,this.activeDialogue.y+i+n,n,"center"),fillTextShrinkToFit(this.context,this.activeDialogue.dialoguePartyName,o,this.activeDialogue.y+i+n,n,"center"),this.context.restore()}else this.removeDialogueAttachment()}removeDialogueAttachment(){this.activeDialogue={dialogueText:"",dialogueImage:null,dialoguePartyName:"",popupId:"",x:0,y:0,isActive:!1}}addPopupDialogueAttachment(t,e,i,o,n=null){var a;for(var h in activeLayers)if(activeLayers.hasOwnProperty(o)&&activeLayers[h].isPopup)return a=activeLayers[h].hasOwnProperty("tabHeight")?this.getGlobalCoordinates(activeLayers[h].boundingBox.x,activeLayers[h].boundingBox.y+activeLayers[h].tabHeight):this.getGlobalCoordinates(activeLayers[h].boundingBox.x,activeLayers[h].boundingBox.y),this.activeDialogue.dialogueImage=e,this.activeDialogue.extraImage=n,this.activeDialogue.dialogueText=t,this.activeDialogue.dialoguePartyName=i,this.activeDialogue.popupId=o,this.activeDialogue.x=a.x*uiScaleX,this.activeDialogue.y=a.y*uiScaleY,void(this.activeDialogue.isActive=!0)}displayNewBuff(t){var e=new Hitbox({x:0,y:0,width:Math.floor(.03*mainw),height:Math.ceil(.055*mainh)},{},"pointer");activeLayers.PinnedBlueprintsLayer&&(this.buffContainer.boundingBox.y=activeLayers.PinnedBlueprintsLayer.pinnedBlueprintContainer.boundingBox.height+100),e.onmouseenter=function(t){buffs.showBuffTooltip(t,(this.parent.boundingBox.x+this.boundingBox.x-120+this.boundingBox.width)*uiScaleX,(this.parent.boundingBox.y+this.boundingBox.y+this.boundingBox.height)*uiScaleY)}.bind(e,t),e.onmouseexit=function(){hideTooltip()},e.render=function(t,e,i){var o=this.getGlobalCoordinates(0,0);renderBuff(t.context,o.x*uiScaleX,o.y*uiScaleY,this.boundingBox.width,this.boundingBox.height,e),(buffs.activeBuffs[e]!=i||buffs.getBuffTimeRemaining(e)<=0)&&t.deleteBuffFromOverlay(this)}.bind(e,this,t,buffs.activeBuffs[t]),this.buffContainer.addHitbox(e),this.arrangeBuffsInOverlay()}displayAllBuffs(){for(var t in this.buffContainer.clearHitboxes(),buffs.activeBuffs)this.displayNewBuff(t);this.arrangeBuffsInOverlay()}arrangeBuffsInOverlay(){var t=this.buffContainer.hitboxes;if(t.length>0){var e=Math.floor(this.buffContainer.boundingBox.height/(t[0].boundingBox.height+5+5)),i=Math.ceil(t.length/e);this.buffContainer.boundingBox.width=(t[0].boundingBox.width+5)*i,this.buffContainer.boundingBox.x=this.buffContainer.defaultX-(i-1)*(t[0].boundingBox.width+5);for(var o=0;o<t.length;++o)t[o].boundingBox.x=(i-1-Math.floor(o/e))*(t[o].boundingBox.width+5),t[o].boundingBox.y=o%e*(t[o].boundingBox.height+5),t[o].id="buff_"+o}else this.buffContainer.boundingBox.x=this.buffContainer.defaultX,this.buffContainer.boundingBox.width=0}deleteBuffFromOverlay(t){this.buffContainer.deleteHitboxWithId(t.id),this.displayAllBuffs()}}var lastScrollTime=0,maxRefreshRateMsecs=10;function changeViewedDepthBasedOnMouseScrollerPosition(){if(expectedTimeUntilNextRepaintMsec()<maxRefreshRateMsecs&&lastScrollTime<currentTime()-maxRefreshRateMsecs){var t=window.innerHeight,e=.311*t,i=(mouseY-e)/(.805*t-e);if((i=Math.max(0,i))>=0&&i<=100){var o=Math.round(depth*i);o=Math.min(o,depth),currentlyViewedDepth=o,MAIN.clearRect(0,.11*mainh,mainw,.89*mainh),animate(),hasAnimatedThisFrame=1,movedivs()}lastScrollTime=currentTime()}}